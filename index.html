<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 1. GANTI JUDUL DI SINI -->
    <title>StructureFlow v3.5 ‚Äî Edisi Angga Conni Saputra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        @keyframes fadeIn { from{opacity:0}to{opacity:1} }
        @keyframes slideUp { from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1} }
        @keyframes slideRight { from{transform:translateX(12px);opacity:0}to{transform:translateX(0);opacity:1} }
        @keyframes scaleIn { from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1} }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 10%, 30%, 50%, 70%, 90% {transform: translateX(-4px);} 20%, 40%, 60%, 80% {transform: translateX(4px);} }
        .anim-fade { animation: fadeIn .35s ease both; }
        .anim-up { animation: slideUp .4s cubic-bezier(.22,1,.36,1) both; }
        .anim-right { animation: slideRight .3s ease both; }
        .anim-scale { animation: scaleIn .35s cubic-bezier(.22,1,.36,1) both; }
        .anim-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .delay-1 { animation-delay: .05s; }
        .delay-2 { animation-delay: .1s; }
        .delay-3 { animation-delay: .15s; }
        .delay-4 { animation-delay: .2s; }
        @media print { .no-print{display:none!important} }
        .prose-card h1,.prose-card h2,.prose-card h3{margin:.8em 0 .4em;font-weight:600;line-height:1.3}
        .prose-card h3{font-size:1rem;color:#1e40af}
        .prose-card p{margin-bottom:.7em;line-height:1.65;color:#374151}
        .prose-card ul,.prose-card ol{padding-left:1.4em;margin-bottom:.7em}
        .prose-card li{margin-bottom:.3em;color:#374151}
        .prose-card strong{color:#111827;font-weight:600}
        .prose-card em{color:#4b5563}
        .prose-card blockquote{border-left:3px solid #6366f1;padding:.5em 1em;background:#f5f3ff;margin:1em 0;border-radius:0 6px 6px 0;font-style:italic;color:#4338ca}
        .prose-card table { width: 100%; border-collapse: collapse; margin: 1em 0; }
        .prose-card th, .prose-card td { border: 1px solid #cbd5e1; padding: 8px; text-align: left; }
        .prose-card th { background-color: #f1f5f9; font-weight: bold; }

        /* AI Specific Styles */
        .ai-glow { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }
        .ai-thinking { background: linear-gradient(270deg, #3b82f6, #8b5cf6, #3b82f6); background-size: 200% 200%; animation: gradient-move 2s ease infinite; }
        @keyframes gradient-move { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        /* === GAYA PUBLIKASI HARVARD UNTUK EKSPOR PDF === */
        .harvard-export {
        font-family: 'Garamond', 'Times New Roman', serif !important;
        font-size: 12pt !important;
        line-height: 1.7 !important;
        color: #000 !important;
        background: #fff !important;
        max-width: 100% !important;
        padding: 0 !important;
        margin: 0 auto !important;
        box-sizing: border-box !important;
        overflow-wrap: break-word !important; /* paksa word wrap */
}

        /* Margin halaman (standar jurnal 1 inci) */
        .harvard-export .pdf-content {
        margin: 2.54cm !important;
        padding: 0 !important;
}

        /* PASTIKAN SEMUA ELEMEN TIDAK MELEWATI LEBAR */
        .harvard-export * {
        max-width: 100% !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
}

        .harvard-export img,
        .harvard-export table,
        .harvard-export pre {
        max-width: 100% !important;
        height: auto !important;
}

        .harvard-export table {
        table-layout: fixed !important; /* paksa tabel menyesuaikan lebar */
        word-wrap: break-word !important;
}

        .harvard-export pre {
        white-space: pre-wrap !important; /* bungkus teks panjang di kode */
}

        /* Judul dokumen */
        .harvard-export h1.document-title {
        font-size: 28pt !important;
        font-weight: 700 !important;
        text-align: center !important;
        margin: 0 0 0.8cm 0 !important;
        line-height: 1.3 !important;
        letter-spacing: -0.5px !important;
        color: #1a1a1a !important;
}

        /* Abstrak (jika ada) */
        .harvard-export .abstract {
        font-size: 11pt !important;
        font-style: italic !important;
        margin: 1.5em 0 !important;
        padding: 0 1em !important;
        border-left: 3px solid #ccc !important;
        color: #333 !important;
}

        /* Heading level 1 (bab) */
        .harvard-export h2 {
        font-size: 18pt !important;
        font-weight: 700 !important;
        margin-top: 1.5em !important;
        margin-bottom: 0.5em !important;
        color: #000 !important;
        border-bottom: 1px solid #ddd !important;
        padding-bottom: 0.3em !important;
}

        /* Heading level 2 (sub-bab) */
        .harvard-export h3 {
        font-size: 14pt !important;
        font-weight: 600 !important;
        margin-top: 1.2em !important;
        margin-bottom: 0.3em !important;
        color: #222 !important;
}

        /* Paragraf */  
        .harvard-export p {
        text-align: justify !important;
        margin-bottom: 0.7em !important;
        orphans: 3 !important;
        widows: 3 !important;
}

        /* Daftar (bullet/number) */
        .harvard-export ul,
        .harvard-export ol {
        margin-left: 2em !important;
        margin-bottom: 0.7em !important;
}

        /* Tabel dan gambar (jika ada) */
        .harvard-export table {
        border-collapse: collapse !important;
        width: 100% !important;
        margin: 1em 0 !important;
}
        .harvard-export th,
        .harvard-export td {
        border: 1px solid #aaa !important;
        padding: 0.4em !important;
        text-align: left !important;
}
        .harvard-export th {
        background-color: #f5f5f5 !important;
        font-weight: 600 !important;
}

/* Nomor halaman (akan ditambahkan otomatis oleh html2pdf) */
/* Tidak perlu CSS khusus, html2pdf.js sudah mengatur page breaks */ 

        /* --- TAMBAHAN CSS UNTUK EDITOR (TABEL & WARNA) --- */
.prose-card table {
    width: 100%;
    border-collapse: collapse;
    margin: 1em 0;
}
.prose-card th, .prose-card td {
    border: 1px solid #cbd5e1; /* Warna garis abu-abu */
    padding: 8px;
    text-align: left;
}
.prose-card th {
    background-color: #f1f5f9; /* Warna header tabel agak abu */
    font-weight: bold;
}
/* Agar warna background teks terlihat jelas */
.prose-card span[style*="background-color"] {
    padding: 0 2px;
    border-radius: 2px;
}
    /* --- CSS BARU UNTUK GUIDANCE CANTIK --- */
.guidance-content h4 {
    font-weight: 700;
    color: #1e3a8a; /* Biru tua */
    margin-top: 1em;
    margin-bottom: 0.5em;
    font-size: 0.95rem;
}
.guidance-content ul, .guidance-content ol {
    margin-left: 1.2em;
    margin-bottom: 1em;
    list-style-type: disc; /* Agar bullet point muncul */
}
.guidance-content li {
    margin-bottom: 0.4em;
    line-height: 1.6;
}
.guidance-content strong {
    color: #0f172a;
    font-weight: 600;
}
/* Kotak Tips Biru */
.box-tip {
    background-color: #eff6ff;
    border-left: 4px solid #3b82f6;
    padding: 12px;
    border-radius: 6px;
    margin: 10px 0;
    font-size: 0.9em;
    color: #1e40af;
}
/* Kotak Peringatan Merah */
.box-warn {
    background-color: #fef2f2;
    border-left: 4px solid #ef4444;
    padding: 12px;
    border-radius: 6px;
    margin: 10px 0;
    font-size: 0.9em;
    color: #991b1b;
}
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
<div id="root"></div>

<script type="text/babel" data-type="module">
import React, { useState, useEffect, useRef, useCallback } from 'react';
import { createRoot } from 'react-dom/client';
import {
    Layout, Plus, Trash2, Edit3, Save, Upload, FileText,
    ArrowUp, ArrowDown, Globe, BookOpen, ChevronLeft,
    Bold, Italic, List, Printer, FolderOpen, Mail,
    Sparkles, GraduationCap, Scale, Newspaper, Megaphone,
    PenTool, BarChart2, Search, Tag, CheckCircle2,
    AlertCircle, Lightbulb, Library, Layers, Cpu, X,
    ChevronDown, ChevronRight, Star, Zap, Info,
    Brain, MessageSquare, Undo, Lock, Unlock, AlertTriangle, Loader2, Download,
    RefreshCw, Terminal, 
    Table, Palette // Pastikan Table dan Palette tetap ada
} from 'lucide-react';

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AI BRIDGE ‚Äî Resilience Layer (FALLBACK ENABLED)
   Sekarang mendukung bahasa dinamis (EN/ID) di setiap prompt.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AI BRIDGE ‚Äî Final Version (Gemini 2.5 + Bilingual Support)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const AI_BRIDGE = {
    // 1. Prioritas Model (Sesuai kesuksesan Horizon Pro)
    models: [
        'gemini-2.5-flash',      // UTAMA
        'gemini-2.0-flash-exp',  // CADANGAN 1
        'gemini-1.5-flash'       // CADANGAN 2
    ],

    hasKey: (key) => !!key && key.length > 10,

    // Fungsi Utama Generate
    async generate(prompt, apiKey, onProgress) {
        const cleanKey = apiKey.trim();
        if (!this.hasKey(cleanKey)) throw new Error("API Key tidak valid.");

        let lastError = null;

        for (const model of this.models) {
            try {
                if (onProgress) onProgress(`Menghubungi Google (${model})...`);
                const result = await this._callModel(model, prompt, cleanKey);
                return result; 
            } catch (e) {
                console.warn(`Gagal di model ${model}:`, e.message);
                lastError = e;
                if (e.message.includes("429")) break; // Stop jika limit habis
            }
        }
        throw new Error(`Semua model gagal. Error terakhir: ${lastError?.message}`);
    },

    // Fungsi Panggilan API (Menggunakan Prompt Dinamis)
    async _callModel(model, prompt, apiKey) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
        
        const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                contents: [{ 
                    parts: [{ text: prompt }] // Prompt sudah mengandung instruksi bahasa dari fungsi di bawah
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 8192
                }
            })
        });

        if (!response.ok) {
            const errData = await response.json().catch(() => ({}));
            throw new Error(errData.error?.message || `HTTP Error ${response.status}`);
        }

        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
    },

    // --- BAGIAN INI MENGATUR BAHASA (BILINGUAL) ---
    
    // 1. Untuk Auto-Draft per Bagian (Tombol Sparkles Kecil)
    buildNodeContext: (currentSection, prevSection, nextSection, docMeta, lang) => {
        const targetLang = lang === 'en' ? 'English' : 'Indonesian (Bahasa Indonesia)';
        
        return `
        SYSTEM: You are an expert academic writer and editor.
        CONTEXT: Document Title: "${docMeta.title}". Section: "${currentSection.sectionKey}".
        
        IMPORTANT INSTRUCTION:
        You MUST write the content in ${targetLang}. 
        If the input is in English but the target is Indonesian, TRANSLATE and EXPAND it.
        If the input is in Indonesian but the target is English, TRANSLATE and EXPAND it.
        
        INPUT CONTENT:
        "${currentSection.content.replace(/<[^>]*>/g, '')}"
        
        OUTPUT FORMAT:
        Return ONLY valid HTML tags (<h3>, <p>, <ul>, <li>, <strong>). Do not use Markdown blocks.
        `;
    },

    // 2. Untuk Global Auto-Draft (Tombol Otak Besar di Atas)
    buildGlobalContext: (sections, docMeta, lang) => {
        const targetLang = lang === 'en' ? 'English' : 'Indonesian (Bahasa Indonesia)';
        
        return `
        SYSTEM: You are an expert document architect.
        TASK: Review and fill in missing content for the document "${docMeta.title}".
        
        STRICT LANGUAGE RULE:
        ALL generated content MUST be in ${targetLang}.
        
        INPUT DATA (JSON):
        ${JSON.stringify(sections.map(s => ({id: s.id, content: s.content})))}
        
        OUTPUT FORMAT:
        Return a raw JSON Array of objects with 'id' and 'content' keys.
        `;
    },

    // 3. Untuk Guidance / AI Coach (Versi Deep Mentoring)
    buildGuidanceContext: (content, guidance, lang) => {
        const isIndo = lang !== 'en'; // Cek bahasa
        
        // Label dinamis biar outputnya rapi sesuai bahasa
        const labels = isIndo ? {
            role: "Dosen Pembimbing Senior & Editor Jurnal Internasional",
            strength: "‚úÖ Kekuatan (Pertahankan)",
            weakness: "‚ö†Ô∏è Celah Logika & Masalah (Kritis)",
            advice: "üí° Saran Perbaikan Konkret",
            example: "Contoh Penulisan Ulang (Rewrite):"
        } : {
            role: "Senior Academic Supervisor & Journal Editor",
            strength: "‚úÖ Strengths (Keep this)",
            weakness: "‚ö†Ô∏è Critical Gaps & Logic Issues",
            advice: "üí° Actionable Improvements",
            example: "Example Rewrite:"
        };

        const targetLang = isIndo ? 'Indonesian (Bahasa Indonesia) - Gaya Akademis Formal' : 'English (Academic/Professional Tone)';
        
        return `
        ROLE: ${labels.role}.
        
        TASK: 
        You are mentoring a user to write a high-stakes document. Do not just correct grammar. 
        Analyze the **depth of argument**, **logical flow**, and **evidence strength**.
        
        CONTEXT:
        - Section Goal: "${guidance.what}"
        - User Draft: "${content.replace(/<[^>]*>/g, '')}"
        
        STRICT LANGUAGE RULE:
        The output MUST be in ${targetLang}.
        
        INSTRUCTIONS:
        1. **Analyze:** Does the draft meet the "Section Goal"? Is it specific enough?
        2. **Critique:** Identify where the logic is weak, vague, or unsupported (e.g., claims without data).
        3. **Teach:** Provide a specific example of how to rewrite the weakest sentence.

        OUTPUT FORMAT (HTML ONLY - NO MARKDOWN):
        <div class="space-y-4">
          
          <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
            <h4 class="font-bold text-green-800 text-xs uppercase mb-1">${labels.strength}</h4>
            <p class="text-sm text-green-900">[Explain 1 thing the user did well]</p>
          </div>

          <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
            <h4 class="font-bold text-red-800 text-xs uppercase mb-1">${labels.weakness}</h4>
            <ul class="list-disc list-inside text-sm text-red-900 space-y-1">
              <li>[Point out a vague claim]</li>
              <li>[Point out a missing connection or logic gap]</li>
            </ul>
          </div>

          <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
            <h4 class="font-bold text-blue-800 text-xs uppercase mb-1">${labels.advice}</h4>
            <p class="text-sm text-blue-900 mb-2">[Specific instruction on what to fix]</p>
            <div class="bg-white p-2 rounded border border-blue-100 text-sm text-slate-600 italic">
              <strong>${labels.example}</strong><br/>
              "[Write a superior version of one of the user's sentences here]"
            </div>
          </div>

        </div>
        `;
    }
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODULE DATA & CONFIGURATION
   PAK ANGGA, EDIT DI BAWAH INI UNTUK MENAMBAH TEMPLATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const SCHEMA_VERSION = '3.0.0';

// 1. DUMMY DATA (Isi konten contoh - English Only)
const DUMMY_DATA = {
  journal_article: {
    title: 'Architecting Resilience: A Comprehensive Analysis of Serverless Digital Ecosystems for Governance Reform in Emerging Economies',
    sections: [
      { 
        key: 'abstract', 
        content: `<h3>Abstract</h3>
        <p>The global landscape of digital governance is often marred by the failure of high-cost, monolithic infrastructure projects that fail to adapt to the local realities of developing nations. This research explores the "Serverless Democratization" paradigm, focusing on the utilization of low-cost, high-context digital tools‚Äîcollectively termed the "Google Fullstack" (Apps Script, Sheets, and Cloud-native automation). Through a multi-year analysis of projects ranging from vaccine cold chain management to digital correspondence in Indonesian ministries, this paper argues that decentralized, agile development models provide a more resilient framework for institutional reform than traditional ERP systems. The study concludes that by lowering the technical barrier to entry, organizations can foster a culture of "Civic Tech" that is both sustainable and immune to the common pitfalls of bureaucratic IT procurement.</p>` 
      },
      { 
        key: 'introduction', 
        content: `<h3>1. Introduction: The Crisis of Complexity</h3>
        <p>In the realm of public sector digital transformation, there exists a persistent "Complexity Trap." Organizations, particularly in the Global South, often equate "Modernization" with the acquisition of expensive, enterprise-grade software licenses and the construction of local data centers. However, historical data from UNESCO and UNDP initiatives suggest that these "Digital White Elephants" frequently collapse under the weight of their own maintenance requirements, lack of specialized personnel, and the rapid obsolescence of hardware.</p>
        <p>This research is situated at the intersection of public policy administration and digital system architecture. It addresses a fundamental question: How can resource-constrained institutions achieve 100% digital maturity without a multi-million dollar budget? The introduction of serverless computing‚Äîspecifically Function-as-a-Service (FaaS)‚Äîhas fundamentally altered the cost-benefit analysis of digital reform. By shifting the burden of infrastructure security and uptime to global cloud providers, local administrators can refocus their energy on the business logic of governance: transparency, efficiency, and accountability.</p>
        <p>Furthermore, this paper examines the role of the "Independent Consultant" as a bridge between high-level policy goals and ground-level technical execution. Drawing from over 12 years of experience in the Indonesian governance sector, we analyze how "Sub-Professional" staff and agile developers can bypass traditional bureaucratic bottlenecks to deliver functional tools (Minimum Viable Products) in days rather than years.</p>` 
      },
      { 
        key: 'literature_review', 
        content: `<h3>2. Literature Review: Frugal Innovation and the Evolution of Cloud</h3>
        <p>The concept of <strong>Frugal Innovation</strong> (Radjou et al., 2012) serves as the foundational theory for this study. It posits that high-value solutions can be derived from minimal resources through creative improvisation and a deep understanding of local constraints. In the context of IT, this translates to the "Google Fullstack" approach‚Äîusing pervasive tools like Google Sheets not merely as spreadsheets, but as relational database surrogates that are already whitelisted by government firewalls.</p>
        <p>Historically, digital governance has moved through three distinct phases:
        <ol>
          <li><strong>The Monolithic Era (1990-2010):</strong> Heavy reliance on on-premise servers and proprietary software like SAP or Oracle. High cost, low agility.</li>
          <li><strong>The Early Cloud Era (2010-2020):</strong> Migration of virtual machines to AWS or Azure (IaaS). Reduced hardware costs, but still requiring high DevOps expertise.</li>
          <li><strong>The Serverless Era (2020-Present):</strong> The rise of "No-Ops" environments where code (like Google Apps Script) runs in response to events. This era marks the true democratization of digital tools.</li>
        </ol>
        <p>By reviewing the work of contemporary digital architects in the Indonesian public sector, it becomes clear that the most successful projects are those that embrace "Agile Governance." This involves small, iterative deployments that solve specific pain points‚Äîsuch as the "E-Persuratan" system‚Äîrather than attempting to build all-encompassing "Super-Apps" that are prone to catastrophic failure during the transition period.</p>` 
      },
      { 
        key: 'framework', 
        content: `<h3>3. Theoretical Framework: Behavioral Science and Information Warfare</h3>
        <p>A digital system is only as effective as the human behavior it influences. Our framework synthesizes three core disciplines: <strong>Behavioral Psychology (COM-B Model)</strong>, <strong>Media Synchronicity Theory (MST)</strong>, and <strong>Strategic Communication (Information Warfare)</strong>.</p>
        <p><strong>3.1 The COM-B Integration:</strong> 
        The system must ensure that users have the <i>Capability</i> (a simple, familiar UI), the <i>Opportunity</i> (mobile-first accessibility), and the <i>Motivation</i> (immediate visible reduction in workload). If a digital correspondence tool requires 10 steps to sign a document when the manual process takes only 2, the system will fail regardless of its technical brilliance.</p>
        <p><strong>3.2 Information Warfare and "Canary Traps" in Bureaucracy:</strong> 
        In high-stakes governance environments, digital tools often serve a dual purpose: workflow automation and information security. We explore the use of "Canary Traps" within digital systems‚Äîdeliberately placing unique, trackable data points in sensitive documents to identify the source of information leaks. This "Strategic Transparency" acts as a deterrent against internal sabotage and ensures that the "Chain of Custody" for government documents is immutable and auditable.</p>
        <p><strong>3.3 The Paradox of Safety:</strong> 
        We argue that many safety protocols in traditional IT are performative. A system that is "too secure to use" is, in fact, the most dangerous, as it drives users to use unencrypted personal apps (like WhatsApp) for official business. Our framework advocates for "Usable Security"‚Äîleveraging Google‚Äôs OAuth2 and 2FA to provide enterprise-grade protection that doesn't hinder the user experience.</p>` 
      },
      { 
        key: 'methodology', 
        content: `<h3>4. Methodology: Action Research and Fullstack Prototyping</h3>
        <p>This research utilizes an <strong>Action Research</strong> methodology, characterized by a spiral of cycles: planning, acting, observing, and reflecting. The primary research "laboratory" consists of several real-world deployments across Indonesian NGOs and government agencies between 2022 and 2026.</p>
        <p><strong>4.1 Technical Architecture of the "Dummy" Prototypes:</strong>
        The research focuses on a serverless stack optimized for zero-cost maintenance:
        <ul>
          <li><strong>Logic Layer:</strong> Google Apps Script (V8 Engine) using <code>doGet()</code> and <code>doPost()</code> functions to handle web requests.</li>
          <li><strong>Data Persistence:</strong> Google Sheets API as a NoSQL database. We utilize <i>A1 Notation</i> for rapid querying and <i>JSON-stringification</i> to store complex objects within single cells, bypassing the 5-million-cell limit of standard sheets.</li>
          <li><strong>User Interface:</strong> A decoupled frontend built with Bootstrap 5, utilizing <code>google.script.run</code> for asynchronous communication between the client and the server.</li>
        </ul>
        <p><strong>4.2 Evaluation Metrics:</strong>
        Systems were evaluated based on the <i>"Agility Index"</i> (time from requirement to deployment), <i>"Friction Coefficient"</i> (number of clicks per core task), and <i>"Maintenance Overhead"</i> (man-hours required per month to keep the system operational).</p>` 
      },
      { 
        key: 'findings', 
        content: `<h3>5. Findings: The Efficiency of Serverless Governance</h3>
        <p>The implementation of serverless tools yielded significant empirical data across multiple sectors. In the "E-Persuratan" case study, the time required to route an official letter through three levels of approval dropped from 72 hours (manual/hybrid) to 4.5 minutes (fully digital). This represents a **94% increase in administrative velocity**.</p>
        <p><strong>5.1 Cost-Effectiveness Analysis:</strong>
        Compared to a standard vendor-based ERP deployment (estimated at $50,000 USD initial + $5,000/year maintenance), the Google Fullstack solution cost exactly $0 in licensing fees. The only "cost" was the human capital required for the 72-hour development sprint. This proves that for "Sub-Professional" tasks, high-cost procurement is economically irrational.</p>
        <p><strong>5.2 Resilience in Remote Areas (The "Papua-Jambi" Effect):</strong>
        Data from projects in Jayapura (UNDP Vaccine Cold Chain) and Jambi (Infrastructure Gini Ratio Research) showed that lightweight web apps performed significantly better on low-bandwidth 3G/4G connections than heavy Java-based government portals. The "Low-Text, High-Context" UI design reduced data consumption by 60%, ensuring that officials in remote disadvantaged regions remained part of the digital workflow.</p>` 
      },
      { 
        key: 'discussion', 
        content: `<h3>6. Discussion: The Philosophy of "Good Enough" and Divergent Thinking</h3>
        <p>The findings challenge the "Perfectionist Fallacy" in digital development. We argue for the <strong>Philosophy of "Good Enough" Tech</strong>‚Äîwhere a tool that solves 90% of a problem today is infinitely more valuable than a tool that solves 100% of a problem next year. This is particularly relevant for "Divergent" thinkers (such as the primary subject of this case study) who prioritize output and functional iteration over rigid documentation.</p>
        <p>Furthermore, the discussion addresses the "Information Warfare" aspect of digital transition. By making government processes digital and serverless, we create a "Digital Footprint" that is difficult to erase. This transparency acts as a strategic weapon against corruption (KKN). However, it also requires a shift in leadership mindset: from "Gatekeepers of Information" to "Facilitators of Data." The resistance to these tools is rarely technical; it is almost always a defense mechanism by individuals who benefit from the opacity of manual systems.</p>` 
      },
      { 
        key: 'conclusion', 
        content: `<h3>7. Conclusion: The Future is Serverless and Decentralized</h3>
        <p>The path to governance reform does not lie in more servers, but in smarter code. Democratizing digital tools through serverless architectures allows for a bottom-up transformation where the workers themselves become the architects of their efficiency. As demonstrated by the success of the "E-Persuratan" and "Biodiversity" systems, the future belongs to agile, low-cost, and high-impact solutions. We recommend that international organizations (UN, GAVI, etc.) and government ministries pivot their digital strategies to prioritize "Civic Tech" ecosystems that empower independent consultants and sub-professional staff to build the future of governance, one script at a time.</p>` 
      }
    ]
  },
  
  /* --- AREA EDIT (PAK ANGGA): TAMBAH DUMMY DATA BARU DI SINI --- */
  /* ID harus sama dengan di Module Registry nanti */
  
  project_proposal: { 
  title: 'Nusantara Blue Guardians: Empowering Coastal Youth through Data-Driven Ocean Literacy', 
  sections: [
    { 
      key: 'executive_summary', 
      content: `
        <h3>1. Executive Summary</h3>
        <p><strong>Project Title:</strong> Nusantara Blue Guardians<br>
        <strong>Duration:</strong> 18 Months<br>
        <strong>Location:</strong> Pilot in 3 Provinces (North Sulawesi, Maluku, West Nusa Tenggara)<br>
        <strong>Total Budget Request:</strong> $85,000 USD</p>
        
        <p>Indonesia, the world's largest archipelagic state, stands at a critical juncture. While the nation contributes significantly to global marine biodiversity, it also ranks as a major source of marine plastic debris. Current interventions often suffer from a "top-down" approach, relying on external consultants and generalized data that fails to reflect the hyper-local reality of coastal villages.</p>
        
        <p>The <strong>Nusantara Blue Guardians</strong> initiative proposes a paradigm shift: turning coastal youth from passive observers into active <em>Citizen Scientists</em>. By combining <strong>Contextual Ocean Ethics</strong> (reviving local maritime wisdom) with <strong>Modern Digital Tools</strong> (a custom offline-first data app), we aim to bridge the gap between national policy and village-level execution.</p>
        
        <p><strong>Core Objectives:</strong></p>
        <ul>
          <li><strong>Empower:</strong> Train 500 NEET (Not in Education, Employment, or Training) youth as certified "Blue Guardians."</li>
          <li><strong>Digitize:</strong> Deploy "LautKita," a low-bandwidth Progressive Web App (PWA) for granular marine debris auditing.</li>
          <li><strong>Influence:</strong> Generate 5 "Village Ocean State Reports" to secure ongoing allocation from the Village Fund (Dana Desa).</li>
        </ul>
      ` 
    },
    { 
      key: 'situational_analysis', 
      content: `
        <h3>2. Situational Analysis & Rationale</h3>
        
        <h4>2.1 The Problem: Data Scarcity & Youth Disengagement</h4>
        <p>Despite strong national commitments (e.g., reducing marine debris by 70% by 2025), implementation at the district level is hampered by:</p>
        <ul>
          <li><strong>The "Data Vacuum":</strong> Dinas Lingkungan Hidup (Local Environmental Agencies) often lack budget for regular monitoring. They rely on estimated national averages rather than actual local data, leading to inefficient resource allocation.</li>
          <li><strong>The "Scientific Disconnect":</strong> Ocean literacy materials are often direct translations of Western textbooks. They discuss "ocean acidification" in abstract terms but fail to address immediate local threats like blast fishing or plastic sachets, making conservation seem like an "elite" concern.</li>
        </ul>

        <h4>2.2 Policy Alignment</h4>
        <p>This project directly supports:</p>
        <ul>
          <li><strong>UN SDG 14.1:</strong> Prevent and significantly reduce marine pollution.</li>
          <li><strong>RPJMN (Indonesian National Medium-Term Development Plan):</strong> Strengthening the "Poros Maritim Dunia" identity.</li>
        </ul>
      ` 
    },
    { 
      key: 'methodology', 
      content: `
        <h3>3. Methodology: The "Data-to-Action" Loop</h3>
        <p>We utilize a <strong>Participatory Action Research (PAR)</strong> approach, ensuring the community owns the data they collect. The methodology follows a three-step cycle:</p>
        
        <div style="background:#eef; padding:15px; margin:10px 0; border-left: 5px solid #0056b3;">
          <p><strong>Step 1: Calibration (Social & Tech)</strong><br>
          We do not just "drop" technology. We first calibrate the social understanding through "Ocean Ethics" workshops that blend modern science with local customary law (<em>Hukum Adat</em>, e.g., <em>Sasi</em> in Maluku).</p>
          
          <p><strong>Step 2: Collection (Citizen Science)</strong><br>
          Youth use the "LautKita" app to conduct rigorous beach audits. The app uses gamification to ensure consistent data quality (e.g., distinguishing between branded plastics vs. generic waste).</p>
          
          <p><strong>Step 3: Advocacy (Data Diplomacy)</strong><br>
          Raw data is useless without interpretation. We train youth to visualize this data and present it to Village Heads (Kepala Desa) to advocate for waste management budgets.</p>
        </div>
      ` 
    },
    { 
      key: 'technical_implementation', 
      content: `
        <h3>4. Detailed Implementation Plan</h3>
        
        <h4>Phase 1: Foundation & Tech Development (Months 1-4)</h4>
        <ul>
          <li><strong>Activity 1.1: "LautKita" App Development.</strong> Building an offline-first PWA. Key features: GPS tagging accuracy <5m, image recognition assistance for debris categorization, and auto-sync when Wi-Fi is available.</li>
          <li><strong>Activity 1.2: Curriculum Design.</strong> Developing the "Blue Guardian" handbook, integrating localized marine ecology modules.</li>
        </ul>

        <h4>Phase 2: Train-the-Trainers (ToT) (Months 5-6)</h4>
        <ul>
          <li><strong>Activity 2.1: Recruitment.</strong> Selecting 50 "Regional Coordinators" based on leadership potential, not just academic grades.</li>
          <li><strong>Activity 2.2: The Bootcamp.</strong> A 5-day intensive workshop on data integrity, community organizing, and safety protocols.</li>
        </ul>

        <h4>Phase 3: Mass Deployment (Months 7-15)</h4>
        <ul>
          <li><strong>Activity 3.1: Village Activation.</strong> Each Coordinator trains 10 local volunteers (Total: 500 youth).</li>
          <li><strong>Activity 3.2: Monthly "Data Dives".</strong> Synchronized coastal cleanup and auditing events across all pilot sites to create comparable datasets.</li>
        </ul>

        <h4>Phase 4: Synthesis & Policy Advocacy (Months 16-18)</h4>
        <ul>
          <li><strong>Activity 4.1: Data Visualization Workshop.</strong> Teaching youth how to turn spreadsheets into infographics.</li>
          <li><strong>Activity 4.2: Town Halls (Musrenbangdes).</strong> Youth present their "Village Ocean Reports" formally to local government to influence the next fiscal year's budget planning.</li>
        </ul>
      ` 
    },
    { 
      key: 'logframe', 
      content: `
        <h3>5. Logical Framework (LogFrame) & Indicators</h3>
        <table border="1" cellpadding="10" style="border-collapse: collapse; width: 100%; border-color: #ddd;">
          <tr style="background-color: #f2f2f2;">
            <th>Hierarchy</th>
            <th>Indicators (KPIs)</th>
            <th>Means of Verification</th>
          </tr>
          <tr>
            <td><strong>Impact</strong> (Long Term)</td>
            <td>Increased resilience of coastal communities against marine pollution.</td>
            <td>Local government budget allocation for waste management increases by 20% in target villages.</td>
          </tr>
          <tr>
            <td><strong>Outcome</strong> (Medium Term)</td>
            <td>Establishment of a reliable, community-sourced marine database.</td>
            <td>5 "Village Ocean Reports" formally accepted by Dinas Lingkungan Hidup.</td>
          </tr>
          <tr>
            <td><strong>Outputs</strong> (Short Term)</td>
            <td>
              1. 500 Youth trained.<br>
              2. 10 Tons of debris removed & audited.<br>
              3. App deployed with >1,000 unique data points.
            </td>
            <td>Training attendance lists, App database logs, Weigh station receipts.</td>
          </tr>
        </table>
      ` 
    },
    { 
      key: 'budget_narrative', 
      content: `
        <h3>6. Budget Narrative & Justification</h3>
        <p><strong>Total Request: $85,000 USD</strong></p>
        
        <h4>A. Personnel (30% - $25,500)</h4>
        <p>This project is human-capital intensive. The budget covers a full-time Project Manager, a Technical Lead (for App maintenance), and stipends for 5 Regional Field Coordinators. <em>Note: We pay above minimum wage to ensure retention of high-quality talent.</em></p>
        
        <h4>B. Program Activities (40% - $34,000)</h4>
        <p>Includes logistics for the "ToT Bootcamp" (accommodation, transport for 50 people), safety gear (gloves, boots) for 500 volunteers, and local transport for monthly audits. Also covers the "Town Hall" meeting costs (snacks/venue) for advocacy sessions.</p>
        
        <h4>C. Technology & Data (15% - $12,750)</h4>
        <p>Covers server hosting (cloud), domain registration, and procurement of 10 ruggedized tablets for communal use in villages where youth do not own smartphones.</p>
        
        <h4>D. Monitoring & Overhead (15% - $12,750)</h4>
        <p>Independent external audit (required by law for NGOs), bank fees, and administrative overhead (office rent/utilities).</p>
      ` 
    },
    { 
      key: 'sustainability', 
      content: `
        <h3>7. Sustainability & Exit Strategy</h3>
        <p><strong>Technical Sustainability:</strong> The "LautKita" app code will be open-sourced on GitHub. Local university partners (e.g., UNHAS, UNPATTI) have signed MOUs to maintain the server post-project.</p>
        <p><strong>Financial Sustainability:</strong> By integrating the waste management plan into the <em>Village Fund (Dana Desa)</em>, the operational costs for waste collection will be absorbed by the local government budget, removing dependency on external grants.</p>
      ` 
    }
  ] 
},
    conference_paper: { 
  title: 'Adaptive Attention Mechanisms in Transformer Architectures', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>Recent advances in transformer models have relied on fixed attention patterns. This paper proposes a novel adaptive attention mechanism that dynamically adjusts receptive fields based on input complexity. Experiments on GLUE and SuperGLUE benchmarks show a 2.3% average improvement while reducing FLOPs by 15%.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The transformer architecture has become ubiquitous in NLP. However, its fixed attention patterns may be suboptimal for varying input lengths and complexities. We introduce AdaAttn, a module that learns to allocate attention spans per layer and head. We demonstrate its effectiveness on multiple tasks.</p>` },
    { key: 'related_work', content: `<h3>2. Related Work</h3><p>Previous work has explored sparse attention (Child et al., 2019) and adaptive computation time (Graves, 2016). Our work differs by making attention span a learnable parameter conditioned on input.</p>` },
    { key: 'method', content: `<h3>3. Method</h3><p>We augment each attention head with a learnable gate that controls the effective context size. The gate is a sigmoid over a learned embedding. The model is trained end-to-end with the standard cross-entropy loss.</p>` },
    { key: 'experiments', content: `<h3>4. Experiments</h3><p>We evaluate on GLUE (Wang et al., 2018) and SuperGLUE. We compare against BERT-base and RoBERTa-base. Results show AdaAttn outperforms baselines on 7 out of 11 tasks.</p>` },
    { key: 'conclusion', content: `<h3>5. Conclusion</h3><p>We presented an adaptive attention mechanism that improves efficiency and performance. Future work includes applying it to long-document tasks.</p>` }
  ] 
},
research_report: { 
  title: 'Urban Mobility Transitions in Post-Pandemic Cities', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This report examines shifts in urban mobility patterns following the COVID-19 pandemic. Using data from 12 global cities, we identify a sustained increase in cycling and micro-mobility usage, and a decline in public transit ridership. Recommendations for urban planners are provided.</p>` },
    { key: 'background', content: `<h3>1. Background</h3><p>The pandemic accelerated changes in how people move. Lockdowns led to a temporary drop in all travel, but as economies reopen, modal splits have shifted. This study investigates whether these changes are temporary or permanent.</p>` },
    { key: 'methodology', content: `<h3>2. Methodology</h3><p>We collected anonymized mobile phone data, public transport usage statistics, and cycling counts from 12 cities across North America, Europe, and Asia. Data spans 2019‚Äì2023. We applied interrupted time series analysis.</p>` },
    { key: 'findings', content: `<h3>3. Findings</h3><p>Cycling increased by an average of 42% compared to pre-pandemic levels. Public transit ridership remains 25% below 2019 levels. Car usage has returned to near pre-pandemic levels. Significant variation exists between cities.</p>` },
    { key: 'recommendations', content: `<h3>4. Recommendations</h3><p>Cities should invest in protected cycling infrastructure, reconsider road space allocation, and explore integrated mobility-as-a-service platforms to boost public transit.</p>` }
  ] 
},
working_paper: { 
  title: 'Generative AI and Labor Market Dynamics: A Preliminary Analysis', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This working paper explores the early impact of generative AI on employment across sectors. Using job posting data from 2022‚Äì2024, we find that occupations involving writing and coding are experiencing significant shifts, with a 12% decline in entry-level postings. We discuss implications for workforce development.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The rapid adoption of generative AI tools like ChatGPT has raised concerns about job displacement. This paper provides preliminary evidence on how firms are adjusting their hiring.</p>` },
    { key: 'literature_review', content: `<h3>2. Literature Review</h3><p>Previous studies on automation (Acemoglu & Restrepo, 2020) have focused on routine tasks. Generative AI targets non-routine cognitive tasks, suggesting a new wave of automation.</p>` },
    { key: 'theoretical_framework', content: `<h3>3. Theoretical Framework</h3><p>We draw on task-based models of labor demand, where AI substitutes for certain tasks and complements others.</p>` },
    { key: 'preliminary_analysis', content: `<h3>4. Preliminary Analysis</h3><p>Using Burning Glass Technologies data, we analyze job postings in 10 occupational groups. We find significant declines in writing-intensive roles, but increases in AI-related roles.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>These early trends suggest a need for reskilling programs and updated labor market policies.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>Ongoing research will refine these estimates and explore heterogeneity by firm size and industry.</p>` }
  ] 
},
dissertation_thesis: { 
  title: 'Essays on the Economics of Digital Platforms', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This dissertation comprises three essays examining the economic effects of digital platforms. The first essay studies market power in app stores. The second analyzes labor supply on gig platforms. The third investigates algorithmic pricing and collusion. Using a combination of structural models and reduced-form methods, I find significant welfare implications for consumers and workers.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>Digital platforms have transformed markets, but their economic impacts are not fully understood. This dissertation aims to fill that gap.</p>` },
    { key: 'literature_review', content: `<h3>2. Literature Review</h3><p>I review the literature on two-sided markets, platform governance, and gig economy.</p>` },
    { key: 'methodology', content: `<h3>3. Methodology</h3><p>Essay 1 uses a differentiated products demand model. Essay 2 applies dynamic panel data methods. Essay 3 uses algorithmic collusion simulations.</p>` },
    { key: 'findings', content: `<h3>4. Findings</h3><p>I find that app store fees lead to higher consumer prices; gig workers face significant earnings volatility; and algorithmic pricing can sustain collusion without communication.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>The results have implications for antitrust policy and labor regulation.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>Future work should explore platform design interventions.</p>` },
    { key: 'references', content: `<h3>References</h3><p>[1] Rochet, J.-C., & Tirole, J. (2003). Platform competition...<br>[2] etc.</p>` }
  ] 
},
policy_brief: { 
  title: 'Policy Brief: Mengubah Data Menjadi Dana ‚Äî Integrasi Sains Warga dalam Alokasi Dana Desa untuk Penanganan Sampah Laut', 
  sections: [
    { 
      key: 'executive_summary', 
      content: `
        <h3>Executive Summary</h3>
        <p><strong>Masalah:</strong> Indonesia adalah penyumbang sampah laut terbesar kedua di dunia, namun kebijakan penanganan sampah di tingkat desa seringkali tidak efektif karena "kebutaan data". Pemerintah Desa mengalokasikan Dana Desa tanpa basis data yang jelas mengenai jenis dan sumber sampah lokal.</p>
        <p><strong>Rekomendasi:</strong> Brief ini merekomendasikan Kementerian Desa (Kemendes PDTT) untuk mewajibkan <strong>"Audit Sampah Berbasis Warga"</strong> sebagai prasyarat pencairan Dana Desa untuk pos lingkungan. Dengan mengadopsi model <em>Citizen Science</em> (seperti pilot project "Nusantara Blue Guardians"), efisiensi anggaran dapat meningkat hingga 40%.</p>
      ` 
    },
    { 
      key: 'context_problem', 
      content: `
        <h3>1. Konteks & Masalah: Paradoks Anggaran Desa</h3>
        <p>Sejak 2015, Pemerintah telah menyalurkan lebih dari Rp400 Triliun Dana Desa. Namun, riset lapangan di Indonesia Timur menunjukkan dua masalah kronis:</p>
        <ul>
          <li><strong>Inefisiensi Belanja:</strong> Desa sering membeli tong sampah mahal atau motor sampah yang berakhir mangkrak (rusak) karena tidak sesuai topografi wilayah.</li>
          <li><strong>Data Nasional vs Realitas Lokal:</strong> Kebijakan nasional fokus pada "plastik sekali pakai", padahal di desa pesisir tertentu, 60% sampah adalah alat tangkap ikan (jaring hantu) yang butuh penanganan berbeda. Tanpa data lokal, solusi menjadi salah sasaran.</li>
        </ul>
      ` 
    },
    { 
      key: 'critique', 
      content: `
        <h3>2. Kritik Kebijakan Eksisting</h3>
        <p>Pendekatan <em>top-down</em> saat ini (seperti "Bank Sampah" yang diseragamkan) sering gagal karena:</p>
        <ol>
          <li>Tidak ada insentif bagi pemuda desa untuk terlibat (dianggap kerja bakti sukarela).</li>
          <li>Pelaporan manual yang rentan dimanipulasi (ABS: Asal Bapak Senang).</li>
          <li>Ketergantungan pada konsultan luar yang mahal dan tidak berkelanjutan.</li>
        </ol>
      ` 
    },
    { 
      key: 'evidence_table', 
      content: `
        <h3>3. Bukti Studi Kasus: Pilot Project "Nusantara Blue Guardians"</h3>
        <p>Perbandingan efektivitas antara metode konvensional vs metode berbasis data (Citizen Science) di 3 desa pilot di Maluku:</p>
        
        <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%; text-align: left;">
          <thead style="background-color: #f2f2f2;">
            <tr>
              <th>Indikator</th>
              <th>Metode Lama (Kerja Bakti)</th>
              <th>Metode Baru (Citizen Science App)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><strong>Akurasi Data</strong></td>
              <td>Estimasi mata ("Kira-kira 1 truk")</td>
              <td>Timbangan digital & GPS Tagging (Kg/m2)</td>
            </tr>
            <tr>
              <td><strong>Biaya Operasional</strong></td>
              <td>Rp 5.000.000 / kegiatan</td>
              <td>Rp 2.500.000 / kegiatan</td>
            </tr>
            <tr>
              <td><strong>Partisipasi Pemuda</strong></td>
              <td>Rendah (< 10 orang)</td>
              <td>Tinggi (> 50 orang) karena gamifikasi</td>
            </tr>
            <tr>
              <td><strong>Output Kebijakan</strong></td>
              <td>Sampah dibakar/dikubur</td>
              <td>Perdes Larangan Plastik Sachet</td>
            </tr>
          </tbody>
        </table>
        <p><em>Sumber: Laporan Monitoring Nusantara Blue Guardians, 2024.</em></p>
      ` 
    },
    { 
      key: 'policy_recommendations', 
      content: `
        <h3>4. Rekomendasi Kebijakan</h3>
        <p>Untuk mereplikasi kesuksesan ini secara nasional, kami mendesak para pembuat kebijakan untuk:</p>
        
        <div style="background:#e8f4fd; padding:15px; border-left: 5px solid #2196F3; margin-bottom: 10px;">
          <strong>A. Mandat Data (Data-Driven Mandate)</strong><br>
          Kemendes PDTT harus merevisi Permendesa tentang Prioritas Penggunaan Dana Desa. Masukkan klausul: <em>"Pengadaan infrastruktur sampah harus didasari oleh Audit Sampah minimal 3 bulan."</em>
        </div>

        <div style="background:#e8f4fd; padding:15px; border-left: 5px solid #2196F3; margin-bottom: 10px;">
          <strong>B. Insentif Kader Digital (Green Jobs)</strong><br>
          Legalisasi alokasi Dana Desa untuk membayar honor "Kader Data Lingkungan" (pemuda desa) setara dengan Kader Posyandu. Ini menciptakan lapangan kerja hijau bagi pemuda.
        </div>

        <div style="background:#e8f4fd; padding:15px; border-left: 5px solid #2196F3;">
          <strong>C. Adopsi Teknologi Terbuka</strong><br>
          Dinas Pemberdayaan Masyarakat Desa (DPMD) harus mengadopsi platform terbuka (seperti "LautKita") sebagai standar pelaporan, menggantikan laporan kertas manual.
        </div>
      ` 
    },
    { 
      key: 'implications', 
      content: `
        <h3>5. Implikasi</h3>
        <p>Jika kebijakan ini diterapkan di 1.000 desa pesisir prioritas, diproyeksikan:</p>
        <ul>
          <li><strong>Ekonomi:</strong> Penghematan anggaran negara hingga Rp 50 Miliar per tahun dari efisiensi pengadaan alat.</li>
          <li><strong>Sosial:</strong> Penyerapan 5.000 tenaga kerja pemuda desa sebagai "Data Auditor".</li>
          <li><strong>Lingkungan:</strong> Reduksi kebocoran sampah ke laut sebesar 30% dalam 2 tahun pertama.</li>
        </ul>
      ` 
    }
  ] 
},
policy_paper: { 
  title: 'Reforming the Renewable Energy Subsidy Framework',

  sections: [

    {
      key: 'executive_summary',
      content: `
      <h2>Executive Summary</h2>
      <p>
      Renewable energy subsidies have accelerated deployment but now generate fiscal inefficiencies,
      regressive distributional effects, and market distortions. This policy paper evaluates three
      reform pathways: (1) a carbon tax with revenue recycling, (2) a clean energy standard (CES),
      and (3) technology-neutral competitive auctions.
      </p>

      <ul>
        <li><strong>Problem:</strong> Fragmented and technology-specific subsidies distort competition.</li>
        <li><strong>Finding:</strong> Technology-neutral auctions deliver the highest cost efficiency.</li>
        <li><strong>Risk:</strong> Political resistance and design complexity.</li>
        <li><strong>Recommendation:</strong> Gradual transition toward auctions combined with a carbon price floor.</li>
      </ul>

      <p>
      A phased reform over five years is recommended to ensure fiscal sustainability,
      investor certainty, and social equity.
      </p>
      `
    },

    {
      key: 'introduction',
      content: `
      <h2>1. Introduction</h2>
      <p>
      Governments worldwide have used subsidies to accelerate renewable energy deployment.
      While effective in early market formation, long-term reliance on production tax credits
      and feed-in tariffs has created structural inefficiencies.
      </p>

      <h3>Purpose of This Paper</h3>
      <ul>
        <li>Assess current subsidy distortions</li>
        <li>Evaluate reform alternatives</li>
        <li>Recommend a politically feasible transition pathway</li>
      </ul>
      `
    },

    {
      key: 'problem_definition',
      content: `
      <h2>2. Problem Definition</h2>

      <h3>2.1 Market Distortions</h3>
      <p>
      Subsidies vary widely by technology, leading to misallocation of capital
      and higher consumer costs.
      </p>

      <h3>2.2 Fiscal Burden</h3>
      <ul>
        <li>Escalating budgetary commitments</li>
        <li>Long-term subsidy lock-in</li>
        <li>Limited sunset mechanisms</li>
      </ul>

      <h3>2.3 Equity Concerns</h3>
      <p>
      Higher-income households capture disproportionate benefits through rooftop
      solar incentives and tax-based credits.
      </p>
      `
    },

    {
      key: 'policy_options',
      content: `
      <h2>3. Policy Options</h2>

      <h3>Option A: Carbon Tax with Revenue Recycling</h3>
      <ul>
        <li>Economy-wide carbon pricing</li>
        <li>Revenue returned via rebates or tax cuts</li>
        <li>Strong efficiency signal</li>
      </ul>

      <h3>Option B: Clean Energy Standard (CES)</h3>
      <ul>
        <li>Mandated percentage of clean generation</li>
        <li>Tradable compliance credits</li>
        <li>Technology flexibility</li>
      </ul>

      <h3>Option C: Technology-Neutral Auctions</h3>
      <ul>
        <li>Competitive bidding for capacity</li>
        <li>Lowest-cost allocation</li>
        <li>Transparent procurement mechanism</li>
      </ul>
      `
    },

    {
      key: 'comparative_analysis',
      content: `
      <h2>4. Comparative Analysis</h2>

      <h3>Evaluation Criteria</h3>
      <ul>
        <li>Cost-effectiveness</li>
        <li>Equity</li>
        <li>Political feasibility</li>
        <li>Administrative complexity</li>
      </ul>

      <h3>Findings</h3>
      <p>
      Auctions score highest on cost efficiency, while carbon taxes
      provide superior economic signals but face political resistance.
      CES offers moderate feasibility but lower price transparency.
      </p>
      `
    },

    {
      key: 'economic_modeling',
      content: `
      <h2>5. Economic Modeling & Fiscal Impact</h2>
      <p>
      Simulation results indicate that transitioning to auctions
      could reduce subsidy expenditures by 18‚Äì25% over a decade.
      </p>

      <ul>
        <li>Reduced consumer electricity prices</li>
        <li>Improved capital allocation efficiency</li>
        <li>Lower long-term fiscal liabilities</li>
      </ul>
      `
    },

    {
      key: 'risk_assessment',
      content: `
      <h2>6. Risk Assessment</h2>

      <ul>
        <li>Regulatory capture risk</li>
        <li>Underbidding and project non-completion</li>
        <li>Political backlash from incumbent industries</li>
      </ul>

      <p>
      Mitigation requires robust prequalification standards
      and performance guarantees.
      </p>
      `
    },

    {
      key: 'recommendations',
      content: `
      <h2>7. Policy Recommendations</h2>

      <ul>
        <li>Adopt technology-neutral auctions for all new capacity</li>
        <li>Introduce a carbon price floor</li>
        <li>Phase out production tax credits over five years</li>
        <li>Create set-asides for emerging technologies</li>
      </ul>
      `
    },

    {
      key: 'implementation',
      content: `
      <h2>8. Implementation Roadmap</h2>

      <h3>Phase 1 (Year 1‚Äì2)</h3>
      <ul>
        <li>Legislative reform</li>
        <li>Institutional setup</li>
      </ul>

      <h3>Phase 2 (Year 3‚Äì5)</h3>
      <ul>
        <li>Gradual subsidy phase-out</li>
        <li>Scaling competitive auctions</li>
      </ul>
      `
    },

    {
      key: 'monitoring_evaluation',
      content: `
      <h2>9. Monitoring & Evaluation</h2>

      <ul>
        <li>Annual cost-per-MWh tracking</li>
        <li>Equity impact analysis</li>
        <li>Market concentration indicators</li>
      </ul>

      <p>
      Independent review mechanisms should ensure transparency and
      adaptive learning.
      </p>
      `
    },

    {
      key: 'conclusion',
      content: `
      <h2>10. Conclusion</h2>
      <p>
      Renewable energy subsidy reform is necessary to ensure fiscal
      sustainability, economic efficiency, and social equity.
      A phased transition to technology-neutral auctions combined
      with a carbon price floor offers the most balanced solution.
      </p>
      `
    }

  ]
},
white_paper: { 
  title: 'Zero-Trust Architecture for Cloud Security', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>As organizations migrate to the cloud, traditional perimeter-based security is inadequate. Zero-trust architecture (ZTA) assumes no implicit trust and verifies every access request. This white paper outlines a framework for implementing ZTA, including key components and deployment roadmap.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The rise of remote work and cloud services has blurred network perimeters. ZTA offers a more robust security model.</p>` },
    { key: 'current_challenges', content: `<h3>2. Current Challenges</h3><p>VPN vulnerabilities, insider threats, and complex identity management.</p>` },
    { key: 'proposed_solution', content: `<h3>3. Proposed Solution</h3><p>Implement ZTA using micro-segmentation, continuous monitoring, and identity-aware proxies.</p>` },
    { key: 'benefits', content: `<h3>4. Benefits</h3><p>Reduced attack surface, improved compliance, and better user experience.</p>` },
    { key: 'roadmap', content: `<h3>5. Roadmap</h3><p>Phase 1: Inventory and classify assets. Phase 2: Deploy identity and access management. Phase 3: Implement micro-segmentation. Phase 4: Continuous monitoring and analytics.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>ZTA is essential for modern cloud security. Organizations should start now.</p>` }
  ] 
},
position_paper: { 
  title: 'Position on Data Localization Requirements', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This paper presents the Chamber of Commerce's position on data localization laws. While we recognize data privacy concerns, we argue that mandatory data localization harms trade, increases costs, and does not necessarily improve security. We advocate for interoperability frameworks and cross-border data flows with strong privacy safeguards.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>Several countries have introduced data localization requirements. This paper examines their impact.</p>` },
    { key: 'stance', content: `<h3>2. Stance</h3><p>We oppose mandatory data localization. Instead, we support mutual recognition of privacy regimes.</p>` },
    { key: 'arguments', content: `<h3>3. Arguments</h3><p>Localization raises costs for SMEs, fragments the internet, and can lead to trade retaliation.</p>` },
    { key: 'counterarguments', content: `<h3>4. Counterarguments</h3><p>Proponents argue localization protects privacy and national security. However, existing privacy laws like GDPR already provide strong protections without localization.</p>` },
    { key: 'conclusion', content: `<h3>5. Conclusion</h3><p>We urge policymakers to reject data localization and pursue international agreements on data flows.</p>` }
  ] 
},
technical_report: { 
  title: 'Performance Evaluation of LoRaWAN in Urban Environments', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This technical report evaluates the performance of LoRaWAN networks in dense urban settings. We deployed 20 gateways and 500 end devices across a 10 km¬≤ area. Results show a packet delivery ratio of 92% for distances up to 2 km, but significant interference in high-rise zones. Recommendations for network planning are provided.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>LoRaWAN is a popular LPWAN technology, but its performance in urban canyons is not well documented.</p>` },
    { key: 'system_overview', content: `<h3>2. System Overview</h3><p>We used Multitech gateways and various end devices. The network operates at 868 MHz.</p>` },
    { key: 'methodology', content: `<h3>3. Methodology</h3><p>We measured RSSI, SNR, and packet loss at multiple locations. Data was collected over 30 days.</p>` },
    { key: 'results', content: `<h3>4. Results</h3><p>Average RSSI: -95 dBm; SNR: 6 dB; packet delivery ratio: 92% line-of-sight, 78% non-line-of-sight.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>Interference from other devices and multipath fading are major issues. Increasing gateway density can mitigate.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>LoRaWAN is viable for urban IoT but requires careful planning.</p>` }
  ] 
},
guideline_sop: { 
  title: 'Standard Operating Procedure for Clinical Trial Data Management', 
  sections: [
    { key: 'purpose', content: `<h3>1. Purpose</h3><p>This SOP defines the procedures for data collection, entry, validation, and storage in clinical trials to ensure compliance with GCP guidelines.</p>` },
    { key: 'scope', content: `<h3>2. Scope</h3><p>Applies to all clinical trial staff involved in data management.</p>` },
    { key: 'definitions', content: `<h3>3. Definitions</h3><p>CRF: Case Report Form; eCRF: electronic Case Report Form; Query: request for clarification.</p>` },
    { key: 'responsibilities', content: `<h3>4. Responsibilities</h3><p>Data Manager: oversees data entry and validation. CRA: monitors data quality. Investigator: ensures accuracy.</p>` },
    { key: 'procedure', content: `<h3>5. Procedure</h3><ol><li>Data entry within 5 days of visit.</li><li>Automated validation checks.</li><li>Query resolution within 3 days.</li><li>Database lock after final monitoring visit.</li></ol>` },
    { key: 'compliance', content: `<h3>6. Compliance</h3><p>Non-compliance will be reported to QA and may result in corrective action.</p>` },
    { key: 'references', content: `<h3>7. References</h3><p>ICH GCP E6(R2); 21 CFR Part 11.</p>` }
  ] 
},
regulatory_impact_assessment: { 
  title: 'RIA of Proposed Fuel Economy Standards for Light-Duty Vehicles', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This RIA assesses the proposed rule to increase average fuel economy to 55 mpg by 2026. Benefits include reduced greenhouse gas emissions and fuel savings, while costs include higher vehicle prices. Net benefits are estimated at $150 billion over 30 years.</p>` },
    { key: 'problem_identification', content: `<h3>1. Problem Identification</h3><p>Transportation accounts for 29% of U.S. GHG emissions. Current standards are insufficient to meet climate goals.</p>` },
    { key: 'objectives', content: `<h3>2. Objectives</h3><p>Reduce emissions, reduce oil dependence, and provide consumer savings.</p>` },
    { key: 'options', content: `<h3>3. Options</h3><p>Option 1: No action. Option 2: 50 mpg by 2026. Option 3: 55 mpg by 2026 (preferred). Option 4: 60 mpg by 2026.</p>` },
    { key: 'impact_analysis', content: `<h3>4. Impact Analysis</h3><p>Option 3 yields the highest net benefits. Costs: +$1,500 per vehicle. Benefits: $4,000 fuel savings per vehicle over lifetime, 200 Mt CO2 reduction.</p>` },
    { key: 'consultation', content: `<h3>5. Consultation</h3><p>Stakeholder comments from automakers, environmental groups, and consumers were considered.</p>` },
    { key: 'recommendation', content: `<h3>6. Recommendation</h3><p>Adopt Option 3 with a phased implementation.</p>` }
  ] 
}}
      /* ------------------------------------------------------------- */

// 2. GUIDANCE ENGINE (Panduan Bilingual - EN & ID)
/* --- AREA EDIT (PAK ANGGA): TAMBAH GUIDANCE BARU DI SINI --- */
const GUIDANCE = {
  journal_article: {
    _analogy: { 
      en: 'A journal article is a courtroom argument. You are the lawyer, the data is your evidence, and the reviewers are the jury.', 
      id: 'Artikel jurnal ibarat argumen di pengadilan. Anda pengacaranya, data adalah barang bukti, dan reviewer adalah jurinya.' 
    },
    abstract: { 
      en: { 
        what: `
          <p>The Abstract is the <strong>"Movie Trailer"</strong> of your research. In 150‚Äì250 words, it must provide a complete standalone summary.</p>
          <h4>Structure it strictly (1-2 sentences each):</h4>
          <ul>
            <li><strong>Context/Hook:</strong> What is the broad issue?</li>
            <li><strong>The Gap:</strong> What is missing in current knowledge?</li>
            <li><strong>Objective:</strong> What did this study do?</li>
            <li><strong>Methodology:</strong> How did you do it? (Tools/Methods)</li>
            <li><strong>Results:</strong> What did you find? (Be specific with numbers!)</li>
            <li><strong>Implication:</strong> So what? Why does it matter?</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Pro Tip:</strong> Write the Abstract LAST. You cannot summarize a paper that hasn't been written yet.
          </div>
          <p>Check the journal's word count limit religiously (usually 200 or 250 words).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Common Pitfalls:</strong>
            <ul>
              <li><strong>Citations:</strong> Never cite other authors here unless absolutely necessary.</li>
              <li><strong>Undefined Abbreviations:</strong> Don't use "SEM" without spelling it out first.</li>
              <li><strong>Vague Results:</strong> Avoid "Results were discussed". Say "Results showed a 20% increase".</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Abstrak adalah <strong>"Trailer Film"</strong> dari riset Anda. Dalam 150‚Äì250 kata, ia harus menyajikan ringkasan lengkap dan mandiri.</p>
          <h4>Struktur Wajib (1-2 kalimat per poin):</h4>
          <ul>
            <li><strong>Konteks:</strong> Apa isu besarnya?</li>
            <li><strong>Celah (Gap):</strong> Apa yang hilang dari pengetahuan saat ini?</li>
            <li><strong>Tujuan:</strong> Apa yang studi ini lakukan?</li>
            <li><strong>Metodologi:</strong> Bagaimana caranya? (Alat/Metode)</li>
            <li><strong>Hasil:</strong> Apa temuannya? (Harus angka/fakta spesifik!)</li>
            <li><strong>Implikasi:</strong> Kenapa ini penting?</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Tips Pro:</strong> Tulis Abstrak TERAKHIR. Anda tidak bisa meringkas makalah yang belum ditulis.
          </div>
          <p>Pastikan kata kunci dimaksimalkan untuk SEO agar mudah ditemukan di Google Scholar.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari Hal Ini:</strong>
            <ul>
              <li><strong>Sitasi:</strong> Jangan mengutip orang lain di sini.</li>
              <li><strong>Singkatan:</strong> Jangan pakai singkatan aneh tanpa penjelasan.</li>
              <li><strong>Hasil Samar:</strong> Jangan tulis "Hasil didiskusikan". Tulis "Hasil menunjukkan kenaikan 20%".</li>
            </ul>
          </div>
        `
      } 
    },
    introduction: {
      en: {
        what: `
          <p>The Introduction sets the stage. Use the <strong>"Funnel Method"</strong>: start broad and narrow down to your specific research question.</p>
          <h4>Key Components:</h4>
          <ol>
            <li><strong>The Hook:</strong> Start with the general topic that appeals to a wide audience.</li>
            <li><strong>State of the Art:</strong> Briefly summarize recent major studies (Group them by themes).</li>
            <li><strong>The Gap:</strong> What is missing? Is existing research outdated? Wrong context?</li>
            <li><strong>The Solution:</strong> Clearly state your Research Question (RQ).</li>
            <li><strong>Roadmap:</strong> Briefly outline the paper structure.</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Argument, not History:</strong> Every paragraph should lead the reader closer to your Research Question.
          </div>
          <p>Cite heavily here. Show the editor you have read the relevant, up-to-date (last 5-10 years) literature.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>The "Dawn of Man":</strong> Don't start with "Since the beginning of time...".</li>
              <li><strong>The Mystery Reveal:</strong> Don't hide your research question. State it clearly on page 2 or 3.</li>
              <li><strong>No Gap:</strong> If you can't articulate what is MISSING, you have no justification for publication.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Pendahuluan menyiapkan panggung. Gunakan <strong>"Metode Corong"</strong>: mulai dari hal luas, menyempit ke pertanyaan riset spesifik Anda.</p>
          <h4>Komponen Kunci:</h4>
          <ol>
            <li><strong>Pancingan (Hook):</strong> Mulai dengan topik umum yang menarik audiens luas.</li>
            <li><strong>State of the Art:</strong> Rangkum temuan studi terbaru (Kelompokkan per tema).</li>
            <li><strong>Celah (Gap):</strong> Apa yang kurang? Apakah riset lama kadaluarsa? Salah konteks?</li>
            <li><strong>Solusi:</strong> Nyatakan Pertanyaan Riset (RQ) dengan jelas.</li>
            <li><strong>Peta Jalan:</strong> Rangkum sistematika penulisan.</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Argumen, bukan Sejarah:</strong> Setiap paragraf harus menuntun pembaca makin dekat ke Pertanyaan Riset Anda.
          </div>
          <p>Banyak sitasi di sini. Tunjukkan Anda membaca literatur 5-10 tahun terakhir.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Pembukaan "Zaman Batu":</strong> Jangan mulai dengan "Sejak awal peradaban...".</li>
              <li><strong>Rahasia Detektif:</strong> Jangan sembunyikan pertanyaan riset. Nyatakan di halaman 2 atau 3.</li>
              <li><strong>Tanpa Celah:</strong> Jika tak bisa jelaskan apa yang HILANG di sains, riset Anda tak punya alasan terbit.</li>
            </ul>
          </div>
        `
      }
    },
    framework: {
      en: {
        what: `
          <p>The Framework is the <strong>"Lens"</strong> through which you view your data. It is not just a glossary; it is a map explaining relationships.</p>
          <h4>Choose your type:</h4>
          <ul>
            <li><strong>Conceptual Framework (Quant):</strong> Shows X and Y variables and hypothesized arrows.</li>
            <li><strong>Theoretical Framework (Qual):</strong> A theory (e.g., Foucault's Power) that sensitizes you to patterns.</li>
          </ul>
          <p>You must explain <em>WHY</em> you chose this framework.</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Draw it!</strong> A diagram (Figure 1) is worth a thousand words here.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>The Dictionary:</strong> Just listing definitions without connecting them.</li>
              <li><strong>Disconnected Framework:</strong> Using a theory here that never appears again in the Discussion.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Kerangka adalah <strong>"Kacamata"</strong> untuk melihat data. Bukan sekadar kamus istilah, tapi peta hubungan antar konsep.</p>
          <h4>Pilih jenisnya:</h4>
          <ul>
            <li><strong>Kerangka Konseptual (Kuantitatif):</strong> Tunjukkan variabel X dan Y serta panah hipotesis.</li>
            <li><strong>Kerangka Teori (Kualitatif):</strong> Teori (misal: Kekuasaan Foucault) yang membuat peka terhadap pola data.</li>
          </ul>
          <p>Jelaskan <em>KENAPA</em> Anda memilih kerangka ini.</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Gambarkan!</strong> Diagram (Gambar 1) bernilai seribu kata di sini.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Kamus Berjalan:</strong> Cuma daftar definisi tanpa menghubungkannya.</li>
              <li><strong>Kerangka Putus:</strong> Pakai teori di sini tapi tidak dipakai lagi saat membahas hasil (Diskusi).</li>
            </ul>
          </div>
        `
      }
    },
    methodology: {
      en: {
        what: `
          <p>The Methodology is the <strong>"Recipe"</strong>. It must be detailed enough that another scientist could replicate your study exactly.</p>
          <h4>Cover these 3 Pillars:</h4>
          <ul>
            <li><strong>Sampling:</strong> Who? How many? Why them? (e.g., Purposive sampling of 50 teachers).</li>
            <li><strong>Data Collection:</strong> How? What tools? (Validity & Reliability checks).</li>
            <li><strong>Data Analysis:</strong> How did you process the mess? (e.g., Thematic analysis with NVivo).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Use Past Tense:</strong> Write "We measured" (done), not "We will measure" (proposal).
          </div>
          <p>Explicitly mention <strong>Ethics</strong> (Consent, Anonymity).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>The Black Box:</strong> Saying "data was analyzed" without explaining HOW.</li>
              <li><strong>Ignoring Bias:</strong> Failing to mention limitations in your sampling.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Metodologi adalah <strong>"Resep Masakan"</strong>. Harus cukup detail agar ilmuwan lain bisa mengulang studi Anda persis sama.</p>
          <h4>Cakup 3 Pilar Ini:</h4>
          <ul>
            <li><strong>Sampling:</strong> Siapa? Berapa banyak? Kenapa? (cth: Purposive sampling 50 guru).</li>
            <li><strong>Pengumpulan Data:</strong> Alat apa? (Cek Validitas & Reliabilitas).</li>
            <li><strong>Analisis Data:</strong> Bagaimana memproses data? (cth: Analisis tematik dengan NVivo).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Pakai Kata Lampau:</strong> Tulis "Kami mengukur" (sudah), bukan "Kami akan mengukur".
          </div>
          <p>Sebutkan <strong>Etika</strong> secara eksplisit (Izin, Anonimitas).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Kotak Hitam:</strong> Bilang "data dianalisis" tanpa jelaskan CARANYA.</li>
              <li><strong>Abaikan Bias:</strong> Gagal menyebutkan keterbatasan dalam sampling Anda.</li>
            </ul>
          </div>
        `
      }
    },
    findings: {
      en: {
        what: `
          <p>This section is for <strong>"Data Only"</strong>. A neutral report of what you found. Do not interpret yet.</p>
          <h4>The Sandwich Method:</h4>
          <ol>
            <li><strong>Top Bun:</strong> Introduce the table/graph ("Table 1 shows...").</li>
            <li><strong>Meat:</strong> The Visual itself (Table/Chart).</li>
            <li><strong>Bottom Bun:</strong> Highlight key numbers ("As shown, 70% agreed...").</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Be Concise:</strong> Don't repeat every number from the table in the text; just highlight the most significant ones.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>Interpreting too early:</strong> Don't say "This suggests..." (Save for Discussion).</li>
              <li><strong>Data Dumping:</strong> Pasting raw SPSS output without cleaning.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Bagian ini <strong>"Hanya Data"</strong>. Laporan netral apa yang Anda temukan. Jangan interpretasi dulu.</p>
          <h4>Metode Sandwich:</h4>
          <ol>
            <li><strong>Roti Atas:</strong> Kenalkan tabel/grafik ("Tabel 1 menunjukkan...").</li>
            <li><strong>Daging:</strong> Visual itu sendiri (Tabel/Grafik).</li>
            <li><strong>Roti Bawah:</strong> Soroti angka kunci ("Terlihat 70% setuju...").</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Ringkas:</strong> Jangan ulang semua angka tabel di teks; soroti yang penting saja.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Interpretasi Dini:</strong> Jangan bilang "Ini menyarankan..." (Simpan untuk Diskusi).</li>
              <li><strong>Muntah Data:</strong> Copy-paste output mentah statistik tanpa dirapikan.</li>
            </ul>
          </div>
        `
      }
    },
    discussion: {
      en: {
        what: `
          <p>The Discussion is the <strong>"So What?"</strong>. This is where you earn your PhD. Interpret findings and link back to Theory.</p>
          <h4>Answer these questions:</h4>
          <ul>
            <li><strong>Meaning:</strong> What do the results mean?</li>
            <li><strong>Comparison:</strong> Do results agree/disagree with previous studies? Why?</li>
            <li><strong>Mechanism:</strong> <em>Why</em> did this happen? (Use your Framework).</li>
            <li><strong>Implications:</strong> Effect on policy or practice?</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Hedging:</strong> Use cautious language like "This suggests" or "It implies", rather than "This proves".
          </div>
          <p>Be honest about <strong>Limitations</strong> (Sample size, scope).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>New Results:</strong> Do not introduce new numbers here.</li>
              <li><strong>Speculation:</strong> Don't make wild claims your data doesn't support.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Diskusi adalah <strong>"Lalu Kenapa?"</strong>. Di sini nilai utama Anda. Interpretasi temuan dan hubungkan balik ke Teori.</p>
          <h4>Jawab pertanyaan ini:</h4>
          <ul>
            <li><strong>Makna:</strong> Apa arti hasil ini?</li>
            <li><strong>Perbandingan:</strong> Hasil setuju/bantah studi sebelumnya? Kenapa?</li>
            <li><strong>Mekanisme:</strong> <em>Kenapa</em> ini terjadi? (Gunakan Kerangka Anda).</li>
            <li><strong>Implikasi:</strong> Efek ke kebijakan atau praktik?</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Bahasa Hati-hati:</strong> Gunakan "Ini menyarankan" atau "Mengimplikasikan", bukan "Ini membuktikan".
          </div>
          <p>Jujur soal <strong>Keterbatasan</strong> (Ukuran sampel, cakupan).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Hasil Baru:</strong> Jangan masukkan angka baru di sini.</li>
              <li><strong>Spekulasi Liar:</strong> Jangan buat klaim yang tidak didukung data.</li>
            </ul>
          </div>
        `
      }
    },
    conclusion: {
      en: {
        what: `
          <p>The Conclusion is the <strong>"Mic Drop"</strong>. Not just a summary, but a synthesis.</p>
          <h4>Structure:</h4>
          <ol>
            <li>Restate the main answer to your Research Question.</li>
            <li>Synthesize the main points (how they fit together).</li>
            <li><strong>Practical Contribution:</strong> Who benefits?</li>
            <li><strong>Future Research:</strong> What is the next logical step?</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Consistency:</strong> Ensure your conclusion matches your introduction promise.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>Weak Endings:</strong> "More research is needed" is lazy. Be specific on WHAT research.</li>
              <li><strong>New Arguments:</strong> The trial is over. No new evidence allowed.</li>
            </ul>
          </div>
        `
      },
      id: {
        what: `
          <p>Kesimpulan adalah <strong>"Mic Drop"</strong>. Bukan sekadar ringkasan, tapi sintesis.</p>
          <h4>Struktur:</h4>
          <ol>
            <li>Nyatakan ulang jawaban utama Pertanyaan Riset.</li>
            <li>Sintesis poin utama (bagaimana saling terkait).</li>
            <li><strong>Kontribusi Praktis:</strong> Siapa yang untung?</li>
            <li><strong>Riset Masa Depan:</strong> Apa langkah logis berikutnya?</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Konsistensi:</strong> Pastikan kesimpulan menjawab janji di pendahuluan.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Ending Lemah:</strong> "Perlu riset lagi" itu malas. Spesifiklah riset APA.</li>
              <li><strong>Argumen Baru:</strong> Sidang selesai. Dilarang bawa bukti baru.</li>
            </ul>
          </div>
        `
      }
    }
  },
    project_proposal: {
    _analogy: { 
      en: 'A proposal is a sales pitch where trust is the currency. You are selling a future reality.', 
      id: 'Proposal adalah jualan di mana kepercayaan adalah mata uangnya. Anda menjual realitas masa depan.' 
    },
    executive_summary: { 
      en: { 
        what: `
          <p>This is the strategic <strong>"Front Page"</strong>. Assume the busy Minister or CEO will <em>only</em> read this page. It must stand alone.</p>
          <h4>Answer the "Wh-Questions" in a persuasive flow:</h4>
          <ol>
            <li><strong>Who are you?</strong> (Credibility & Track Record).</li>
            <li><strong>What is the problem?</strong> (The burning platform/Urgency).</li>
            <li><strong>What is the solution?</strong> (Your specific intervention).</li>
            <li><strong>How much?</strong> (Total investment required).</li>
            <li><strong>What is the ROI?</strong> (Impact/Return on Investment).</li>
          </ol>
          <p>The tone must be confident, forward-looking, and solution-driven.</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>The "Hook & Anchor" Technique:</strong>
            <ul>
              <li><strong>Hook:</strong> Start with a startling statistic (e.g., "Every minute, one truckload of plastic...").</li>
              <li><strong>Anchor:</strong> End with a solid impact statement (e.g., "This $85k investment will create 500 green jobs").</li>
            </ul>
          </div>
          <p><strong>Write this section LAST.</strong> You cannot summarize what you haven't detailed yet.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Common Errors:</strong>
            <ul>
              <li><strong>Cut & Paste:</strong> Do not just copy the Introduction. This needs its own punchy flow.</li>
              <li><strong>The Mystery Novel:</strong> Don't hide the budget or solution at the end. Be direct upfront.</li>
              <li><strong>Vagueness:</strong> Avoid "We hope to...". Use "We will...".</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Ini adalah <strong>"Halaman Depan"</strong> strategis. Asumsikan Menteri atau Donor yang sibuk <em>hanya</em> akan membaca halaman ini.</p>
          <h4>Jawab "Pertanyaan 5W+1H" dengan alur persuasif:</h4>
          <ol>
            <li><strong>Siapa Anda?</strong> (Kredibilitas & Rekam Jejak).</li>
            <li><strong>Apa Masalahnya?</strong> (Urgensi/Platform yang terbakar).</li>
            <li><strong>Apa Solusinya?</strong> (Intervensi spesifik Anda).</li>
            <li><strong>Berapa Biayanya?</strong> (Total investasi).</li>
            <li><strong>Apa ROI-nya?</strong> (Dampak/Pengembalian Investasi).</li>
          </ol>
          <p>Nada harus percaya diri, visioner, dan berorientasi solusi.</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Teknik "Kail & Jangkar":</strong>
            <ul>
              <li><strong>Kail (Hook):</strong> Mulai dengan statistik mengejutkan (cth: "Tiap menit, satu truk plastik...").</li>
              <li><strong>Jangkar (Anchor):</strong> Akhiri dengan pernyataan dampak solid (cth: "Investasi $85rb ini menciptakan 500 kerja hijau").</li>
            </ul>
          </div>
          <p><strong>Tulis bagian ini TERAKHIR.</strong> Anda tidak bisa meringkas apa yang belum didetailkan.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Kesalahan Umum:</strong>
            <ul>
              <li><strong>Copy-Paste:</strong> Jangan cuma salin Pendahuluan. Bagian ini butuh "punch" tersendiri.</li>
              <li><strong>Novel Misteri:</strong> Jangan sembunyikan angka budget atau solusi di akhir. Langsung <em>to the point</em>.</li>
              <li><strong>Ragu-ragu:</strong> Hindari "Kami berharap...". Gunakan "Kami akan...".</li>
            </ul>
          </div>
        `
      } 
    },
    situational_analysis: { 
      en: { 
        what: `
          <p>This is your <strong>Diagnostic Foundation</strong>. Use the <strong>"Inverted Pyramid"</strong> structure to build a legal case for intervention.</p>
          <h4>Structure levels:</h4>
          <ul>
            <li><strong>Macro (Global/National):</strong> Link to SDGs, National Plans (RPJMN). Why does this matter globally?</li>
            <li><strong>Meso (Regional):</strong> Compare specific regions (e.g., Java vs. Maluku gap). Highlight inequality.</li>
            <li><strong>Micro (The Bleeding Wound):</strong> What exactly is broken in the target village? Use primary data/surveys.</li>
          </ul>
          <p>Include a <strong>Stakeholder Mapping</strong>: Who are the Allies? Who are the Spoilers?</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Data is Currency:</strong> Use visuals. Refer to "Annex A" for detailed charts. Use quotes from locals to humanize the stats.
          </div>
          <p>Define the <strong>"Null Hypothesis"</strong>: What happens if we do NOTHING? (e.g., "The reef dies in 5 years").</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>Lack of Solution as Problem:</strong> Don't say "The problem is no app." Say "The problem is data blindness."</li>
              <li><strong>Outdated Data:</strong> Using 2010 stats in 2026 kills credibility.</li>
              <li><strong>Ignoring Others:</strong> Failing to mention existing gov/NGO efforts looks arrogant.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Ini adalah <strong>Fondasi Diagnostik</strong>. Gunakan struktur <strong>"Piramida Terbalik"</strong> untuk membangun argumen hukum intervensi.</p>
          <h4>Tingkatan Struktur:</h4>
          <ul>
            <li><strong>Makro (Global/Nasional):</strong> Tautkan ke SDGs, RPJMN. Kenapa ini penting secara nasional?</li>
            <li><strong>Meso (Regional):</strong> Bandingkan wilayah (misal: Ketimpangan Jawa vs Maluku).</li>
            <li><strong>Mikro (Luka Menganga):</strong> Apa persisnya yang rusak di desa target? Pakai data primer.</li>
          </ul>
          <p>Sertakan <strong>Pemetaan Aktor</strong>: Siapa Kawan (Allies)? Siapa Lawan/Penghambat (Spoilers)?</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Data adalah Mata Uang:</strong> Gunakan visual. Rujuk grafik di Lampiran. Gunakan kutipan warga untuk "memanusiakan" statistik.
          </div>
          <p>Definisikan <strong>"Hipotesis Nol"</strong>: Apa yang terjadi jika kita DIAM SAJA? (cth: "Terumbu karang mati dalam 5 tahun").</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Masalah = Tidak Ada Solusi:</strong> Jangan bilang "Masalahnya tidak ada aplikasi". Bilang "Masalahnya inefisiensi data".</li>
              <li><strong>Data Kadaluarsa:</strong> Pakai data 2010 di tahun 2026 membunuh kredibilitas.</li>
              <li><strong>Menafikan Orang Lain:</strong> Tidak sebut usaha pemerintah/NGO lain terlihat arogan.</li>
            </ul>
          </div>
        `
      } 
    },
    methodology: { 
      en: { 
        what: `
          <p>Explain the <strong>"Theory of Change"</strong>. Why will <em>these</em> activities lead to <em>those</em> results?</p>
          <h4>Core Dimensions:</h4>
          <ul>
            <li><strong>Strategic Framework:</strong> Are you using PAR? Human-Centered Design? Behavioral Nudging? Explain the logic.</li>
            <li><strong>Innovation:</strong> What is your "Secret Sauce"? (e.g., Offline-first tech, Adat integration).</li>
            <li><strong>GESI (Gender & Inclusion):</strong> <em>Mandatory.</em> How will you ensure women/disability inclusion? (Not just a checkbox).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Show, Don't Tell:</strong> Instead of saying "we are inclusive," say "we have a mandatory 50% quota for female leadership."
          </div>
          <p>Use a diagram (e.g., "Figure 1: The Data-to-Action Cycle").</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>Confusing Method with Activity:</strong> Methodology is "Strategy" (Citizen Science). Activity is "Task" (Workshop).</li>
              <li><strong>Tokenism:</strong> Just saying "women will be invited" is weak. You need an empowerment strategy.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Jelaskan <strong>"Teori Perubahan"</strong> (Theory of Change). Kenapa aktivitas <em>ini</em> menghasilkan dampak <em>itu</em>?</p>
          <h4>Dimensi Inti:</h4>
          <ul>
            <li><strong>Kerangka Strategis:</strong> Pakai PAR? Human-Centered Design? Nudging? Jelaskan logikanya.</li>
            <li><strong>Inovasi:</strong> Apa "Bumbu Rahasia" Anda? (cth: Teknologi offline, Integrasi Hukum Adat).</li>
            <li><strong>GESI (Gender & Inklusi):</strong> <em>Wajib.</em> Bagaimana memastikan pelibatan perempuan/disabilitas? (Bukan sekadar formalitas).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Tunjukkan, Jangan Cuma Bilang:</strong> Daripada bilang "kami inklusif", bilang "kami tetapkan kuota wajib 50% pemimpin perempuan".
          </div>
          <p>Gunakan diagram alur (cth: "Gambar 1: Siklus Data-ke-Aksi").</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Metode vs Aktivitas:</strong> Metodologi itu "Strategi" (Sains Warga). Aktivitas itu "Tugas" (Rapat).</li>
              <li><strong>Tokenisme:</strong> Cuma bilang "perempuan diundang" itu lemah. Butuh strategi pemberdayaan.</li>
            </ul>
          </div>
        `
      } 
    },
    technical_implementation: { 
      en: { 
        what: `
          <p>This is the <strong>"Engine Room"</strong>. Translate strategy into a concrete timeline. Donors check this for feasibility.</p>
          <h4>Structure by Phases (Work Packages):</h4>
          <ol>
            <li><strong>Phase 1: Mobilization</strong> (Hiring, Permits, Office Setup). <em>Crucial but often forgotten.</em></li>
            <li><strong>Phase 2: Development</strong> (Curriculum, App Coding, Procurement).</li>
            <li><strong>Phase 3: Deployment</strong> (Training, Field Action, Advocacy).</li>
            <li><strong>Phase 4: Monitoring & Closing</strong> (Audit, Handover, Reporting).</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Narrative Gantt Chart:</strong> Be specific. Don't say "Training". Say "5-day bootcamp for 50 pax in Makassar".
          </div>
          <p>Always add a <strong>Buffer</strong> for delays (weather, elections).</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>The Hockey Stick:</strong> Cramming 80% of work in the last 3 months.</li>
              <li><strong>Ignoring Setup:</strong> Projects never start at full speed on Day 1.</li>
              <li><strong>Vague Geographies:</strong> Be specific about location (Village/District).</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Ini adalah <strong>"Ruang Mesin"</strong>. Terjemahkan strategi jadi jadwal konkret. Donor cek ini untuk nilai kelayakan.</p>
          <h4>Struktur per Fase (Paket Kerja):</h4>
          <ol>
            <li><strong>Fase 1: Mobilisasi</strong> (Rekrutmen, Izin, Kantor). <em>Krusial tapi sering lupa.</em></li>
            <li><strong>Fase 2: Pengembangan</strong> (Kurikulum, Coding App, Belanja Alat).</li>
            <li><strong>Fase 3: Penyebaran</strong> (Pelatihan, Aksi Lapangan, Advokasi).</li>
            <li><strong>Fase 4: Monev & Penutupan</strong> (Audit, Serah Terima, Laporan).</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Narasi Gantt Chart:</strong> Spesifik. Jangan tulis "Pelatihan". Tulis "Bootcamp 5 hari untuk 50 org di Makassar".
          </div>
          <p>Selalu beri <strong>Buffer</strong> (waktu cadangan) untuk cuaca atau pemilu.</p>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Jadwal Hockey Stick:</strong> Menumpuk 80% kerjaan di 3 bulan terakhir.</li>
              <li><strong>Lupa Persiapan:</strong> Proyek tidak pernah ngebut di Hari Pertama.</li>
              <li><strong>Lokasi Samar:</strong> Tentukan Desa/Kecamatan target.</li>
            </ul>
          </div>
        `
      } 
    },
    risk_management: { 
      en: { 
        what: `
          <p>A proposal without risks is a lie. Show maturity by anticipating pitfalls.</p>
          <h4>Risk Matrix Categories:</h4>
          <ul>
            <li><strong>Political:</strong> Elections, leadership changes. (Mitigation: MOU with Institution, not Person).</li>
            <li><strong>Operational:</strong> Tech failure, weather. (Mitigation: Offline-first mode, backup boats).</li>
            <li><strong>Financial:</strong> Inflation, exchange rate. (Mitigation: Contingency fund).</li>
            <li><strong>Social:</strong> Resistance, conflict. (Mitigation: Involve Adat leaders early).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Focus on Externalities:</strong> Things outside your control. Admitting risk builds trust.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Red Flags:</strong>
            <ul>
              <li><strong>"No Risks":</strong> Immediate rejection. Amateurish.</li>
              <li><strong>Internal Risks:</strong> "Staff might quit" is a management issue, not a project risk.</li>
              <li><strong>Weak Mitigation:</strong> "We will monitor" is not a solution. "We will switch to paper" is.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Proposal tanpa risiko adalah kebohongan. Tunjukkan kedewasaan dengan antisipasi masalah.</p>
          <h4>Kategori Matriks Risiko:</h4>
          <ul>
            <li><strong>Politik:</strong> Pilkada, ganti pejabat. (Mitigasi: MOU dengan Institusi, bukan Orang).</li>
            <li><strong>Operasional:</strong> App error, cuaca buruk. (Mitigasi: Mode offline, perahu cadangan).</li>
            <li><strong>Finansial:</strong> Inflasi, kurs dolar. (Mitigasi: Dana kontingensi).</li>
            <li><strong>Sosial:</strong> Resistensi warga. (Mitigasi: Libatkan tokoh Adat di awal).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Fokus Eksternalitas:</strong> Hal di luar kendali Anda. Mengakui risiko membangun kepercayaan.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Bendera Merah:</strong>
            <ul>
              <li><strong>"Tanpa Risiko":</strong> Langsung ditolak. Terlihat amatir.</li>
              <li><strong>Risiko Internal:</strong> "Staf resign" itu isu manajemen, bukan risiko proyek.</li>
              <li><strong>Mitigasi Lemah:</strong> "Kami akan pantau" bukan solusi. "Kami beralih manual" itu solusi.</li>
            </ul>
          </div>
        `
      } 
    },
    logframe: { 
      en: { 
        what: `
          <p>The <strong>"Contract of Success"</strong>. Connects inputs to results.</p>
          <h4>The Hierarchy:</h4>
          <ul>
            <li><strong>Impact (Long-term):</strong> The vision (e.g., Reduced plastic leakage).</li>
            <li><strong>Outcome (Medium-term):</strong> Behavioral change (e.g., Village adopts data policy).</li>
            <li><strong>Outputs (Short-term):</strong> Deliverables (e.g., 500 youth trained, 1 App).</li>
          </ul>
          <p>Ensure indicators are <strong>SMART</strong> and verified by realistic <strong>MoV</strong> (Means of Verification).</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Donors buy Outcomes:</strong> "Training held" (So what?). "Trainees got jobs" (Value!).
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>Vague Verbs:</strong> "Understand", "Aware". How do you measure awareness? Use "Pass test", "Advocate".</li>
              <li><strong>Overpromising:</strong> Don't promise to "End Poverty" with $85k.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p><strong>"Kontrak Keberhasilan"</strong>. Menghubungkan input dengan hasil.</p>
          <h4>Hierarki:</h4>
          <ul>
            <li><strong>Dampak (Jangka Panjang):</strong> Visi (cth: Plastik di laut berkurang).</li>
            <li><strong>Outcome (Jangka Menengah):</strong> Perubahan perilaku (cth: Desa adopsi kebijakan data).</li>
            <li><strong>Output (Jangka Pendek):</strong> Barang jadi (cth: 500 pemuda dilatih, 1 App).</li>
          </ul>
          <p>Pastikan indikator <strong>SMART</strong> dan diverifikasi dengan <strong>MoV</strong> yang realistis.</p>
        `,
        tip: `
          <div class="box-tip">
            <strong>Donor beli Outcome:</strong> "Pelatihan digelar" (Terus kenapa?). "Peserta dapat kerja" (Itu nilai!).
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Kata Kerja Samar:</strong> "Memahami", "Sadar". Gimana ukurnya? Gunakan "Lulus tes", "Mengadvokasi".</li>
              <li><strong>Janji Surga:</strong> Jangan janji "Hapus Kemiskinan" cuma dengan modal $85rb.</li>
            </ul>
          </div>
        `
      } 
    },
    visibility_strategy: { 
      en: { 
        what: `
          <p>Donors need PR to justify spending. Detail how you will give them credit.</p>
          <h4>Components:</h4>
          <ul>
            <li><strong>Branding:</strong> Logos on vests, banners, app splash screens.</li>
            <li><strong>Digital:</strong> Social media targets (Impressions, Engagements).</li>
            <li><strong>Knowledge Products:</strong> White papers, documentaries, policy briefs.</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>The Human Story:</strong> Budget for a pro photographer. Donors love "Before & After" stories of beneficiaries.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>"Build it & they will come":</strong> Promotion is active work.</li>
              <li><strong>Zero Budget:</strong> Don't expect the PM to be the photographer and writer too.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p>Donor butuh PR untuk laporan ke pusat. Rinci bagaimana Anda memberi mereka kredit.</p>
          <h4>Komponen:</h4>
          <ul>
            <li><strong>Branding:</strong> Logo di rompi, spanduk, layar aplikasi.</li>
            <li><strong>Digital:</strong> Target medsos (Impresi, Engagement).</li>
            <li><strong>Produk Pengetahuan:</strong> Kertas kebijakan, dokumenter, buku saku.</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Cerita Manusia:</strong> Anggarkan fotografer pro. Donor suka cerita "Before & After" penerima manfaat.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>Pasif:</strong> Promosi itu kerja aktif, bukan otomatis.</li>
              <li><strong>Budget Nol:</strong> Jangan harap PM bisa jadi fotografer dan penulis sekaligus.</li>
            </ul>
          </div>
        `
      } 
    },
    budget_narrative: { 
      en: { 
        what: `
          <p>The <strong>"Justification of Costs"</strong>. Connect every dollar to an activity. Prove <strong>Value for Money</strong>.</p>
          <h4>Structure by Line Item:</h4>
          <ul>
            <li><strong>Personnel:</strong> Justify salaries (High quality talent = Project success).</li>
            <li><strong>Program:</strong> Unit costs (e.g., $20/pax for training kit).</li>
            <li><strong>Admin/Overhead:</strong> Transparency on rent/audit (usually capped at 7-10%).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>In-Kind Contribution:</strong> Mention what you/partners provide for free (e.g., Office space). It sweetens the deal.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Red Flags:</strong>
            <ul>
              <li><strong>Math Errors:</strong> Narrative says $10k, Excel says $12k. Trust destroyed.</li>
              <li><strong>Lump Sums:</strong> "Miscellaneous: $5,000". No donor accepts this. Break it down.</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p><strong>"Justifikasi Biaya"</strong>. Hubungkan setiap dolar dengan aktivitas. Buktikan <strong>Value for Money</strong>.</p>
          <h4>Struktur per Item:</h4>
          <ul>
            <li><strong>Personel:</strong> Justifikasi gaji (Staf ahli = Sukses proyek).</li>
            <li><strong>Program:</strong> Biaya satuan (cth: $20/org untuk paket pelatihan).</li>
            <li><strong>Admin/Overhead:</strong> Transparansi sewa/audit (biasanya max 7-10%).</li>
          </ul>
        `,
        tip: `
          <div class="box-tip">
            <strong>Kontribusi In-Kind:</strong> Sebutkan apa yang gratis dari mitra (cth: Pinjaman kantor). Ini nilai plus.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Bendera Merah:</strong>
            <ul>
              <li><strong>Salah Hitung:</strong> Narasi $10jt, Excel $12jt. Kepercayaan hancur.</li>
              <li><strong>Dana Gelondongan:</strong> "Lain-lain: $5jt". Gak ada donor terima ini. Rinci!</li>
            </ul>
          </div>
        `
      } 
    },
    sustainability: { 
      en: { 
        what: `
          <p>The <strong>"Exit Strategy"</strong>. Convince them you are building a permanent asset, not a temporary event.</p>
          <h4>Three Pillars:</h4>
          <ol>
            <li><strong>Financial:</strong> Who pays next? (Village Fund? Carbon credits? User fees?).</li>
            <li><strong>Institutional:</strong> Adoption by local gov (Perdes/SK).</li>
            <li><strong>Technical:</strong> Knowledge transfer (ToT, Manuals left behind).</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Policy is Key:</strong> A Village Regulation (Perdes) is the strongest sustainability proof. It unlocks state budget.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Avoid:</strong>
            <ul>
              <li><strong>"We will apply for Phase 2":</strong> That is dependency, not sustainability.</li>
              <li><strong>Vague Handover:</strong> Be clear. "Tablets donated to Village Office inventory."</li>
            </ul>
          </div>
        `
      }, 
      id: { 
        what: `
          <p><strong>"Strategi Keluar"</strong>. Yakinkan bahwa Anda membangun aset permanen, bukan event sesaat.</p>
          <h4>Tiga Pilar:</h4>
          <ol>
            <li><strong>Finansial:</strong> Siapa bayar nanti? (Dana Desa? Iuran warga? Jual sampah?).</li>
            <li><strong>Institusional:</strong> Adopsi Pemda (Perdes/SK Bupati).</li>
            <li><strong>Teknis:</strong> Transfer ilmu (ToT, Modul ditinggal di perpustakaan).</li>
          </ol>
        `,
        tip: `
          <div class="box-tip">
            <strong>Kebijakan itu Kunci:</strong> Peraturan Desa (Perdes) adalah bukti terkuat. Sekali jadi hukum, anggaran negara mengalir.
          </div>
        `,
        mistakes: `
          <div class="box-warn">
            <strong>Hindari:</strong>
            <ul>
              <li><strong>"Cari donor lain":</strong> Itu ketergantungan, bukan keberlanjutan.</li>
              <li><strong>Serah Terima Samar:</strong> Harus jelas. "Tablet dihibahkan jadi inventaris Kantor Desa."</li>
            </ul>
          </div>
        `
      } 
    }
  },

// === PANDUAN UNTUK TEMPLATE BARU ===
working_paper: {
  _analogy: { en: 'A working paper is a work in progress, open for feedback.', id: 'Working paper adalah karya yang sedang berjalan, terbuka untuk masukan.' },
  abstract: {
    en: { what: 'State the research question, preliminary findings, and contribution.', tip: 'Emphasize novelty.' },
    id: { what: 'Nyatakan pertanyaan penelitian, temuan awal, dan kontribusi.', tip: 'Tekankan kebaruan.' }
  },
  introduction: {
    en: { what: 'Introduce the problem and why it matters now.', tip: 'Cite recent developments.' },
    id: { what: 'Perkenalkan masalah dan mengapa penting saat ini.', tip: 'Kutip perkembangan terbaru.' }
  },
  literature_review: {
    en: { what: 'Discuss relevant prior work and identify gaps.', tip: 'Focus on literature from the last 5 years.' },
    id: { what: 'Bahas karya sebelumnya yang relevan dan identifikasi celah.', tip: 'Fokus pada literatur 5 tahun terakhir.' }
  },
  theoretical_framework: {
    en: { what: 'Outline the concepts or models guiding your analysis.', tip: 'Keep it concise; elaborate in later versions.' },
    id: { what: 'Gariskan konsep atau model yang memandu analisis Anda.', tip: 'Tetap ringkas; akan diperluas di versi selanjutnya.' }
  },
  preliminary_analysis: {
    en: { what: 'Present early data or stylized facts.', tip: 'Acknowledge limitations.' },
    id: { what: 'Sajikan data awal atau fakta bergaya.', tip: 'Akui keterbatasan.' }
  },
  discussion: {
    en: { what: 'Interpret findings and link to literature.', tip: 'Suggest implications.' },
    id: { what: 'Interpretasikan temuan dan hubungkan dengan literatur.', tip: 'Sarankan implikasi.' }
  },
  conclusion: {
    en: { what: 'Summarize and outline next steps.', tip: 'Invite feedback.' },
    id: { what: 'Ringkas dan gariskan langkah selanjutnya.', tip: 'Undang masukan.' }
  }
},
dissertation_thesis: {
  _analogy: { en: 'A thesis is your contribution to a scholarly conversation.', id: 'Tesis adalah kontribusi Anda dalam percakapan ilmiah.' },
  abstract: {
    en: { what: 'Summarize each essay/chapter, overall contribution.', tip: 'Write after completing the dissertation.' },
    id: { what: 'Ringkas setiap esai/bab, kontribusi keseluruhan.', tip: 'Tulis setelah menyelesaikan disertasi.' }
  },
  introduction: {
    en: { what: 'Present the overarching research question and why it matters.', tip: 'Outline the structure.' },
    id: { what: 'Sajikan pertanyaan penelitian utama dan mengapa penting.', tip: 'Gariskan struktur.' }
  },
  literature_review: {
    en: { what: 'Synthesize literature that frames all essays.', tip: 'Identify the gap your thesis fills.' },
    id: { what: 'Sintesis literatur yang membingkai semua esai.', tip: 'Identifikasi celah yang diisi tesis Anda.' }
  },
  methodology: {
    en: { what: 'Describe methods used across essays (if common).', tip: 'Justify choices.' },
    id: { what: 'Jelaskan metode yang digunakan di semua esai (jika umum).', tip: 'Justifikasi pilihan.' }
  },
  findings: {
    en: { what: 'Present key results from each essay.', tip: 'Use subheadings per essay.' },
    id: { what: 'Sajikan hasil utama dari setiap esai.', tip: 'Gunakan subjudul per esai.' }
  },
  discussion: {
    en: { what: 'Integrate findings, discuss implications, limitations.', tip: 'Connect back to literature.' },
    id: { what: 'Integrasikan temuan, bahas implikasi, keterbatasan.', tip: 'Hubungkan kembali ke literatur.' }
  },
  conclusion: {
    en: { what: 'Summarize contributions and future research.', tip: 'End with a strong takeaway.' },
    id: { what: 'Ringkas kontribusi dan penelitian selanjutnya.', tip: 'Akhiri dengan pesan kuat.' }
  },
  references: {
    en: { what: 'List all cited works in consistent style.', tip: 'Use reference manager.' },
    id: { what: 'Daftar semua karya yang dikutip dengan gaya konsisten.', tip: 'Gunakan manajer referensi.' }
  }
},
policy_brief: {
  _analogy: { 
      en: 'A Policy Brief is a "Menu" for a hungry decision-maker. They don\'t want the recipe (methodology), they just want to know what to order (solution) and how much it costs.', 
      id: 'Policy Brief itu ibarat "Buku Menu" untuk pejabat yang lapar. Mereka tidak mau tahu resepnya (metodologi), mereka cuma mau tahu apa yang harus dipesan (solusi) dan berapa harganya.' 
    },
    executive_summary: { 
      en: { 
        what: 'The "Bottom Line Up Front" (BLUF). It summarizes the Problem, the Recommendation, and the Benefit in 1-2 paragraphs.', 
        tip: 'Policymakers scan this in 30 seconds. Use bold text for the recommendation. Do not just summarize the background; summarize the ACTION.', 
        mistakes: 'Using academic jargon. Being vague ("we need to collaborate") instead of specific ("allocate 5% budget").'
      }, 
      id: { 
        what: 'Inti sari di depan (BLUF). Merangkum Masalah, Rekomendasi, dan Manfaat dalam 1-2 paragraf.', 
        tip: 'Pejabat memindai ini dalam 30 detik. Gunakan huruf tebal untuk rekomendasi. Jangan cuma rangkum latar belakang; rangkum AKSINYA.', 
        mistakes: 'Pakai jargon akademis. Samar ("perlu kolaborasi") bukannya spesifik ("alokasikan 5% anggaran").'
      } 
    },
    context_problem: { 
      en: { 
        what: 'Convince them the current system is broken. Use urgency.', 
        tip: 'Focus on the "Pain Points" of the government (e.g., wasted budget, public complaints).', 
        mistakes: 'Giving a history lesson. They don\'t care about history; they care about today\'s crisis.'
      }, 
      id: { 
        what: 'Yakinkan mereka sistem saat ini rusak. Gunakan urgensi.', 
        tip: 'Fokus pada "Titik Sakit" pemerintah (misal: anggaran terbuang, komplain warga).', 
        mistakes: 'Memberi pelajaran sejarah. Mereka tak peduli sejarah; mereka peduli krisis hari ini.'
      } 
    },
    evidence_table: { 
      en: { 
        what: 'The "Killer Fact". A chart, table, or infographic that proves your solution works better than the status quo.', 
        tip: 'Comparison tables (Before vs After, or Us vs Them) are the most effective visual tool.', 
        mistakes: 'Complex charts that need a PhD to understand. Keep it clean and high-contrast.'
      }, 
      id: { 
        what: '"Fakta Pamungkas". Grafik, tabel, atau infografis yang membuktikan solusi Anda lebih baik dari status quo.', 
        tip: 'Tabel perbandingan (Sebelum vs Sesudah, atau Cara Lama vs Cara Baru) adalah alat visual paling efektif.', 
        mistakes: 'Grafik rumit yang butuh gelar S3 untuk paham. Buat bersih dan kontras.'
      } 
    },
    policy_recommendations: { 
      en: { 
        what: 'The core of the document. Specific, actionable steps defined by "Who does What".', 
        tip: 'Start with a verb (Mandate, Allocate, Repeal). Break it down into Legal, Fiscal, and Technical steps.', 
        mistakes: 'Being passive ("It is recommended that..."). Be directive ("The Ministry must...").'
      }, 
      id: { 
        what: 'Jantung dokumen. Langkah spesifik dan dapat ditindaklanjuti, didefinisikan dengan "Siapa melakukan Apa".', 
        tip: 'Mulai dengan kata kerja (Wajibkan, Alokasikan, Cabut). Pecah jadi langkah Legal, Fiskal, dan Teknis.', 
        mistakes: 'Pasif ("Direkomendasikan agar..."). Harus direktif ("Kementerian harus...").'
      } 
    }
  },
policy_paper: {
  _analogy: { en: 'A policy paper is a deep dive into options.', id: 'Policy paper adalah analisis mendalam tentang pilihan-pilihan.' },
  executive_summary: {
    en: {
      what: `
        <p>This is your <strong>"Decision Snapshot"</strong>. Senior policymakers, advisors, or donors may only read this section before forming an opinion.</p>

        <p>The executive summary must function as a <strong>complete and self-contained version of the paper</strong>. 
        A reader should understand the problem, the policy choices, your analysis, and your final recommendation 
        without reading the rest of the document.</p>

        <h4>Structure it clearly:</h4>
        <ul>
          <li><strong>The Core Problem:</strong> What exactly is failing? Who is affected? Why is it urgent now?</li>
          <li><strong>Policy Options Assessed:</strong> Present at least two serious alternatives plus a "No Action" baseline.</li>
          <li><strong>Comparative Insight:</strong> Briefly explain how the options differ in cost, impact, and feasibility.</li>
          <li><strong>Final Recommendation:</strong> State clearly which option you endorse and why.</li>
        </ul>

        <p>Ideal length: <strong>250‚Äì400 words</strong>. Every sentence must add value.</p>
      `,
      tip: `
        <div class="box-tip">
          <strong>Write it last.</strong> After finishing your analysis, distill the strongest arguments into clear, decisive language.
        </div>
        <p>Include 2‚Äì3 quantitative indicators (%, cost figures, beneficiaries) to strengthen credibility.</p>
      `,
      mistakes: `
        <div class="box-warn">
          <strong>Common Mistakes:</strong>
          <ul>
            <li>Writing background history instead of conclusions.</li>
            <li>Being descriptive instead of analytical.</li>
            <li>Failing to state the recommendation clearly.</li>
            <li>Using vague phrases like ‚ÄúThis paper explores‚Ä¶‚Äù instead of taking a position.</li>
          </ul>
        </div>
      `
    }
  },

  comparative_analysis: {
    en: {
      what: `
        <p>This section is the <strong>"Analytical Core"</strong> of your policy paper. 
        Its purpose is not to describe options, but to systematically compare them.</p>

        <p>You must apply the <strong>same evaluation criteria</strong> to every option 
        in order to ensure fairness and analytical rigor.</p>

        <h4>Recommended Criteria:</h4>
        <ul>
          <li><strong>Cost-effectiveness:</strong> Fiscal burden and efficiency per unit outcome.</li>
          <li><strong>Policy effectiveness:</strong> Likelihood of achieving stated objectives.</li>
          <li><strong>Equity impact:</strong> Distributional consequences across income or regions.</li>
          <li><strong>Political feasibility:</strong> Legislative support and stakeholder alignment.</li>
          <li><strong>Administrative feasibility:</strong> Institutional capacity required.</li>
        </ul>

        <h4>Comparison Matrix Example:</h4>
        <table border="1" cellpadding="6">
          <tr>
            <th>Criteria</th>
            <th>Option A</th>
            <th>Option B</th>
            <th>No Action</th>
          </tr>
          <tr>
            <td>Annual Cost</td><td></td><td></td><td></td>
          </tr>
          <tr>
            <td>Emission Reduction (%)</td><td></td><td></td><td></td>
          </tr>
          <tr>
            <td>Equity Impact</td><td></td><td></td><td></td>
          </tr>
        </table>

        <p>After the matrix, interpret the results. Explain trade-offs and justify which criteria matter most.</p>
      `,
      tip: `
        <div class="box-tip">
          <strong>Comparison is about trade-offs.</strong> A policy that is cheaper may be less equitable. 
          Make trade-offs explicit instead of hiding them.
        </div>
        <p>Whenever possible, use quantitative indicators instead of qualitative adjectives.</p>
      `,
      mistakes: `
        <div class="box-warn">
          <ul>
            <li>Changing criteria between options.</li>
            <li>Repeating description instead of evaluating.</li>
            <li>Avoiding difficult trade-offs.</li>
            <li>Declaring a winner without evidence.</li>
          </ul>
        </div>
      `
    }
  },

  implementation: {
    en: {
      what: `
        <p>This is your <strong>"From Paper to Practice"</strong> section. 
        Even the best recommendation fails without operational clarity.</p>

        <p>Translate your chosen policy into <strong>sequenced, actionable steps</strong>.</p>

        <h4>Structure by Phases:</h4>
        <ol>
          <li><strong>Legal Preparation:</strong> Required regulatory or legislative changes.</li>
          <li><strong>Institutional Setup:</strong> Assign responsible agencies and governance mechanisms.</li>
          <li><strong>Budget Allocation:</strong> Funding sources and fiscal planning.</li>
          <li><strong>Rollout:</strong> Timeline for gradual implementation.</li>
          <li><strong>Adjustment Phase:</strong> Mechanism for mid-course corrections.</li>
        </ol>

        <p>Each phase should specify:</p>
        <ul>
          <li>Responsible actor</li>
          <li>Timeframe</li>
          <li>Budget implications</li>
          <li>Legal authority</li>
        </ul>
      `,
      tip: `
        <div class="box-tip">
          <strong>Think operationally.</strong> If a civil servant reads this, 
          they should know exactly what to do next.
        </div>
      `,
      mistakes: `
        <div class="box-warn">
          <ul>
            <li>Only repeating the recommendation without steps.</li>
            <li>No timeline.</li>
            <li>No responsible institution.</li>
            <li>Ignoring budget constraints.</li>
          </ul>
        </div>
      `
    }
  },

  monitoring_evaluation: {
    en: {
      what: `
        <p>This section ensures <strong>accountability and measurable success</strong>. 
        Policies must define how progress will be tracked over time.</p>

        <p>Indicators must be <strong>SMART</strong>: Specific, Measurable, Achievable, Relevant, Time-bound.</p>

        <h4>KPI Table Template:</h4>
        <table border="1" cellpadding="6">
          <tr>
            <th>Indicator</th>
            <th>Baseline</th>
            <th>Target (Year X)</th>
            <th>Reporting Frequency</th>
          </tr>
          <tr>
            <td>Cost per MWh</td>
            <td></td>
            <td></td>
            <td>Annual</td>
          </tr>
        </table>

        <p>Also clarify which agency collects data and publishes reports.</p>
      `,
      tip: `
        <div class="box-tip">
          <strong>What gets measured gets managed.</strong>
        </div>
        <p>Always define a baseline before projecting improvements.</p>
      `,
      mistakes: `
        <div class="box-warn">
          <ul>
            <li>Using vague outcomes like ‚Äúincrease awareness‚Äù.</li>
            <li>No measurable baseline.</li>
            <li>No reporting mechanism.</li>
            <li>Too many indicators without prioritization.</li>
          </ul>
        </div>
      `
    }
  }
},
white_paper: {
  _analogy: { en: 'A white paper is a persuasive technical brief.', id: 'White paper adalah brief teknis yang persuasif.' },
  executive_summary: {
    en: { what: 'Summarize the problem, solution, and benefits.', tip: 'Target C-level readers.' },
    id: { what: 'Ringkas masalah, solusi, dan manfaat.', tip: 'Targetkan pembaca tingkat direksi.' }
  },
  introduction: {
    en: { what: 'Set the stage: why this issue matters now.', tip: 'Use a compelling statistic.' },
    id: { what: 'Atur panggung: mengapa masalah ini penting saat ini.', tip: 'Gunakan statistik yang menarik.' }
  },
  current_challenges: {
    en: { what: 'Describe pain points and limitations of existing approaches.', tip: 'Be specific with examples.' },
    id: { what: 'Jelaskan masalah dan keterbatasan pendekatan yang ada.', tip: 'Berikan contoh spesifik.' }
  },
  proposed_solution: {
    en: { what: 'Explain your solution, how it works, and its uniqueness.', tip: 'Use diagrams if possible (describe).' },
    id: { what: 'Jelaskan solusi Anda, cara kerjanya, dan keunikannya.', tip: 'Gunakan diagram jika memungkinkan (deskripsikan).' }
  },
  benefits: {
    en: { what: 'Quantify advantages: ROI, efficiency, security.', tip: 'Compare to alternatives.' },
    id: { what: 'Kuantifikasi keuntungan: ROI, efisiensi, keamanan.', tip: 'Bandingkan dengan alternatif.' }
  },
  roadmap: {
    en: { what: 'Outline implementation phases and timeline.', tip: 'Be realistic.' },
    id: { what: 'Gariskan fase implementasi dan jadwal.', tip: 'Bersikaplah realistis.' }
  },
  conclusion: {
    en: { what: 'Reinforce the call to adopt the solution.', tip: 'End with contact/next steps.' },
    id: { what: 'Perkuat ajakan untuk mengadopsi solusi.', tip: 'Akhiri dengan kontak/langkah selanjutnya.' }
  }
},
position_paper: {
  _analogy: { en: 'A position paper states where you stand.', id: 'Position paper menyatakan posisi Anda.' },
  executive_summary: {
    en: { what: 'State your position and main arguments.', tip: 'One paragraph.' },
    id: { what: 'Nyatakan posisi Anda dan argumen utama.', tip: 'Satu paragraf.' }
  },
  introduction: {
    en: { what: 'Introduce the issue and why it‚Äôs contested.', tip: 'Brief background.' },
    id: { what: 'Perkenalkan isu dan mengapa diperdebatkan.', tip: 'Latar belakang singkat.' }
  },
  stance: {
    en: { what: 'Clearly articulate your position.', tip: 'Use a strong thesis statement.' },
    id: { what: 'Artikulasikan posisi Anda dengan jelas.', tip: 'Gunakan pernyataan tesis yang kuat.' }
  },
  arguments: {
    en: { what: 'Present supporting evidence and reasoning.', tip: 'Address each argument separately.' },
    id: { what: 'Sajikan bukti dan alasan pendukung.', tip: 'Tangani setiap argumen secara terpisah.' }
  },
  counterarguments: {
    en: { what: 'Acknowledge opposing views and rebut them.', tip: 'Show fairness and strength.' },
    id: { what: 'Akui pandangan yang berlawanan dan bantah.', tip: 'Tunjukkan keadilan dan kekuatan.' }
  },
  conclusion: {
    en: { what: 'Summarize and call for action.', tip: 'Reiterate the stakes.' },
    id: { what: 'Ringkas dan ajak bertindak.', tip: 'Ulangi apa yang dipertaruhkan.' }
  }
},
technical_report: {
  _analogy: { en: 'A technical report is a lab notebook for others.', id: 'Laporan teknis adalah catatan laboratorium untuk orang lain.' },
  abstract: {
    en: { what: 'Summarize objectives, methods, key results, and conclusions.', tip: 'Include numerical highlights.' },
    id: { what: 'Ringkas tujuan, metode, hasil utama, dan kesimpulan.', tip: 'Sertakan sorotan numerik.' }
  },
  introduction: {
    en: { what: 'State the problem and context.', tip: 'Mention who commissioned it.' },
    id: { what: 'Nyatakan masalah dan konteks.', tip: 'Sebutkan siapa yang memesannya.' }
  },
  system_overview: {
    en: { what: 'Describe the hardware/software/system under test.', tip: 'Include specifications.' },
    id: { what: 'Jelaskan perangkat keras/perangkat lunak/sistem yang diuji.', tip: 'Sertakan spesifikasi.' }
  },
  methodology: {
    en: { what: 'Detail test setup, procedures, and measurement tools.', tip: 'Include calibration info.' },
    id: { what: 'Rinci pengaturan uji, prosedur, dan alat ukur.', tip: 'Sertakan info kalibrasi.' }
  },
  results: {
    en: { what: 'Present data in tables/figures with brief descriptions.', tip: 'Do not interpret yet.' },
    id: { what: 'Sajikan data dalam tabel/figur dengan deskripsi singkat.', tip: 'Jangan interpretasi dulu.' }
  },
  discussion: {
    en: { what: 'Interpret results, compare to expectations, note anomalies.', tip: 'Suggest improvements.' },
    id: { what: 'Interpretasi hasil, bandingkan dengan harapan, catat anomali.', tip: 'Sarankan perbaikan.' }
  },
  conclusion: {
    en: { what: 'Summarize main takeaways.', tip: 'Mention if further testing is needed.' },
    id: { what: 'Ringkas kesimpulan utama.', tip: 'Sebutkan jika diperlukan pengujian lebih lanjut.' }
  }
},
guideline_sop: {
  _analogy: { en: 'An SOP is a recipe for consistency.', id: 'SOP adalah resep untuk konsistensi.' },
  purpose: {
    en: { what: 'Explain why the SOP exists.', tip: 'Link to regulations if applicable.' },
    id: { what: 'Jelaskan mengapa SOP ini ada.', tip: 'Hubungkan dengan regulasi jika ada.' }
  },
  scope: {
    en: { what: 'Define who and what the SOP covers.', tip: 'Mention exclusions.' },
    id: { what: 'Tentukan siapa dan apa yang dicakup SOP.', tip: 'Sebutkan pengecualian.' }
  },
  definitions: {
    en: { what: 'Define key terms and acronyms.', tip: 'Keep it simple.' },
    id: { what: 'Definisikan istilah dan akronim kunci.', tip: 'Tetap sederhana.' }
  },
  responsibilities: {
    en: { what: 'List roles and their duties.', tip: 'Use a table if many.' },
    id: { what: 'Daftar peran dan tugas mereka.', tip: 'Gunakan tabel jika banyak.' }
  },
  procedure: {
    en: { what: 'Provide step-by-step instructions.', tip: 'Use numbered steps, active voice.' },
    id: { what: 'Berikan instruksi langkah demi langkah.', tip: 'Gunakan langkah bernomor, kalimat aktif.' }
  },
  compliance: {
    en: { what: 'Explain consequences of non-compliance.', tip: 'Reference related policies.' },
    id: { what: 'Jelaskan konsekuensi ketidakpatuhan.', tip: 'Rujuk kebijakan terkait.' }
  },
  references: {
    en: { what: 'List related documents and regulations.', tip: 'Include version numbers.' },
    id: { what: 'Daftar dokumen dan regulasi terkait.', tip: 'Sertakan nomor versi.' }
  }
},
regulatory_impact_assessment: {
  _analogy: { en: 'An RIA is a cost‚Äìbenefit analysis for rules.', id: 'RIA adalah analisis biaya-manfaat untuk peraturan.' },
  executive_summary: {
    en: { what: 'Summarize the problem, preferred option, and net benefits.', tip: 'Highlight key numbers.' },
    id: { what: 'Ringkas masalah, opsi yang dipilih, dan manfaat bersih.', tip: 'Sorot angka-angka kunci.' }
  },
  problem_identification: {
    en: { what: 'Describe the market failure or issue.', tip: 'Use evidence.' },
    id: { what: 'Jelaskan kegagalan pasar atau masalah.', tip: 'Gunakan bukti.' }
  },
  objectives: {
    en: { what: 'State what the regulation aims to achieve.', tip: 'Be specific and measurable.' },
    id: { what: 'Nyatakan apa yang ingin dicapai oleh regulasi.', tip: 'Spesifik dan terukur.' }
  },
  options: {
    en: { what: 'List alternative approaches, including ‚Äúdo nothing‚Äù.', tip: 'Describe each concisely.' },
    id: { what: 'Daftar pendekatan alternatif, termasuk ‚Äútidak melakukan apa pun‚Äù.', tip: 'Jelaskan masing-masing secara ringkas.' }
  },
  impact_analysis: {
    en: { what: 'Quantify costs, benefits, and distributional effects.', tip: 'Use monetized values where possible.' },
    id: { what: 'Kuantifikasi biaya, manfaat, dan efek distribusi.', tip: 'Gunakan nilai moneter jika memungkinkan.' }
  },
  consultation: {
    en: { what: 'Summarize stakeholder feedback and how it influenced the analysis.', tip: 'Be transparent.' },
    id: { what: 'Ringkas masukan pemangku kepentingan dan bagaimana pengaruhnya terhadap analisis.', tip: 'Bersikaplah transparan.' }
  },
  recommendation: {
    en: { what: 'State the preferred option and justification.', tip: 'Mention next steps.' },
    id: { what: 'Nyatakan opsi yang dipilih dan justifikasi.', tip: 'Sebutkan langkah selanjutnya.' }
  }
}

  /* ------------------------------------------------------------- */
};

const CATEGORY_CONFIG = {
  academic: { label: 'Academic', color: 'blue', icon: <GraduationCap className="w-5 h-5" />, logic: 'IMRaD' },
  policy: { label: 'Policy', color: 'emerald', icon: <Scale className="w-5 h-5" />, logic: 'Problem‚ÄìSolution' },
  media: { label: 'Media', color: 'orange', icon: <Newspaper className="w-5 h-5" />, logic: 'Narrative' }
};

// 3. MODULE REGISTRY (Tombol Template yang Muncul)
const MODULE_REGISTRY_DEFINITION = [
  { 
      id: 'journal_article', 
      name: 'Journal Article', 
      category: 'academic', 
      schema_version: SCHEMA_VERSION, 
      structural_sections: ['abstract','introduction','framework','methodology','findings','discussion','conclusion'], 
      color: 'blue', 
      description: 'Full empirical research paper.' 
  },
  
  /* --- AREA EDIT (PAK ANGGA): DAFTARKAN TOMBOL BARU DI SINI --- */
  
  { 
      id: 'project_proposal', // HARUS SAMA dengan ID di DUMMY_DATA dan GUIDANCE
      name: 'Project Proposal', // Nama yang muncul di tombol
      category: 'academic', // Kategori: 'academic', 'policy', atau 'media'
      schema_version: SCHEMA_VERSION, 
      // Urutan bagian-bagian dokumen
      structural_sections: ['executive_summary','situational_analysis','methodology','technical_implementation','logframe','budget_narrative','sustainability'], 
      color: 'blue', 
      description: 'Proposal pendanaan proyek standar.' 
  }, { 
  id: 'working_paper', 
  name: 'Working Paper', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','literature_review','theoretical_framework','preliminary_analysis','discussion','conclusion'], 
  color: 'blue', 
  description: 'Preliminary research findings shared for feedback.' 
},
{ 
  id: 'dissertation_thesis', 
  name: 'Dissertation / Thesis', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','literature_review','methodology','findings','discussion','conclusion','references'], 
  color: 'blue', 
  description: 'Original research for doctoral or master\'s degree.' 
},
{ 
  id: 'policy_brief', 
  name: 'Policy Brief', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','context_problem','critique','evidence_table','policy_recommendations','implications'], 
  color: 'emerald', 
  description: 'Concise summary of policy issue and recommendations.' 
},
{ 
  id: 'policy_paper', 
  name: 'Policy Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','introduction','problem_definition','policy_options','comparative_analysis',
  'economic_modeling','risk_assessment','recommendations','implementation','monitoring_evaluation','conclusion'], 
  color: 'emerald', 
  description: 'Detailed analysis of policy options.' 
},
{ 
  id: 'white_paper', 
  name: 'White Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','introduction','current_challenges','proposed_solution','benefits','roadmap','conclusion'], 
  color: 'emerald', 
  description: 'Authoritative report on a specific issue and solution.' 
},
{ 
  id: 'position_paper', 
  name: 'Position Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','introduction','stance','arguments','counterarguments','conclusion'], 
  color: 'emerald', 
  description: 'Statement of an organization\'s or individual\'s position.' 
},
{ 
  id: 'technical_report', 
  name: 'Technical Report', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','system_overview','methodology','results','discussion','conclusion'], 
  color: 'blue', 
  description: 'Documentation of technical research or development.' 
},
{ 
  id: 'guideline_sop', 
  name: 'Guideline / SOP Document', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['purpose','scope','definitions','responsibilities','procedure','compliance','references'], 
  color: 'emerald', 
  description: 'Standard operating procedures or guidelines.' 
},
{ 
  id: 'regulatory_impact_assessment', 
  name: 'Regulatory Impact Assessment', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','problem_identification','objectives','options','impact_analysis','consultation','recommendation'], 
  color: 'emerald', 
  description: 'Evaluation of effects of proposed regulations.' 
},

  /* ------------------------------------------------------------- */
  
  { id: 'conference_paper', name: 'Conference Paper', category: 'academic', schema_version: SCHEMA_VERSION, structural_sections: ['abstract','introduction','related_work','method','experiments','conclusion'], color: 'blue', description: 'Concise research contribution.' },
  { id: 'research_report', name: 'Research Report', category: 'academic', schema_version: SCHEMA_VERSION, structural_sections: ['executive_summary','background','methodology','findings','recommendations'], color: 'blue', description: 'Commissioned investigation.' }
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   LOGIC & UI (JANGAN DIUBAH KECUALI PAHAM REACT)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const colorMap = {
  blue: { bg: 'bg-blue-500/10', border: 'border-blue-500/30 hover:border-blue-500', text: 'text-blue-400', badge: 'bg-blue-900/50 text-blue-300 border-blue-500/30', glow: 'hover:shadow-blue-500/10' },
  emerald: { bg: 'bg-emerald-500/10', border: 'border-emerald-500/30 hover:border-emerald-500', text: 'text-emerald-400', badge: 'bg-emerald-900/50 text-emerald-300 border-emerald-500/30', glow: 'hover:shadow-emerald-500/10' },
  orange: { bg: 'bg-orange-500/10', border: 'border-orange-500/30 hover:border-orange-500', text: 'text-orange-400', badge: 'bg-orange-900/50 text-orange-300 border-orange-500/30', glow: 'hover:shadow-orange-500/10' }
};

class ModuleInstaller {
  constructor() { this.registry = {}; }
  install(modules) { modules.forEach(mod => this.registry[mod.id] = mod); }
  get(id) { return this.registry[id] || null; }
  getByCategory(cat) { return Object.values(this.registry).filter(m => m.category === cat); }
}
const installer = new ModuleInstaller();
installer.install(MODULE_REGISTRY_DEFINITION);
const generateId = () => Math.random().toString(36).substr(2, 9);
const buildModuleData = (moduleId, isTutorial) => {
  const mod = installer.get(moduleId);
  if (!mod) return null;
  const dummyMod = DUMMY_DATA[moduleId];
  const guidanceMod = GUIDANCE[moduleId] || {};
  const sections = mod.structural_sections.map(secKey => ({
    id: generateId(), sectionKey: secKey,
    content: isTutorial ? (dummyMod?.sections.find(s => s.key === secKey)?.content || `<h3>${secKey.replace(/_/g,' ')}</h3><p>...</p>`) : `<h3>${secKey.replace(/_/g,' ')}</h3><p>[Write here...]</p>`,
    guidance: { en: guidanceMod[secKey]?.en || { what: 'Write content.' }, id: guidanceMod[secKey]?.id || { what: 'Tulis konten.' } },
    analogy: { en: guidanceMod._analogy?.en, id: guidanceMod._analogy?.id },
    aiFeedback: null
  }));
  return { id: generateId(), moduleId, title: isTutorial ? (dummyMod?.title || mod.name) : `My ${mod.name}`, sections, metadata: mod };
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   UI COMPONENTS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

const ErrorToast = ({ message, onClose, onRetry }) => {
    if (!message) return null;
    return (
        <div className="fixed bottom-6 right-6 max-w-sm w-full bg-slate-900 border border-red-500/50 text-white p-4 rounded-xl shadow-2xl z-[100] anim-up flex gap-3">
            <div className="p-2 bg-red-500/20 rounded-full h-fit">
                <AlertTriangle className="w-5 h-5 text-red-400" />
            </div>
            <div className="flex-1">
                <h4 className="font-bold text-red-400 text-sm mb-1">Proses AI Gagal</h4>
                <p className="text-xs text-slate-300 leading-relaxed mb-3">{message}</p>
                <div className="flex gap-2">
                    <button onClick={onRetry} className="flex-1 py-1.5 bg-red-600 hover:bg-red-700 rounded-lg text-[10px] font-bold transition-colors">
                        Coba Lagi
                    </button>
                    <button onClick={onClose} className="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-[10px] font-bold transition-colors">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    );
};

const AIMonitor = ({ status }) => {
    if (!status) return null;
    return (
        <div className="fixed bottom-6 left-6 bg-slate-900/90 backdrop-blur border border-blue-500/30 p-2.5 rounded-lg shadow-xl z-50 flex items-center gap-3 anim-fade">
            <div className="p-1.5 bg-blue-500/20 rounded-md">
                <Terminal className="w-3.5 h-3.5 text-blue-400" />
            </div>
            <span className="text-[10px] font-mono text-blue-300">{status}</span>
        </div>
    );
};

const RichTextEditor = ({ initialContent, onSave, onCancel }) => {
  const editorRef = useRef(null);

  // --- EDITOR COMMANDS ---
  const execCmd = (cmd, val = null) => {
    document.execCommand(cmd, false, val);
    editorRef.current.focus();
  };

  // --- LOGIC 1: INSERT TABEL (Versi Cantik + Header Abu-abu) ---
  const insertTable = () => {
    const tableHTML = `
      <table style="width:100%; border-collapse:collapse; margin: 10px 0;">
        <thead>
          <tr>
            <th style="background-color:#f1f5f9; border:1px solid #cbd5e1; padding:8px;">Header 1</th>
            <th style="background-color:#f1f5f9; border:1px solid #cbd5e1; padding:8px;">Header 2</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="border:1px solid #cbd5e1; padding:8px;">Data 1</td>
            <td style="border:1px solid #cbd5e1; padding:8px;">Data 2</td>
          </tr>
        </tbody>
      </table>
      <p>&nbsp;</p> 
    `;
    execCmd('insertHTML', tableHTML);
  };

  // --- LOGIC 2: TAMBAH BARIS (ROW) ---
  const addRow = () => {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;
    
    let node = selection.getRangeAt(0).startContainer;
    while (node && node.nodeName !== 'TR') { node = node.parentNode; }

    if (node && node.nodeName === 'TR') {
      const newRow = node.cloneNode(true);
      // Bersihkan isi tapi pertahankan style border/padding
      Array.from(newRow.cells).forEach(cell => cell.innerHTML = '&nbsp;');
      node.parentNode.insertBefore(newRow, node.nextSibling);
    } else {
      alert("‚ö†Ô∏è Klik baris tabel dulu untuk menambah baris.");
    }
  };

  // --- LOGIC 3: TAMBAH KOLOM (COLUMN) ---
  const addCol = () => {
    const selection = window.getSelection();
    if (!selection.rangeCount) return;

    let cell = selection.getRangeAt(0).startContainer;
    while (cell && cell.nodeName !== 'TD' && cell.nodeName !== 'TH') { cell = cell.parentNode; }

    if (cell && (cell.nodeName === 'TD' || cell.nodeName === 'TH')) {
      const cellIndex = cell.cellIndex;
      const row = cell.parentNode;
      const table = row.closest('table');
      
      for (let i = 0; i < table.rows.length; i++) {
        const thisRow = table.rows[i];
        // Clone agar style (background header/border) ikut tercopy
        const newCell = thisRow.cells[cellIndex].cloneNode(true);
        newCell.innerHTML = '&nbsp;';
        thisRow.insertBefore(newCell, thisRow.cells[cellIndex].nextSibling);
      }
    } else {
      alert("‚ö†Ô∏è Klik kolom tabel dulu untuk menambah kolom.");
    }
  };

  return (
    <div className="border-2 border-blue-400 rounded-xl overflow-hidden bg-white flex flex-col shadow-lg anim-scale relative z-50">
      
      {/* --- TOOLBAR --- */}
      <div className="bg-slate-50 border-b p-2 flex gap-1 items-center flex-wrap">
        
        {/* Group Formatting Text */}
        <button onClick={() => execCmd('bold')} className="p-1.5 hover:bg-slate-200 rounded text-slate-700" title="Bold"><Bold className="w-3.5 h-3.5"/></button>
        <button onClick={() => execCmd('italic')} className="p-1.5 hover:bg-slate-200 rounded text-slate-700" title="Italic"><Italic className="w-3.5 h-3.5"/></button>
        <div className="w-px h-4 bg-slate-300 mx-1"/>
        <button onClick={() => execCmd('formatBlock','H3')} className="px-2 py-1 hover:bg-slate-200 rounded text-xs font-bold text-slate-700">H3</button>
        <button onClick={() => execCmd('formatBlock','P')} className="px-2 py-1 hover:bg-slate-200 rounded text-xs text-slate-700">¬∂</button>
        <div className="w-px h-4 bg-slate-300 mx-1"/>
        <button onClick={() => execCmd('insertUnorderedList')} className="p-1.5 hover:bg-slate-200 rounded text-slate-700"><List className="w-3.5 h-3.5"/></button>
        
        <div className="w-px h-4 bg-slate-300 mx-1"/>

        {/* --- GROUP TABEL (LENGKAP) --- */}
        <div className="flex bg-blue-50 rounded border border-blue-100 p-0.5 gap-0.5">
            {/* 1. Insert Table */}
            <button onClick={insertTable} className="p-1.5 hover:bg-blue-100 text-blue-600 rounded" title="Buat Tabel Baru">
                <Table className="w-3.5 h-3.5"/>
            </button>
            {/* 2. Add Row */}
            <button onClick={addRow} className="p-1.5 hover:bg-blue-100 text-blue-600 rounded" title="Tambah Baris ke Bawah">
                <ArrowDown className="w-3.5 h-3.5"/>
            </button>
            {/* 3. Add Col */}
            <button onClick={addCol} className="p-1.5 hover:bg-blue-100 text-blue-600 rounded" title="Tambah Kolom ke Kanan">
                <ChevronRight className="w-3.5 h-3.5"/>
            </button>
        </div>

        <div className="w-px h-4 bg-slate-300 mx-1"/>

        {/* --- GROUP WARNA (STABILO) --- */}
        <div className="relative flex items-center group">
            <label htmlFor="colorPicker" className="p-1.5 hover:bg-yellow-100 text-yellow-600 rounded cursor-pointer flex items-center gap-1" title="Highlight Color">
                <Palette className="w-3.5 h-3.5"/>
            </label>
            <input 
                id="colorPicker"
                type="color" 
                className="opacity-0 w-0 h-0 absolute"
                onChange={(e) => execCmd('hiliteColor', e.target.value)} 
            />
        </div>

      </div>

      {/* --- EDITOR AREA --- */}
      <div 
        ref={editorRef} 
        className="p-4 outline-none prose-card text-sm overflow-y-auto" 
        contentEditable 
        suppressContentEditableWarning
        dangerouslySetInnerHTML={{ __html: initialContent }} 
        style={{ minHeight: '200px', maxHeight: '400px' }}
      />

      {/* --- FOOTER --- */}
      <div className="p-2 border-t bg-slate-50 flex justify-end gap-2">
        <button onClick={onCancel} className="px-3 py-1.5 text-xs text-slate-600 hover:bg-slate-100 rounded-lg">Batal</button>
        <button onClick={() => onSave(editorRef.current.innerHTML)} className="px-4 py-1.5 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Simpan</button>
      </div>
    </div>
  );
};

const GuidancePanel = ({ section, moduleId, lang, onRunAI, isProcessing, setLang }) => {
  const [tab, setTab] = useState('what');
  
  if (!section) return (
    <div className="flex flex-col items-center justify-center h-full text-slate-500 p-6">
      <BookOpen className="w-12 h-12 mb-3 text-slate-300"/>
      <p className="text-sm text-center">Pilih bagian untuk melihat panduan</p>
    </div>
  );

  const g = section.guidance?.[lang] || {};
  const analogy = section.analogy?.[lang] || '';
  
  const tabs = [
    { id: 'what', label: lang === 'en' ? 'What to Write' : 'Apa yang Ditulis', icon: <PenTool className="w-3 h-3"/> },
    { id: 'tip', label: lang === 'en' ? 'Pro Tips' : 'Tips Pro', icon: <Info className="w-3 h-3"/> },
    { id: 'mistakes', label: lang === 'en' ? 'Mistakes' : 'Kesalahan', icon: <AlertCircle className="w-3 h-3"/> },
    { id: 'coach', label: lang === 'en' ? 'AI Coach' : 'Pelatih AI', icon: <GraduationCap className="w-3 h-3"/> }
  ];

  return (
    <div className="flex flex-col h-full anim-right bg-white">
      {/* Header Panel */}
      <div className="p-4 border-b bg-slate-50">
        <div className="flex justify-between items-start mb-2">
            <div className="text-xs font-bold uppercase tracking-wider text-slate-500">
            {section.sectionKey?.replace(/_/g,' ')}
            </div>
        </div>
        
        {analogy && (
          <div className="text-xs text-indigo-700 italic leading-relaxed bg-indigo-50 rounded-lg p-3 border border-indigo-100 shadow-sm">
            <span className="font-bold not-italic">üí° Analogi:</span> {analogy}
          </div>
        )}
      </div>

      {/* Tabs */}
      <div className="flex border-b bg-white sticky top-0 z-10">
        {tabs.map(t => (
          <button key={t.id} onClick={() => setTab(t.id)}
            className={`flex-1 py-3 text-xs font-medium flex flex-col sm:flex-row items-center justify-center gap-1.5 transition-colors border-b-2 ${
              tab === t.id ? 'border-blue-500 text-blue-600 bg-blue-50/40' : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'
            }`}>
            {t.icon} <span>{t.label}</span>
          </button>
        ))}
      </div>

      {/* Content Area */}
      <div className="p-5 overflow-y-auto flex-1 custom-scrollbar">
        {tab === 'coach' ? (
          <div className="flex flex-col gap-4">
            <div className="bg-gradient-to-br from-purple-50 to-white border border-purple-100 rounded-xl p-4 shadow-sm">
              <div className="flex items-center gap-2 mb-3">
                <div className="p-1.5 bg-purple-100 rounded-lg"><GraduationCap className="w-5 h-5 text-purple-600"/></div>
                <h4 className="font-bold text-sm text-purple-900">AI Writing Coach</h4>
              </div>
              <p className="text-xs text-slate-600 mb-4 leading-relaxed">
                {lang === 'en' 
                    ? "I will analyze your current draft specifically for this section's goals and provide structural feedback." 
                    : "Saya akan menganalisis draf Anda khusus untuk tujuan bagian ini dan memberikan masukan struktural."}
              </p>
              <button onClick={onRunAI} disabled={isProcessing}
                className={`w-full py-2.5 rounded-lg text-xs font-bold text-white transition-all shadow-md flex items-center justify-center gap-2 ${isProcessing ? 'bg-slate-400 cursor-not-allowed' : 'bg-purple-600 hover:bg-purple-700 hover:shadow-lg hover:-translate-y-0.5'}`}>
                {isProcessing ? <Loader2 className="w-3 h-3 animate-spin"/> : <Sparkles className="w-3 h-3"/>}
                {isProcessing ? (lang === 'en' ? 'Analyzing...' : 'Sedang Menganalisis...') : (lang === 'en' ? 'Analyze My Draft' : 'Analisis Draf Saya')}
              </button>
            </div>
            
            {section.aiFeedback && (
               <div className="prose-card text-sm p-4 bg-white border border-slate-200 rounded-xl shadow-md animate-in fade-in slide-in-from-bottom-4">
                 <div className="flex items-center gap-2 mb-3 pb-2 border-b border-slate-100">
                    <Sparkles className="w-4 h-4 text-purple-500"/>
                    <span className="text-xs font-bold text-slate-500 uppercase">Analysis Results</span>
                 </div>
                 <div className="whitespace-pre-line leading-relaxed text-slate-700" dangerouslySetInnerHTML={{ __html: section.aiFeedback }} />
               </div>
            )}
          </div>
        ) : (
          /* --- INI BAGIAN PENTING: RENDER HTML DARI DATA GUIDANCE --- */
          <div className="text-sm text-slate-700 guidance-content animate-in fade-in duration-300" 
               dangerouslySetInnerHTML={{ __html: g[tab] || (lang === 'en' ? '<p class="text-slate-400 italic">No guidance available.</p>' : '<p class="text-slate-400 italic">Panduan belum tersedia.</p>') }} />
        )}
      </div>
    </div>
  );
};

const ModuleDetailPanel = ({ mod, onSelect, onClose }) => {
  const cat = CATEGORY_CONFIG[mod.category];
  const col = colorMap[mod.color];
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm anim-fade">
      <div className="bg-slate-900 border border-slate-700 rounded-2xl max-w-lg w-full p-6 anim-scale shadow-2xl">
        <div className="flex justify-between items-start mb-4">
          <div>
            <div className={`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs border ${col.badge} mb-2`}>
              {cat.icon} {cat.label} ¬∑ {cat.logic}
            </div>
            <h2 className="text-xl font-bold text-white">{mod.name}</h2>
          </div>
          <button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg text-slate-400"><X className="w-4 h-4"/></button>
        </div>

        <p className="text-slate-400 text-sm mb-4">{mod.description}</p>
        <div className="flex gap-3 mt-8">
          <button onClick={() => onSelect(mod.id, false)} className="flex-1 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-semibold transition-colors">
            Start New
          </button>
          <button onClick={() => onSelect(mod.id, true)} className="flex-1 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl text-sm font-semibold transition-colors">
            Load Example
          </button>
        </div>
      </div>
    </div>
  );
};

const LandingPage = ({ onSelectTemplate, onImport }) => {
  const [activeCategory, setActiveCategory] = useState('academic');
  const [detailMod, setDetailMod] = useState(null);
  const modules = installer.getByCategory(activeCategory);

  return (
    <div className="min-h-screen bg-[#0a0f1e] text-white flex flex-col overflow-auto">
      <div className="relative z-10 flex flex-col items-center px-6 py-12">
        <div className="text-center mb-8 anim-up">
          <h1 className="text-5xl font-black mb-3 tracking-tight">
            Structure<span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-emerald-400">Flow</span>
          </h1>
          <p className="text-slate-400 max-w-md mx-auto">10 publication modules. Professional guidance. Bilingual intelligence.</p>
        </div>
        
        <div className="flex gap-2 mb-8 bg-slate-800/50 p-1 rounded-xl border border-slate-700/50 anim-up delay-2">
          {Object.entries(CATEGORY_CONFIG).map(([key, cat]) => (
            <button key={key} onClick={() => setActiveCategory(key)}
              className={`flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-semibold transition-all ${
                activeCategory === key
                  ? 'bg-slate-700 text-white shadow-lg'
                  : 'text-slate-400 hover:text-slate-300'
              }`}>
              {cat.icon} {cat.label}
            </button>
          ))}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-w-7xl w-full mb-10 anim-up delay-3">
          {modules.map((mod, i) => {
            const col = colorMap[mod.color];
            return (
              <button key={mod.id}
                onClick={() => setDetailMod(mod)}
                className={`relative p-5 rounded-xl border ${col.border} bg-slate-800/60 backdrop-blur text-left transition-all duration-300 hover:-translate-y-0.5 hover:shadow-xl ${col.glow} group`}>
                <h3 className="font-bold text-slate-100 text-sm mb-1">{mod.name}</h3>
                <p className="text-xs text-slate-400 leading-relaxed mb-3">{mod.description}</p>
              </button>
            );
          })}
        </div>

        <label className="flex items-center gap-3 px-5 py-3 rounded-xl border border-dashed border-slate-600 hover:border-purple-500 bg-slate-800/30 cursor-pointer transition-colors group text-sm text-slate-400 hover:text-slate-300">
          <input type="file" onChange={onImport} className="hidden" accept=".json"/>
          <FolderOpen className="w-4 h-4 group-hover:text-purple-400 transition-colors"/>
          Muat sesi JSON yang disimpan sebelumnya
        </label>
      </div>

      {detailMod && (
        <ModuleDetailPanel
          mod={detailMod}
          onSelect={(id, isTutorial) => { setDetailMod(null); onSelectTemplate(id, isTutorial); }}
          onClose={() => setDetailMod(null)}
        />
      )}
    </div>
  );
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MAIN APP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

function App() {
  const [view, setView] = useState('landing');
  const [docData, setDocData] = useState(null);
  const [selectedIdx, setSelectedIdx] = useState(0);
  const [editingIdx, setEditingIdx] = useState(null);
  const [lang, setLang] = useState('en');
  
  const [apiKey, setApiKey] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [aiStatus, setAiStatus] = useState(null); 
  const [aiError, setAiError] = useState(null); 
  const [history, setHistory] = useState([]);
  const [retryAction, setRetryAction] = useState(null); 

  const pushHistory = () => {
    setHistory(prev => [...prev.slice(-9), JSON.parse(JSON.stringify(docData))]);
  };
  
  const handleUndo = () => {
    if (history.length === 0) return;
    const previous = history[history.length - 1];
    setHistory(prev => prev.slice(0, -1));
    setDocData(previous);
  };

  const handleNodecardAI = async (idx) => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleNodecardAI(idx));
    try {
      const section = docData.sections[idx];
      const prev = idx > 0 ? docData.sections[idx - 1] : null;
      const next = idx < docData.sections.length - 1 ? docData.sections[idx + 1] : null;
      const prompt = AI_BRIDGE.buildNodeContext(section, prev, next, docData, lang);
      
      const generatedContent = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
      
      const updatedSections = [...docData.sections];
      updatedSections[idx] = { ...section, content: generatedContent };
      setDocData({ ...docData, sections: updatedSections });
      setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleGlobalAI = async () => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleGlobalAI());
    try {
        const prompt = AI_BRIDGE.buildGlobalContext(docData.sections, docData, lang);
        const rawJson = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
        const cleanJson = rawJson.replace(/```json/g, '').replace(/```/g, '').trim();
        const updates = JSON.parse(cleanJson);
        const newSections = docData.sections.map(original => {
            const update = updates.find(u => u.id === original.id);
            return update ? { ...original, content: update.content } : original;
        });
        setDocData({ ...docData, sections: newSections });
        setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleGuidanceAI = async (idx) => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleGuidanceAI(idx));
    try {
        const section = docData.sections[idx];
        const prompt = AI_BRIDGE.buildGuidanceContext(section.content, section.guidance[lang], lang);
        const feedback = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
        const updatedSections = [...docData.sections];
        updatedSections[idx] = { ...section, aiFeedback: feedback };
        setDocData({ ...docData, sections: updatedSections });
        setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleSelectTemplate = (moduleId, isTutorial) => {
    const data = buildModuleData(moduleId, isTutorial);
    if (!data) return;
    setDocData(data); setSelectedIdx(0); setEditingIdx(null); setView('workspace');
  };
  const handleImport = (e) => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const parsed = JSON.parse(ev.target.result);
        setDocData(parsed); setSelectedIdx(0); setView('workspace');
      } catch { alert('File JSON tidak valid.'); }
    };
    reader.readAsText(e.target.files[0]);
    e.target.value = '';
  };
  const handleSaveJSON = () => {
    const dataStr = JSON.stringify(docData, null, 2);
    const link = document.createElement('a');
    link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    link.download = `structureflow-${docData.moduleId}-${Date.now()}.json`;
    link.click();
  };
  const handleExportDoc = () => {
    const preHtml = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>${docData.title}</title><style>body { font-family: 'Calibri', sans-serif; }</style></head><body><h1>${docData.title}</h1>`;
    const contentHtml = docData.sections.map(s => `<div class="section">${s.content}</div><br/>`).join('');
    const fullHtml = preHtml + contentHtml + "</body></html>";
    const url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(fullHtml);
    const downloadLink = document.createElement("a");
    document.body.appendChild(downloadLink);
    downloadLink.href = url;
    downloadLink.download = `${docData.title}.doc`;
    downloadLink.click();
    document.body.removeChild(downloadLink);
  };
  
    const handleExportPDF = () => {
  const originalElement = document.querySelector('.max-w-3xl');
  if (!originalElement) {
    alert('Tidak ada konten untuk diekspor.');
    return;
  }

  // Clone elemen asli
  const clone = originalElement.cloneNode(true);
  
  // Hapus elemen-elemen yang tidak diperlukan (UI, tombol, badge, dll)
  const selectorsToRemove = [
    '.no-print',
    '.absolute.top-3.right-3',
    '.absolute.-top-2\\.5',
    '.flex-col.items-center.w-6',
    'button',
    '[class*="badge"]' // semua elemen dengan kata 'badge' di class
  ];
  
  selectorsToRemove.forEach(selector => {
    const elements = clone.querySelectorAll(selector);
    elements.forEach(el => el.remove());
  });

  // Bersihkan juga elemen input judul: ubah menjadi teks biasa
  const titleInput = clone.querySelector('input[type="text"]');
  if (titleInput) {
    const titleText = titleInput.value;
    const titleElement = document.createElement('h1');
    titleElement.className = 'document-title';
    titleElement.textContent = titleText;
    titleInput.parentNode.replaceChild(titleElement, titleInput);
  }

  // Bungkus konten dengan div yang memiliki margin
  const contentWrapper = document.createElement('div');
  contentWrapper.className = 'pdf-content';
  
  // Pindahkan semua anak clone ke dalam wrapper
  while (clone.firstChild) {
    contentWrapper.appendChild(clone.firstChild);
  }
  clone.appendChild(contentWrapper);
  
  // Tambahkan class harvard-export ke clone
  clone.classList.add('harvard-export');

  // Paksa semua elemen untuk menggunakan border-box
  clone.style.boxSizing = 'border-box';

  // Buat container sementara di luar layar untuk rendering
  const container = document.createElement('div');
  container.style.position = 'absolute';
  container.style.left = '-9999px';
  container.style.top = '0';
  container.style.width = '210mm'; // lebar A4
  container.style.backgroundColor = 'white';
  container.style.overflow = 'hidden'; // cegah scrollbar
  container.appendChild(clone);
  document.body.appendChild(container);

  // Opsi html2pdf yang disesuaikan untuk gaya jurnal
  const opt = {
    margin: [0, 0, 0, 0],
    filename: `${docData.title || 'dokumen'}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { 
    scale: 2, 
    letterRendering: true, 
    useCORS: true,
    logging: false // matikan log jika tidak perlu
  },
  jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } // unit mm lebih umum
};

  html2pdf().set(opt).from(clone).save().then(() => {
    document.body.removeChild(container);
  }).catch(err => {
    console.error('PDF export error:', err);
    alert('Gagal mengekspor PDF.');
    document.body.removeChild(container);
  });
};
    const handleUpdateSection = (idx, content) => {
    const sections = [...docData.sections];
    sections[idx] = { ...sections[idx], content };
    setDocData({ ...docData, sections });
  };
  const handleAddSection = () => {
    const newSection = { id: generateId(), sectionKey: 'kustom', content: '<h3>Bagian Baru</h3><p>...</p>', guidance: { en: {}, id: {} }, children: [], aiFeedback: null };
    setDocData({ ...docData, sections: [...docData.sections, newSection] });
    setSelectedIdx(docData.sections.length);
  };
  const handleMove = (idx, dir) => {
    const sections = [...docData.sections];
    const target = idx + dir;
    if (target < 0 || target >= sections.length) return;
    [sections[idx], sections[target]] = [sections[target], sections[idx]];
    setDocData({ ...docData, sections });
    setSelectedIdx(target);
  };
  const handleDelete = (idx) => {
    if (!confirm('Hapus bagian ini?')) return;
    const sections = docData.sections.filter((_, i) => i !== idx);
    setDocData({ ...docData, sections });
    setSelectedIdx(Math.min(idx, sections.length - 1));
  };

  if (view === 'landing') return <LandingPage onSelectTemplate={handleSelectTemplate} onImport={handleImport}/>;

  const mod = docData?.metadata;
  const col = mod ? colorMap[mod.color] : colorMap.blue;
  const activeSection = docData?.sections?.[selectedIdx] || null;
  const hasKey = AI_BRIDGE.hasKey(apiKey);

  return (
    <div className={`flex flex-col h-screen bg-slate-100 overflow-hidden font-sans ${isProcessing ? 'cursor-wait' : ''}`}>
      
      {aiError && <ErrorToast message={aiError} onClose={() => setAiError(null)} onRetry={() => { setAiError(null); if(retryAction) retryAction(); }} />}
      <AIMonitor status={aiStatus} />

      <div className="bg-slate-900 text-white flex items-center justify-between px-4 py-2.5 z-30 no-print shadow-xl">
        <div className="flex items-center gap-3">
          <button onClick={() => setView('landing')} className="flex items-center gap-1 text-slate-400 hover:text-white text-sm transition-colors">
            <ChevronLeft className="w-4 h-4"/> Back
          </button>
          <div className="h-5 w-px bg-slate-700"/>
          <div className="flex items-center gap-2">
            <Cpu className="w-4 h-4 text-blue-400"/>
            {/* 2. GANTI NAMA DI HEADER SINI */}
            <span className="font-bold text-sm text-white">StructureFlow (Angga C.S.)</span>
          </div>
        </div>

        <div className="flex items-center gap-2 bg-slate-800 rounded-full px-3 py-1 border border-slate-700">
            <div className={`w-2 h-2 rounded-full ${hasKey ? 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]' : 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]'}`} />
            <Lock className="w-3 h-3 text-slate-400"/>
            <input 
                type="password" 
                placeholder="Masukkan Gemini API Key" 
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                className="bg-transparent border-none text-xs text-white focus:outline-none w-48 placeholder:text-slate-600"
            />
        </div>

        <div className="flex items-center gap-1.5">
          <button onClick={handleUndo} disabled={history.length===0} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors disabled:opacity-50" title="Undo"><Undo className="w-4 h-4 text-orange-300"/></button>
          <div className="h-5 w-px bg-slate-700 mx-1"/>
          <button onClick={handleSaveJSON} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" title="Save as JSON"><Save className="w-4 h-4"/></button>
          <button onClick={handleExportDoc} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" title="Download as Word"><Download className="w-4 h-4 text-green-300"/></button>
          <button onClick={handleExportPDF} className="p-2 bg-blue-700 hover:bg-blue-600 rounded-lg transition-colors" title="Print PDF"><Printer className="w-4 h-4"/></button>
        </div>
      </div>

      <div className="flex flex-1 overflow-hidden">
        <div className="w-2/3 flex flex-col bg-slate-50 border-r overflow-hidden relative">
          
          {isProcessing && (
              <div className="absolute top-0 left-0 w-full h-1 z-50 ai-thinking"/>
          )}

          <div className="px-6 py-3 border-b bg-white/90 backdrop-blur flex items-center justify-between no-print">
            <div className="flex items-center gap-3">
              <span className="text-xs font-bold uppercase tracking-wider text-slate-400">Document</span>
              <button onClick={handleGlobalAI} disabled={isProcessing}
                className="flex items-center gap-1.5 px-3 py-1.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-xs font-bold rounded-lg transition-colors border border-indigo-200 group">
                {isProcessing ? <Loader2 className="w-3 h-3 animate-spin"/> : <Brain className="w-3 h-3 group-hover:scale-110 transition-transform"/>}
                <span>Global Auto-Draft</span>
              </button>
            </div>
            <button onClick={handleAddSection} className="flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-full shadow-md"><Plus className="w-3 h-3"/> Add Section</button>
          </div>

          <div className="flex-1 overflow-y-auto px-8 py-8 custom-scrollbar">
            <div className="max-w-3xl mx-auto pb-24">
              {docData && (
                <input type="text" value={docData.title}
                  onChange={e => setDocData({ ...docData, title: e.target.value })}
                  className="w-full text-3xl font-black text-slate-800 mb-8 bg-transparent border-b-2 border-transparent hover:border-slate-200 focus:border-blue-400 focus:outline-none transition-all placeholder:text-slate-300 leading-tight"
                />
              )}

              {docData?.sections.map((section, idx) => {
                const isSelected = selectedIdx === idx;
                const isEditing = editingIdx === idx;
                return (
                  <div key={section.id} className="flex gap-3 group/row relative">
                    <div className="flex flex-col items-center w-6 pt-5 no-print flex-shrink-0">
                      <div className={`w-3 h-3 rounded-full border-2 z-10 transition-all duration-200 ${isSelected ? `bg-blue-500 border-blue-500 shadow-lg shadow-blue-400/30` : 'bg-white border-slate-300'}`}/>
                      {idx < docData.sections.length - 1 && <div className="w-0.5 bg-slate-200 flex-1 mt-1"/>}
                    </div>

                    <div className={`flex-1 mb-5 rounded-xl border-2 transition-all duration-200 bg-white cursor-pointer relative
                      ${isSelected ? 'border-blue-500 shadow-xl shadow-blue-500/10' : 'border-slate-200 hover:border-blue-200 hover:shadow-md'}`}
                      onClick={() => { setSelectedIdx(idx); }}>

                      <div className={`absolute -top-2.5 left-3 px-2 py-0.5 text-xs rounded-full border font-medium ${col.badge} no-print`}>
                        {section.sectionKey.replace(/_/g,' ')}
                      </div>

                      <div className="p-5 pt-6">
                        {isEditing ? (
                          <RichTextEditor
                            initialContent={section.content}
                            onSave={val => { handleUpdateSection(idx, val); setEditingIdx(null); }}
                            onCancel={() => setEditingIdx(null)}
                          />
                        ) : (
                          <div onDoubleClick={() => setEditingIdx(idx)}>
                            <div className="prose-card text-sm" dangerouslySetInnerHTML={{ __html: section.content }}/>
                            <div className={`absolute top-3 right-3 flex gap-1 bg-white rounded-lg border border-slate-200 p-0.5 shadow-sm no-print transition-opacity duration-200 ${isSelected ? 'opacity-100' : 'opacity-0 group-hover/row:opacity-100'}`}>
                              <button onClick={e => { e.stopPropagation(); handleNodecardAI(idx); }} disabled={isProcessing} className="p-1.5 hover:bg-purple-50 rounded text-purple-500 border-r border-slate-100" title="Revisi AI"><Sparkles className={`w-3 h-3 ${isProcessing && isSelected ? 'animate-spin' : ''}`}/></button>
                              <button onClick={e => { e.stopPropagation(); handleMove(idx, -1); }} className="p-1.5 hover:bg-slate-100 rounded text-slate-400 hover:text-slate-700"><ArrowUp className="w-3 h-3"/></button>
                              <button onClick={e => { e.stopPropagation(); handleMove(idx, 1); }} className="p-1.5 hover:bg-slate-100 rounded text-slate-400 hover:text-slate-700"><ArrowDown className="w-3 h-3"/></button>
                              <div className="w-px bg-slate-200 my-1"/>
                              <button onClick={e => { e.stopPropagation(); setEditingIdx(idx); }} className="p-1.5 hover:bg-blue-50 rounded text-blue-500"><Edit3 className="w-3 h-3"/></button>
                              <button onClick={e => { e.stopPropagation(); handleDelete(idx); }} className="p-1.5 hover:bg-red-50 rounded text-red-500"><Trash2 className="w-3 h-3"/></button>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>

        <div className="w-1/3 bg-white border-l flex flex-col no-print">
          <div className="px-4 py-3 border-b bg-slate-50 flex items-center justify-between">
            <div className="flex items-center gap-2 font-bold text-slate-700 text-sm">
              <BookOpen className="w-4 h-4 text-blue-500"/> Guidance Engine
            </div>
            
            <div className="flex items-center bg-slate-200 p-1 rounded-full cursor-pointer select-none" onClick={() => setLang(l => l === 'en' ? 'id' : 'en')}>
                <div className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all duration-200 ${lang === 'en' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-600'}`}>EN</div>
                <div className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all duration-200 ${lang === 'id' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-600'}`}>ID</div>
            </div>

          </div>
          <div className="flex-1 overflow-hidden">
            <GuidancePanel 
                section={activeSection} 
                moduleId={docData?.moduleId} 
                lang={lang} 
                onRunAI={() => handleGuidanceAI(selectedIdx)} 
                isProcessing={isProcessing}
                setLang={setLang}
            />
          </div>
        </div>
      </div>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
