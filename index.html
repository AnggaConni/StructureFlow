<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 1. GANTI JUDUL DI SINI -->
    <title>StructureFlow v3.5 — Edisi Angga Conni Saputra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        @keyframes fadeIn { from{opacity:0}to{opacity:1} }
        @keyframes slideUp { from{transform:translateY(16px);opacity:0}to{transform:translateY(0);opacity:1} }
        @keyframes slideRight { from{transform:translateX(12px);opacity:0}to{transform:translateX(0);opacity:1} }
        @keyframes scaleIn { from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1} }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 10%, 30%, 50%, 70%, 90% {transform: translateX(-4px);} 20%, 40%, 60%, 80% {transform: translateX(4px);} }
        .anim-fade { animation: fadeIn .35s ease both; }
        .anim-up { animation: slideUp .4s cubic-bezier(.22,1,.36,1) both; }
        .anim-right { animation: slideRight .3s ease both; }
        .anim-scale { animation: scaleIn .35s cubic-bezier(.22,1,.36,1) both; }
        .anim-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .delay-1 { animation-delay: .05s; }
        .delay-2 { animation-delay: .1s; }
        .delay-3 { animation-delay: .15s; }
        .delay-4 { animation-delay: .2s; }
        @media print { .no-print{display:none!important} }
        .prose-card h1,.prose-card h2,.prose-card h3{margin:.8em 0 .4em;font-weight:600;line-height:1.3}
        .prose-card h3{font-size:1rem;color:#1e40af}
        .prose-card p{margin-bottom:.7em;line-height:1.65;color:#374151}
        .prose-card ul,.prose-card ol{padding-left:1.4em;margin-bottom:.7em}
        .prose-card li{margin-bottom:.3em;color:#374151}
        .prose-card strong{color:#111827;font-weight:600}
        .prose-card em{color:#4b5563}
        .prose-card blockquote{border-left:3px solid #6366f1;padding:.5em 1em;background:#f5f3ff;margin:1em 0;border-radius:0 6px 6px 0;font-style:italic;color:#4338ca}
        
        /* AI Specific Styles */
        .ai-glow { animation: pulse-glow 2s infinite; }
        @keyframes pulse-glow { 0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); } 70% { box-shadow: 0 0 0 6px rgba(99, 102, 241, 0); } 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); } }
        .ai-thinking { background: linear-gradient(270deg, #3b82f6, #8b5cf6, #3b82f6); background-size: 200% 200%; animation: gradient-move 2s ease infinite; }
        @keyframes gradient-move { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        /* === GAYA PUBLIKASI HARVARD UNTUK EKSPOR PDF === */
.harvard-export {
  font-family: 'Garamond', 'Times New Roman', serif !important;
  font-size: 12pt !important;
  line-height: 1.7 !important;
  color: #000 !important;
  background: #fff !important;
  max-width: 100% !important;
  padding: 0 !important;
  margin: 0 auto !important;
  box-sizing: border-box !important;
  overflow-wrap: break-word !important; /* paksa word wrap */
}

/* Margin halaman (standar jurnal 1 inci) */
.harvard-export .pdf-content {
  margin: 2.54cm !important;
  padding: 0 !important;
}

/* PASTIKAN SEMUA ELEMEN TIDAK MELEWATI LEBAR */
.harvard-export * {
  max-width: 100% !important;
  box-sizing: border-box !important;
  word-wrap: break-word !important;
}

.harvard-export img,
.harvard-export table,
.harvard-export pre {
  max-width: 100% !important;
  height: auto !important;
}

.harvard-export table {
  table-layout: fixed !important; /* paksa tabel menyesuaikan lebar */
  word-wrap: break-word !important;
}

.harvard-export pre {
  white-space: pre-wrap !important; /* bungkus teks panjang di kode */
}

/* Judul dokumen */
.harvard-export h1.document-title {
  font-size: 28pt !important;
  font-weight: 700 !important;
  text-align: center !important;
  margin: 0 0 0.8cm 0 !important;
  line-height: 1.3 !important;
  letter-spacing: -0.5px !important;
  color: #1a1a1a !important;
}

/* Abstrak (jika ada) */
.harvard-export .abstract {
  font-size: 11pt !important;
  font-style: italic !important;
  margin: 1.5em 0 !important;
  padding: 0 1em !important;
  border-left: 3px solid #ccc !important;
  color: #333 !important;
}

/* Heading level 1 (bab) */
.harvard-export h2 {
  font-size: 18pt !important;
  font-weight: 700 !important;
  margin-top: 1.5em !important;
  margin-bottom: 0.5em !important;
  color: #000 !important;
  border-bottom: 1px solid #ddd !important;
  padding-bottom: 0.3em !important;
}

/* Heading level 2 (sub-bab) */
.harvard-export h3 {
  font-size: 14pt !important;
  font-weight: 600 !important;
  margin-top: 1.2em !important;
  margin-bottom: 0.3em !important;
  color: #222 !important;
}

/* Paragraf */
.harvard-export p {
  text-align: justify !important;
  margin-bottom: 0.7em !important;
  orphans: 3 !important;
  widows: 3 !important;
}

/* Daftar (bullet/number) */
.harvard-export ul,
.harvard-export ol {
  margin-left: 2em !important;
  margin-bottom: 0.7em !important;
}

/* Tabel dan gambar (jika ada) */
.harvard-export table {
  border-collapse: collapse !important;
  width: 100% !important;
  margin: 1em 0 !important;
}
.harvard-export th,
.harvard-export td {
  border: 1px solid #aaa !important;
  padding: 0.4em !important;
  text-align: left !important;
}
.harvard-export th {
  background-color: #f5f5f5 !important;
  font-weight: 600 !important;
}

/* Nomor halaman (akan ditambahkan otomatis oleh html2pdf) */
/* Tidak perlu CSS khusus, html2pdf.js sudah mengatur page breaks */ 
    </style>
</head>
<body class="bg-slate-100 text-slate-900">
<div id="root"></div>

<script type="text/babel" data-type="module">
import React, { useState, useEffect, useRef, useCallback } from 'react';
import { createRoot } from 'react-dom/client';
import {
    Layout, Plus, Trash2, Edit3, Save, Upload, FileText,
    ArrowUp, ArrowDown, Globe, BookOpen, ChevronLeft,
    Bold, Italic, List, Printer, FolderOpen, Mail,
    Sparkles, GraduationCap, Scale, Newspaper, Megaphone,
    PenTool, BarChart2, Search, Tag, CheckCircle2,
    AlertCircle, Lightbulb, Library, Layers, Cpu, X,
    ChevronDown, ChevronRight, Star, Zap, Info,
    Brain, MessageSquare, Undo, Lock, Unlock, AlertTriangle, Loader2, Download,
    RefreshCw, Terminal
} from 'lucide-react';

/* ═══════════════════════════════════════════════════════════════
   AI BRIDGE — Resilience Layer (FALLBACK ENABLED)
   Sekarang mendukung bahasa dinamis (EN/ID) di setiap prompt.
═══════════════════════════════════════════════════════════════ */

const AI_BRIDGE = {
    models: [
        'gemini-2.5-flash-preview-09-2025',
        'gemini-2.0-flash',
        'gemini-1.5-flash-latest',
        'gemini-1.5-flash',
        'gemini-1.5-pro'
    ],
    hasKey: (key) => !!key && key.length > 10,
    async generate(prompt, apiKey, onProgress) {
        if (!this.hasKey(apiKey)) throw new Error("API Key Tidak Ditemukan atau Tidak Valid");
        let lastError = null;
        for (const model of this.models) {
            try {
                if (onProgress) onProgress(`Mencoba model: ${model}...`);
                const result = await this._callModel(model, prompt, apiKey);
                return result; 
            } catch (e) {
                console.warn(`Model ${model} gagal:`, e.message);
                lastError = e;
            }
        }
        throw new Error(`Semua model AI gagal. Kesalahan terakhir: ${lastError?.message}`);
    },
    async _callModel(model, prompt, apiKey) {
        const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;
        const payload = { contents: [{ parts: [{ text: prompt }] }] };
        const response = await fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        if (!response.ok) {
            let errorMessage = `Kesalahan HTTP ${response.status}`;
            try { const errorBody = await response.json(); if (errorBody.error && errorBody.error.message) errorMessage = errorBody.error.message; } catch (e) { }
            throw new Error(errorMessage);
        }
        const data = await response.json();
        return data.candidates?.[0]?.content?.parts?.[0]?.text || "";
    },
    buildNodeContext: (currentSection, prevSection, nextSection, docMeta, lang) => {
        const targetLang = lang === 'en' ? 'English' : 'Indonesian (Bahasa Indonesia)';
        return `
        KONTEKS DOKUMEN:
        Judul: ${docMeta.title}
        Kategori: ${docMeta.metadata.category}
        Target Audiens: ${docMeta.metadata.target_audience}
        Konteks Bagian Sebelumnya: ${prevSection ? prevSection.content.replace(/<[^>]*>/g, '') : 'Awal dokumen'}
        Konteks Bagian Berikutnya: ${nextSection ? nextSection.content.replace(/<[^>]*>/g, '') : 'Akhir dokumen'}
        Nama Bagian Saat Ini: ${currentSection.sectionKey}
        Isi Saat Ini: ${currentSection.content.replace(/<[^>]*>/g, '')}
        TUGAS:
        Jika isi saat ini kosong, BUAT konten untuk bagian ini.
        Jika sudah ada isi, PERBAIKI dan TINGKATKAN kejelasan, alur, dan nadanya sesuai jenis dokumen.
        BAHASA OUTPUT (PENTING):
        Hasilkan konten sepenuhnya dalam: ${targetLang}.
        BATASAN:
        Kembalikan HANYA tag HTML valid (p, h3, ul, strong). Jangan gunakan markdown. Jangan gunakan pembungkus code block.
        `;
    },
    buildGlobalContext: (sections, docMeta, lang) => {
        const targetLang = lang === 'en' ? 'English' : 'Indonesian (Bahasa Indonesia)';
        const outline = sections.map(s => ({ id: s.id, key: s.sectionKey, isEmpty: s.content.includes('[Write here') || s.content.length < 50, content: s.content }));
        return `
        SYSTEM: Kamu adalah editor akademis dan profesional ahli.
        TUGAS: Tinjau struktur dokumen ini.
        1. Untuk bagian kosong, buat konten berdasarkan kunci bagian dan konteks sekitar.
        2. Untuk bagian yang sudah ada, pertajam bahasanya.
        3. Pertahankan hierarki struktural yang tepat.
        BAHASA OUTPUT (PENTING):
        Semua konten "content" dalam JSON harus ditulis dalam: ${targetLang}.
        DOKUMEN:
        Judul: ${docMeta.title}
        Jenis: ${docMeta.metadata.name}
        DATA INPUT (JSON):
        ${JSON.stringify(outline)}
        FORMAT OUTPUT:
        Kembalikan HANYA array JSON mentah berisi objek dengan field 'id' dan 'content'. 
        Contoh: [{"id": "123", "content": "<h3>...</h3><p>...</p>"}, ...]
        Jangan ubah ID. Jangan hapus node.
        `;
    },
    buildGuidanceContext: (sectionContent, guidanceData, lang) => {
        const targetLang = lang === 'en' ? 'English' : 'Indonesian (Bahasa Indonesia)';
        return `
        ACT AS: Writing coach ahli.
        LANGUAGE: ${targetLang}
        DRAFT USER:
        "${sectionContent.replace(/<[^>]*>/g, '')}"
        TUJUAN BAGIAN INI:
        ${guidanceData.what}
        TUGAS:
        Berikan 3 poin masukan spesifik.
        1. Kekuatan (apa yang sudah baik).
        2. Celah Struktural (apa yang kurang berdasarkan tujuan).
        3. Tips Perbaikan (bagaimana membuatnya lebih baik).
        BATASAN:
        Jangan tuliskan isinya untuk mereka. Tetap singkat (di bawah 100 kata).
        `;
    }
};

/* ═══════════════════════════════════════════════════════════════
   MODULE DATA & CONFIGURATION
   PAK ANGGA, EDIT DI BAWAH INI UNTUK MENAMBAH TEMPLATE
═══════════════════════════════════════════════════════════════ */

const SCHEMA_VERSION = '3.0.0';

// 1. DUMMY DATA (Isi konten contoh - English Only)
const DUMMY_DATA = {
  journal_article: {
    title: 'Architecting Resilience: A Comprehensive Analysis of Serverless Digital Ecosystems for Governance Reform in Emerging Economies',
    sections: [
      { 
        key: 'abstract', 
        content: `<h3>Abstract</h3>
        <p>The global landscape of digital governance is often marred by the failure of high-cost, monolithic infrastructure projects that fail to adapt to the local realities of developing nations. This research explores the "Serverless Democratization" paradigm, focusing on the utilization of low-cost, high-context digital tools—collectively termed the "Google Fullstack" (Apps Script, Sheets, and Cloud-native automation). Through a multi-year analysis of projects ranging from vaccine cold chain management to digital correspondence in Indonesian ministries, this paper argues that decentralized, agile development models provide a more resilient framework for institutional reform than traditional ERP systems. The study concludes that by lowering the technical barrier to entry, organizations can foster a culture of "Civic Tech" that is both sustainable and immune to the common pitfalls of bureaucratic IT procurement.</p>` 
      },
      { 
        key: 'introduction', 
        content: `<h3>1. Introduction: The Crisis of Complexity</h3>
        <p>In the realm of public sector digital transformation, there exists a persistent "Complexity Trap." Organizations, particularly in the Global South, often equate "Modernization" with the acquisition of expensive, enterprise-grade software licenses and the construction of local data centers. However, historical data from UNESCO and UNDP initiatives suggest that these "Digital White Elephants" frequently collapse under the weight of their own maintenance requirements, lack of specialized personnel, and the rapid obsolescence of hardware.</p>
        <p>This research is situated at the intersection of public policy administration and digital system architecture. It addresses a fundamental question: How can resource-constrained institutions achieve 100% digital maturity without a multi-million dollar budget? The introduction of serverless computing—specifically Function-as-a-Service (FaaS)—has fundamentally altered the cost-benefit analysis of digital reform. By shifting the burden of infrastructure security and uptime to global cloud providers, local administrators can refocus their energy on the business logic of governance: transparency, efficiency, and accountability.</p>
        <p>Furthermore, this paper examines the role of the "Independent Consultant" as a bridge between high-level policy goals and ground-level technical execution. Drawing from over 12 years of experience in the Indonesian governance sector, we analyze how "Sub-Professional" staff and agile developers can bypass traditional bureaucratic bottlenecks to deliver functional tools (Minimum Viable Products) in days rather than years.</p>` 
      },
      { 
        key: 'literature_review', 
        content: `<h3>2. Literature Review: Frugal Innovation and the Evolution of Cloud</h3>
        <p>The concept of <strong>Frugal Innovation</strong> (Radjou et al., 2012) serves as the foundational theory for this study. It posits that high-value solutions can be derived from minimal resources through creative improvisation and a deep understanding of local constraints. In the context of IT, this translates to the "Google Fullstack" approach—using pervasive tools like Google Sheets not merely as spreadsheets, but as relational database surrogates that are already whitelisted by government firewalls.</p>
        <p>Historically, digital governance has moved through three distinct phases:
        <ol>
          <li><strong>The Monolithic Era (1990-2010):</strong> Heavy reliance on on-premise servers and proprietary software like SAP or Oracle. High cost, low agility.</li>
          <li><strong>The Early Cloud Era (2010-2020):</strong> Migration of virtual machines to AWS or Azure (IaaS). Reduced hardware costs, but still requiring high DevOps expertise.</li>
          <li><strong>The Serverless Era (2020-Present):</strong> The rise of "No-Ops" environments where code (like Google Apps Script) runs in response to events. This era marks the true democratization of digital tools.</li>
        </ol>
        <p>By reviewing the work of contemporary digital architects in the Indonesian public sector, it becomes clear that the most successful projects are those that embrace "Agile Governance." This involves small, iterative deployments that solve specific pain points—such as the "E-Persuratan" system—rather than attempting to build all-encompassing "Super-Apps" that are prone to catastrophic failure during the transition period.</p>` 
      },
      { 
        key: 'framework', 
        content: `<h3>3. Theoretical Framework: Behavioral Science and Information Warfare</h3>
        <p>A digital system is only as effective as the human behavior it influences. Our framework synthesizes three core disciplines: <strong>Behavioral Psychology (COM-B Model)</strong>, <strong>Media Synchronicity Theory (MST)</strong>, and <strong>Strategic Communication (Information Warfare)</strong>.</p>
        <p><strong>3.1 The COM-B Integration:</strong> 
        The system must ensure that users have the <i>Capability</i> (a simple, familiar UI), the <i>Opportunity</i> (mobile-first accessibility), and the <i>Motivation</i> (immediate visible reduction in workload). If a digital correspondence tool requires 10 steps to sign a document when the manual process takes only 2, the system will fail regardless of its technical brilliance.</p>
        <p><strong>3.2 Information Warfare and "Canary Traps" in Bureaucracy:</strong> 
        In high-stakes governance environments, digital tools often serve a dual purpose: workflow automation and information security. We explore the use of "Canary Traps" within digital systems—deliberately placing unique, trackable data points in sensitive documents to identify the source of information leaks. This "Strategic Transparency" acts as a deterrent against internal sabotage and ensures that the "Chain of Custody" for government documents is immutable and auditable.</p>
        <p><strong>3.3 The Paradox of Safety:</strong> 
        We argue that many safety protocols in traditional IT are performative. A system that is "too secure to use" is, in fact, the most dangerous, as it drives users to use unencrypted personal apps (like WhatsApp) for official business. Our framework advocates for "Usable Security"—leveraging Google’s OAuth2 and 2FA to provide enterprise-grade protection that doesn't hinder the user experience.</p>` 
      },
      { 
        key: 'methodology', 
        content: `<h3>4. Methodology: Action Research and Fullstack Prototyping</h3>
        <p>This research utilizes an <strong>Action Research</strong> methodology, characterized by a spiral of cycles: planning, acting, observing, and reflecting. The primary research "laboratory" consists of several real-world deployments across Indonesian NGOs and government agencies between 2022 and 2026.</p>
        <p><strong>4.1 Technical Architecture of the "Dummy" Prototypes:</strong>
        The research focuses on a serverless stack optimized for zero-cost maintenance:
        <ul>
          <li><strong>Logic Layer:</strong> Google Apps Script (V8 Engine) using <code>doGet()</code> and <code>doPost()</code> functions to handle web requests.</li>
          <li><strong>Data Persistence:</strong> Google Sheets API as a NoSQL database. We utilize <i>A1 Notation</i> for rapid querying and <i>JSON-stringification</i> to store complex objects within single cells, bypassing the 5-million-cell limit of standard sheets.</li>
          <li><strong>User Interface:</strong> A decoupled frontend built with Bootstrap 5, utilizing <code>google.script.run</code> for asynchronous communication between the client and the server.</li>
        </ul>
        <p><strong>4.2 Evaluation Metrics:</strong>
        Systems were evaluated based on the <i>"Agility Index"</i> (time from requirement to deployment), <i>"Friction Coefficient"</i> (number of clicks per core task), and <i>"Maintenance Overhead"</i> (man-hours required per month to keep the system operational).</p>` 
      },
      { 
        key: 'findings', 
        content: `<h3>5. Findings: The Efficiency of Serverless Governance</h3>
        <p>The implementation of serverless tools yielded significant empirical data across multiple sectors. In the "E-Persuratan" case study, the time required to route an official letter through three levels of approval dropped from 72 hours (manual/hybrid) to 4.5 minutes (fully digital). This represents a **94% increase in administrative velocity**.</p>
        <p><strong>5.1 Cost-Effectiveness Analysis:</strong>
        Compared to a standard vendor-based ERP deployment (estimated at $50,000 USD initial + $5,000/year maintenance), the Google Fullstack solution cost exactly $0 in licensing fees. The only "cost" was the human capital required for the 72-hour development sprint. This proves that for "Sub-Professional" tasks, high-cost procurement is economically irrational.</p>
        <p><strong>5.2 Resilience in Remote Areas (The "Papua-Jambi" Effect):</strong>
        Data from projects in Jayapura (UNDP Vaccine Cold Chain) and Jambi (Infrastructure Gini Ratio Research) showed that lightweight web apps performed significantly better on low-bandwidth 3G/4G connections than heavy Java-based government portals. The "Low-Text, High-Context" UI design reduced data consumption by 60%, ensuring that officials in remote disadvantaged regions remained part of the digital workflow.</p>` 
      },
      { 
        key: 'discussion', 
        content: `<h3>6. Discussion: The Philosophy of "Good Enough" and Divergent Thinking</h3>
        <p>The findings challenge the "Perfectionist Fallacy" in digital development. We argue for the <strong>Philosophy of "Good Enough" Tech</strong>—where a tool that solves 90% of a problem today is infinitely more valuable than a tool that solves 100% of a problem next year. This is particularly relevant for "Divergent" thinkers (such as the primary subject of this case study) who prioritize output and functional iteration over rigid documentation.</p>
        <p>Furthermore, the discussion addresses the "Information Warfare" aspect of digital transition. By making government processes digital and serverless, we create a "Digital Footprint" that is difficult to erase. This transparency acts as a strategic weapon against corruption (KKN). However, it also requires a shift in leadership mindset: from "Gatekeepers of Information" to "Facilitators of Data." The resistance to these tools is rarely technical; it is almost always a defense mechanism by individuals who benefit from the opacity of manual systems.</p>` 
      },
      { 
        key: 'conclusion', 
        content: `<h3>7. Conclusion: The Future is Serverless and Decentralized</h3>
        <p>The path to governance reform does not lie in more servers, but in smarter code. Democratizing digital tools through serverless architectures allows for a bottom-up transformation where the workers themselves become the architects of their efficiency. As demonstrated by the success of the "E-Persuratan" and "Biodiversity" systems, the future belongs to agile, low-cost, and high-impact solutions. We recommend that international organizations (UN, GAVI, etc.) and government ministries pivot their digital strategies to prioritize "Civic Tech" ecosystems that empower independent consultants and sub-professional staff to build the future of governance, one script at a time.</p>` 
      }
    ]
  },
  
  /* --- AREA EDIT (PAK ANGGA): TAMBAH DUMMY DATA BARU DI SINI --- */
  /* ID harus sama dengan di Module Registry nanti */
  
  project_proposal: { 
  title: 'Nusantara Blue Guardians: Empowering Coastal Youth through Data-Driven Ocean Literacy', 
  sections: [
    { 
      key: 'executive_summary', 
      content: `
        <h3>1. Executive Summary</h3>
        <p><strong>Project Title:</strong> Nusantara Blue Guardians<br>
        <strong>Duration:</strong> 18 Months<br>
        <strong>Location:</strong> Pilot in 3 Provinces (North Sulawesi, Maluku, West Nusa Tenggara)<br>
        <strong>Total Budget Request:</strong> $85,000 USD</p>
        
        <p>Indonesia, the world's largest archipelagic state, stands at a critical juncture. While the nation contributes significantly to global marine biodiversity, it also ranks as a major source of marine plastic debris. Current interventions often suffer from a "top-down" approach, relying on external consultants and generalized data that fails to reflect the hyper-local reality of coastal villages.</p>
        
        <p>The <strong>Nusantara Blue Guardians</strong> initiative proposes a paradigm shift: turning coastal youth from passive observers into active <em>Citizen Scientists</em>. By combining <strong>Contextual Ocean Ethics</strong> (reviving local maritime wisdom) with <strong>Modern Digital Tools</strong> (a custom offline-first data app), we aim to bridge the gap between national policy and village-level execution.</p>
        
        <p><strong>Core Objectives:</strong></p>
        <ul>
          <li><strong>Empower:</strong> Train 500 NEET (Not in Education, Employment, or Training) youth as certified "Blue Guardians."</li>
          <li><strong>Digitize:</strong> Deploy "LautKita," a low-bandwidth Progressive Web App (PWA) for granular marine debris auditing.</li>
          <li><strong>Influence:</strong> Generate 5 "Village Ocean State Reports" to secure ongoing allocation from the Village Fund (Dana Desa).</li>
        </ul>
      ` 
    },
    { 
      key: 'situational_analysis', 
      content: `
        <h3>2. Situational Analysis & Rationale</h3>
        
        <h4>2.1 The Problem: Data Scarcity & Youth Disengagement</h4>
        <p>Despite strong national commitments (e.g., reducing marine debris by 70% by 2025), implementation at the district level is hampered by:</p>
        <ul>
          <li><strong>The "Data Vacuum":</strong> Dinas Lingkungan Hidup (Local Environmental Agencies) often lack budget for regular monitoring. They rely on estimated national averages rather than actual local data, leading to inefficient resource allocation.</li>
          <li><strong>The "Scientific Disconnect":</strong> Ocean literacy materials are often direct translations of Western textbooks. They discuss "ocean acidification" in abstract terms but fail to address immediate local threats like blast fishing or plastic sachets, making conservation seem like an "elite" concern.</li>
        </ul>

        <h4>2.2 Policy Alignment</h4>
        <p>This project directly supports:</p>
        <ul>
          <li><strong>UN SDG 14.1:</strong> Prevent and significantly reduce marine pollution.</li>
          <li><strong>RPJMN (Indonesian National Medium-Term Development Plan):</strong> Strengthening the "Poros Maritim Dunia" identity.</li>
        </ul>
      ` 
    },
    { 
      key: 'methodology', 
      content: `
        <h3>3. Methodology: The "Data-to-Action" Loop</h3>
        <p>We utilize a <strong>Participatory Action Research (PAR)</strong> approach, ensuring the community owns the data they collect. The methodology follows a three-step cycle:</p>
        
        <div style="background:#eef; padding:15px; margin:10px 0; border-left: 5px solid #0056b3;">
          <p><strong>Step 1: Calibration (Social & Tech)</strong><br>
          We do not just "drop" technology. We first calibrate the social understanding through "Ocean Ethics" workshops that blend modern science with local customary law (<em>Hukum Adat</em>, e.g., <em>Sasi</em> in Maluku).</p>
          
          <p><strong>Step 2: Collection (Citizen Science)</strong><br>
          Youth use the "LautKita" app to conduct rigorous beach audits. The app uses gamification to ensure consistent data quality (e.g., distinguishing between branded plastics vs. generic waste).</p>
          
          <p><strong>Step 3: Advocacy (Data Diplomacy)</strong><br>
          Raw data is useless without interpretation. We train youth to visualize this data and present it to Village Heads (Kepala Desa) to advocate for waste management budgets.</p>
        </div>
      ` 
    },
    { 
      key: 'technical_implementation', 
      content: `
        <h3>4. Detailed Implementation Plan</h3>
        
        <h4>Phase 1: Foundation & Tech Development (Months 1-4)</h4>
        <ul>
          <li><strong>Activity 1.1: "LautKita" App Development.</strong> Building an offline-first PWA. Key features: GPS tagging accuracy <5m, image recognition assistance for debris categorization, and auto-sync when Wi-Fi is available.</li>
          <li><strong>Activity 1.2: Curriculum Design.</strong> Developing the "Blue Guardian" handbook, integrating localized marine ecology modules.</li>
        </ul>

        <h4>Phase 2: Train-the-Trainers (ToT) (Months 5-6)</h4>
        <ul>
          <li><strong>Activity 2.1: Recruitment.</strong> Selecting 50 "Regional Coordinators" based on leadership potential, not just academic grades.</li>
          <li><strong>Activity 2.2: The Bootcamp.</strong> A 5-day intensive workshop on data integrity, community organizing, and safety protocols.</li>
        </ul>

        <h4>Phase 3: Mass Deployment (Months 7-15)</h4>
        <ul>
          <li><strong>Activity 3.1: Village Activation.</strong> Each Coordinator trains 10 local volunteers (Total: 500 youth).</li>
          <li><strong>Activity 3.2: Monthly "Data Dives".</strong> Synchronized coastal cleanup and auditing events across all pilot sites to create comparable datasets.</li>
        </ul>

        <h4>Phase 4: Synthesis & Policy Advocacy (Months 16-18)</h4>
        <ul>
          <li><strong>Activity 4.1: Data Visualization Workshop.</strong> Teaching youth how to turn spreadsheets into infographics.</li>
          <li><strong>Activity 4.2: Town Halls (Musrenbangdes).</strong> Youth present their "Village Ocean Reports" formally to local government to influence the next fiscal year's budget planning.</li>
        </ul>
      ` 
    },
    { 
      key: 'logframe', 
      content: `
        <h3>5. Logical Framework (LogFrame) & Indicators</h3>
        <table border="1" cellpadding="10" style="border-collapse: collapse; width: 100%; border-color: #ddd;">
          <tr style="background-color: #f2f2f2;">
            <th>Hierarchy</th>
            <th>Indicators (KPIs)</th>
            <th>Means of Verification</th>
          </tr>
          <tr>
            <td><strong>Impact</strong> (Long Term)</td>
            <td>Increased resilience of coastal communities against marine pollution.</td>
            <td>Local government budget allocation for waste management increases by 20% in target villages.</td>
          </tr>
          <tr>
            <td><strong>Outcome</strong> (Medium Term)</td>
            <td>Establishment of a reliable, community-sourced marine database.</td>
            <td>5 "Village Ocean Reports" formally accepted by Dinas Lingkungan Hidup.</td>
          </tr>
          <tr>
            <td><strong>Outputs</strong> (Short Term)</td>
            <td>
              1. 500 Youth trained.<br>
              2. 10 Tons of debris removed & audited.<br>
              3. App deployed with >1,000 unique data points.
            </td>
            <td>Training attendance lists, App database logs, Weigh station receipts.</td>
          </tr>
        </table>
      ` 
    },
    { 
      key: 'budget_narrative', 
      content: `
        <h3>6. Budget Narrative & Justification</h3>
        <p><strong>Total Request: $85,000 USD</strong></p>
        
        <h4>A. Personnel (30% - $25,500)</h4>
        <p>This project is human-capital intensive. The budget covers a full-time Project Manager, a Technical Lead (for App maintenance), and stipends for 5 Regional Field Coordinators. <em>Note: We pay above minimum wage to ensure retention of high-quality talent.</em></p>
        
        <h4>B. Program Activities (40% - $34,000)</h4>
        <p>Includes logistics for the "ToT Bootcamp" (accommodation, transport for 50 people), safety gear (gloves, boots) for 500 volunteers, and local transport for monthly audits. Also covers the "Town Hall" meeting costs (snacks/venue) for advocacy sessions.</p>
        
        <h4>C. Technology & Data (15% - $12,750)</h4>
        <p>Covers server hosting (cloud), domain registration, and procurement of 10 ruggedized tablets for communal use in villages where youth do not own smartphones.</p>
        
        <h4>D. Monitoring & Overhead (15% - $12,750)</h4>
        <p>Independent external audit (required by law for NGOs), bank fees, and administrative overhead (office rent/utilities).</p>
      ` 
    },
    { 
      key: 'sustainability', 
      content: `
        <h3>7. Sustainability & Exit Strategy</h3>
        <p><strong>Technical Sustainability:</strong> The "LautKita" app code will be open-sourced on GitHub. Local university partners (e.g., UNHAS, UNPATTI) have signed MOUs to maintain the server post-project.</p>
        <p><strong>Financial Sustainability:</strong> By integrating the waste management plan into the <em>Village Fund (Dana Desa)</em>, the operational costs for waste collection will be absorbed by the local government budget, removing dependency on external grants.</p>
      ` 
    }
  ] 
},
    conference_paper: { 
  title: 'Adaptive Attention Mechanisms in Transformer Architectures', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>Recent advances in transformer models have relied on fixed attention patterns. This paper proposes a novel adaptive attention mechanism that dynamically adjusts receptive fields based on input complexity. Experiments on GLUE and SuperGLUE benchmarks show a 2.3% average improvement while reducing FLOPs by 15%.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The transformer architecture has become ubiquitous in NLP. However, its fixed attention patterns may be suboptimal for varying input lengths and complexities. We introduce AdaAttn, a module that learns to allocate attention spans per layer and head. We demonstrate its effectiveness on multiple tasks.</p>` },
    { key: 'related_work', content: `<h3>2. Related Work</h3><p>Previous work has explored sparse attention (Child et al., 2019) and adaptive computation time (Graves, 2016). Our work differs by making attention span a learnable parameter conditioned on input.</p>` },
    { key: 'method', content: `<h3>3. Method</h3><p>We augment each attention head with a learnable gate that controls the effective context size. The gate is a sigmoid over a learned embedding. The model is trained end-to-end with the standard cross-entropy loss.</p>` },
    { key: 'experiments', content: `<h3>4. Experiments</h3><p>We evaluate on GLUE (Wang et al., 2018) and SuperGLUE. We compare against BERT-base and RoBERTa-base. Results show AdaAttn outperforms baselines on 7 out of 11 tasks.</p>` },
    { key: 'conclusion', content: `<h3>5. Conclusion</h3><p>We presented an adaptive attention mechanism that improves efficiency and performance. Future work includes applying it to long-document tasks.</p>` }
  ] 
},
research_report: { 
  title: 'Urban Mobility Transitions in Post-Pandemic Cities', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This report examines shifts in urban mobility patterns following the COVID-19 pandemic. Using data from 12 global cities, we identify a sustained increase in cycling and micro-mobility usage, and a decline in public transit ridership. Recommendations for urban planners are provided.</p>` },
    { key: 'background', content: `<h3>1. Background</h3><p>The pandemic accelerated changes in how people move. Lockdowns led to a temporary drop in all travel, but as economies reopen, modal splits have shifted. This study investigates whether these changes are temporary or permanent.</p>` },
    { key: 'methodology', content: `<h3>2. Methodology</h3><p>We collected anonymized mobile phone data, public transport usage statistics, and cycling counts from 12 cities across North America, Europe, and Asia. Data spans 2019–2023. We applied interrupted time series analysis.</p>` },
    { key: 'findings', content: `<h3>3. Findings</h3><p>Cycling increased by an average of 42% compared to pre-pandemic levels. Public transit ridership remains 25% below 2019 levels. Car usage has returned to near pre-pandemic levels. Significant variation exists between cities.</p>` },
    { key: 'recommendations', content: `<h3>4. Recommendations</h3><p>Cities should invest in protected cycling infrastructure, reconsider road space allocation, and explore integrated mobility-as-a-service platforms to boost public transit.</p>` }
  ] 
},
working_paper: { 
  title: 'Generative AI and Labor Market Dynamics: A Preliminary Analysis', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This working paper explores the early impact of generative AI on employment across sectors. Using job posting data from 2022–2024, we find that occupations involving writing and coding are experiencing significant shifts, with a 12% decline in entry-level postings. We discuss implications for workforce development.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The rapid adoption of generative AI tools like ChatGPT has raised concerns about job displacement. This paper provides preliminary evidence on how firms are adjusting their hiring.</p>` },
    { key: 'literature_review', content: `<h3>2. Literature Review</h3><p>Previous studies on automation (Acemoglu & Restrepo, 2020) have focused on routine tasks. Generative AI targets non-routine cognitive tasks, suggesting a new wave of automation.</p>` },
    { key: 'theoretical_framework', content: `<h3>3. Theoretical Framework</h3><p>We draw on task-based models of labor demand, where AI substitutes for certain tasks and complements others.</p>` },
    { key: 'preliminary_analysis', content: `<h3>4. Preliminary Analysis</h3><p>Using Burning Glass Technologies data, we analyze job postings in 10 occupational groups. We find significant declines in writing-intensive roles, but increases in AI-related roles.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>These early trends suggest a need for reskilling programs and updated labor market policies.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>Ongoing research will refine these estimates and explore heterogeneity by firm size and industry.</p>` }
  ] 
},
dissertation_thesis: { 
  title: 'Essays on the Economics of Digital Platforms', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This dissertation comprises three essays examining the economic effects of digital platforms. The first essay studies market power in app stores. The second analyzes labor supply on gig platforms. The third investigates algorithmic pricing and collusion. Using a combination of structural models and reduced-form methods, I find significant welfare implications for consumers and workers.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>Digital platforms have transformed markets, but their economic impacts are not fully understood. This dissertation aims to fill that gap.</p>` },
    { key: 'literature_review', content: `<h3>2. Literature Review</h3><p>I review the literature on two-sided markets, platform governance, and gig economy.</p>` },
    { key: 'methodology', content: `<h3>3. Methodology</h3><p>Essay 1 uses a differentiated products demand model. Essay 2 applies dynamic panel data methods. Essay 3 uses algorithmic collusion simulations.</p>` },
    { key: 'findings', content: `<h3>4. Findings</h3><p>I find that app store fees lead to higher consumer prices; gig workers face significant earnings volatility; and algorithmic pricing can sustain collusion without communication.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>The results have implications for antitrust policy and labor regulation.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>Future work should explore platform design interventions.</p>` },
    { key: 'references', content: `<h3>References</h3><p>[1] Rochet, J.-C., & Tirole, J. (2003). Platform competition...<br>[2] etc.</p>` }
  ] 
},
policy_brief: { 
  title: 'Expanding Access to Early Childhood Education', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>Only 60% of low-income children have access to pre-K programs. This brief recommends a federal-state partnership to fund universal pre-K, estimating a net economic benefit of $8,000 per child over their lifetime.</p>` },
    { key: 'key_recommendations', content: `<h3>Key Recommendations</h3><ul><li>Increase federal matching funds for state pre-K programs.</li><li>Establish quality standards and training requirements.</li><li>Integrate with existing childcare subsidies.</li></ul>` },
    { key: 'context', content: `<h3>Context</h3><p>Research shows that early childhood education yields high returns, yet access remains unequal.</p>` },
    { key: 'evidence', content: `<h3>Evidence</h3><p>Studies from Chicago and Boston show participants have higher graduation rates and earnings. Cost-benefit analyses suggest a benefit-cost ratio of 7:1.</p>` },
    { key: 'implications', content: `<h3>Implications</h3><p>Universal pre-K could reduce achievement gaps and boost long-term productivity.</p>` },
    { key: 'conclusion', content: `<h3>Conclusion</h3><p>Policymakers should act now to expand access.</p>` }
  ] 
},
policy_paper: { 
  title: 'Reforming the Renewable Energy Subsidy Framework', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>Current renewable energy subsidies are inefficient and regressive. This paper analyzes three reform options: a carbon tax with rebate, a clean energy standard, and technology-neutral auctions. We recommend a phased transition to technology-neutral auctions combined with a carbon price floor.</p>` },
    { key: 'problem_definition', content: `<h3>1. Problem Definition</h3><p>Subsidies vary widely by technology, leading to market distortions and high costs to consumers.</p>` },
    { key: 'policy_options', content: `<h3>2. Policy Options</h3><p>Option A: Carbon tax with revenue recycling. Option B: Clean energy standard. Option C: Technology-neutral auctions.</p>` },
    { key: 'analysis', content: `<h3>3. Analysis</h3><p>We evaluate each option on cost-effectiveness, equity, and political feasibility. Auctions score highest on cost but require careful design.</p>` },
    { key: 'recommendations', content: `<h3>4. Recommendations</h3><p>Implement auctions for all new renewable capacity, with set-asides for emerging technologies. Phase out production tax credits over five years.</p>` },
    { key: 'implementation', content: `<h3>5. Implementation</h3><p>Create an independent agency to run auctions. Coordinate with states.</p>` }
  ] 
},
white_paper: { 
  title: 'Zero-Trust Architecture for Cloud Security', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>As organizations migrate to the cloud, traditional perimeter-based security is inadequate. Zero-trust architecture (ZTA) assumes no implicit trust and verifies every access request. This white paper outlines a framework for implementing ZTA, including key components and deployment roadmap.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>The rise of remote work and cloud services has blurred network perimeters. ZTA offers a more robust security model.</p>` },
    { key: 'current_challenges', content: `<h3>2. Current Challenges</h3><p>VPN vulnerabilities, insider threats, and complex identity management.</p>` },
    { key: 'proposed_solution', content: `<h3>3. Proposed Solution</h3><p>Implement ZTA using micro-segmentation, continuous monitoring, and identity-aware proxies.</p>` },
    { key: 'benefits', content: `<h3>4. Benefits</h3><p>Reduced attack surface, improved compliance, and better user experience.</p>` },
    { key: 'roadmap', content: `<h3>5. Roadmap</h3><p>Phase 1: Inventory and classify assets. Phase 2: Deploy identity and access management. Phase 3: Implement micro-segmentation. Phase 4: Continuous monitoring and analytics.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>ZTA is essential for modern cloud security. Organizations should start now.</p>` }
  ] 
},
position_paper: { 
  title: 'Position on Data Localization Requirements', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This paper presents the Chamber of Commerce's position on data localization laws. While we recognize data privacy concerns, we argue that mandatory data localization harms trade, increases costs, and does not necessarily improve security. We advocate for interoperability frameworks and cross-border data flows with strong privacy safeguards.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>Several countries have introduced data localization requirements. This paper examines their impact.</p>` },
    { key: 'stance', content: `<h3>2. Stance</h3><p>We oppose mandatory data localization. Instead, we support mutual recognition of privacy regimes.</p>` },
    { key: 'arguments', content: `<h3>3. Arguments</h3><p>Localization raises costs for SMEs, fragments the internet, and can lead to trade retaliation.</p>` },
    { key: 'counterarguments', content: `<h3>4. Counterarguments</h3><p>Proponents argue localization protects privacy and national security. However, existing privacy laws like GDPR already provide strong protections without localization.</p>` },
    { key: 'conclusion', content: `<h3>5. Conclusion</h3><p>We urge policymakers to reject data localization and pursue international agreements on data flows.</p>` }
  ] 
},
technical_report: { 
  title: 'Performance Evaluation of LoRaWAN in Urban Environments', 
  sections: [
    { key: 'abstract', content: `<h3>Abstract</h3><p>This technical report evaluates the performance of LoRaWAN networks in dense urban settings. We deployed 20 gateways and 500 end devices across a 10 km² area. Results show a packet delivery ratio of 92% for distances up to 2 km, but significant interference in high-rise zones. Recommendations for network planning are provided.</p>` },
    { key: 'introduction', content: `<h3>1. Introduction</h3><p>LoRaWAN is a popular LPWAN technology, but its performance in urban canyons is not well documented.</p>` },
    { key: 'system_overview', content: `<h3>2. System Overview</h3><p>We used Multitech gateways and various end devices. The network operates at 868 MHz.</p>` },
    { key: 'methodology', content: `<h3>3. Methodology</h3><p>We measured RSSI, SNR, and packet loss at multiple locations. Data was collected over 30 days.</p>` },
    { key: 'results', content: `<h3>4. Results</h3><p>Average RSSI: -95 dBm; SNR: 6 dB; packet delivery ratio: 92% line-of-sight, 78% non-line-of-sight.</p>` },
    { key: 'discussion', content: `<h3>5. Discussion</h3><p>Interference from other devices and multipath fading are major issues. Increasing gateway density can mitigate.</p>` },
    { key: 'conclusion', content: `<h3>6. Conclusion</h3><p>LoRaWAN is viable for urban IoT but requires careful planning.</p>` }
  ] 
},
guideline_sop: { 
  title: 'Standard Operating Procedure for Clinical Trial Data Management', 
  sections: [
    { key: 'purpose', content: `<h3>1. Purpose</h3><p>This SOP defines the procedures for data collection, entry, validation, and storage in clinical trials to ensure compliance with GCP guidelines.</p>` },
    { key: 'scope', content: `<h3>2. Scope</h3><p>Applies to all clinical trial staff involved in data management.</p>` },
    { key: 'definitions', content: `<h3>3. Definitions</h3><p>CRF: Case Report Form; eCRF: electronic Case Report Form; Query: request for clarification.</p>` },
    { key: 'responsibilities', content: `<h3>4. Responsibilities</h3><p>Data Manager: oversees data entry and validation. CRA: monitors data quality. Investigator: ensures accuracy.</p>` },
    { key: 'procedure', content: `<h3>5. Procedure</h3><ol><li>Data entry within 5 days of visit.</li><li>Automated validation checks.</li><li>Query resolution within 3 days.</li><li>Database lock after final monitoring visit.</li></ol>` },
    { key: 'compliance', content: `<h3>6. Compliance</h3><p>Non-compliance will be reported to QA and may result in corrective action.</p>` },
    { key: 'references', content: `<h3>7. References</h3><p>ICH GCP E6(R2); 21 CFR Part 11.</p>` }
  ] 
},
regulatory_impact_assessment: { 
  title: 'RIA of Proposed Fuel Economy Standards for Light-Duty Vehicles', 
  sections: [
    { key: 'executive_summary', content: `<h3>Executive Summary</h3><p>This RIA assesses the proposed rule to increase average fuel economy to 55 mpg by 2026. Benefits include reduced greenhouse gas emissions and fuel savings, while costs include higher vehicle prices. Net benefits are estimated at $150 billion over 30 years.</p>` },
    { key: 'problem_identification', content: `<h3>1. Problem Identification</h3><p>Transportation accounts for 29% of U.S. GHG emissions. Current standards are insufficient to meet climate goals.</p>` },
    { key: 'objectives', content: `<h3>2. Objectives</h3><p>Reduce emissions, reduce oil dependence, and provide consumer savings.</p>` },
    { key: 'options', content: `<h3>3. Options</h3><p>Option 1: No action. Option 2: 50 mpg by 2026. Option 3: 55 mpg by 2026 (preferred). Option 4: 60 mpg by 2026.</p>` },
    { key: 'impact_analysis', content: `<h3>4. Impact Analysis</h3><p>Option 3 yields the highest net benefits. Costs: +$1,500 per vehicle. Benefits: $4,000 fuel savings per vehicle over lifetime, 200 Mt CO2 reduction.</p>` },
    { key: 'consultation', content: `<h3>5. Consultation</h3><p>Stakeholder comments from automakers, environmental groups, and consumers were considered.</p>` },
    { key: 'recommendation', content: `<h3>6. Recommendation</h3><p>Adopt Option 3 with a phased implementation.</p>` }
  ] 
}}
      /* ------------------------------------------------------------- */

// 2. GUIDANCE ENGINE (Panduan Bilingual - EN & ID)
/* --- AREA EDIT (PAK ANGGA): TAMBAH GUIDANCE BARU DI SINI --- */
const GUIDANCE = {
  journal_article: {
    _analogy: { 
      en: 'A journal article is a courtroom argument. You are the lawyer, the data is your evidence, and the reviewers are the jury. You must prove your case beyond a reasonable doubt.', 
      id: 'Artikel jurnal ibarat argumen di pengadilan. Anda pengacaranya, data adalah barang bukti, dan reviewer adalah jurinya. Anda harus membuktikan kasus Anda tanpa keraguan.' 
    },
    abstract: { 
      en: { 
        what: `The Abstract is the "Movie Trailer" of your research. In 150–250 words, it must provide a complete, standalone summary of the entire paper. For many readers (and editors), this is the ONLY part they will ever read. If the trailer is boring, nobody buys the ticket to read the full paper.

Structure it strictly (one or two sentences per part):
1. Context/Hook: What is the broad issue? (e.g., "Plastic pollution threatens global marine biodiversity.")
2. The Gap: What is missing in current knowledge? (e.g., "However, data on microplastics in Indonesian remote islands is non-existent.")
3. Objective: What did this study do? (e.g., "This study analyzes sediment samples from 5 remote Maluku islands.")
4. Methodology: How did you do it? (e.g., "Using Fourier-transform infrared spectroscopy (FTIR)...")
5. Results: What did you find? Be specific! (e.g., "We found average concentrations of 500 particles/kg, mostly polyethylene.")
6. Conclusion/Implication: So what? (e.g., "These findings suggest currents transport waste from urban centers, necessitating regional policy shifts.")`,
        tip: `Write the Abstract LAST. You cannot summarize a paper that hasn't been written. 
Check the journal's word count limit religiously (usually 200 or 250 words). 
Ensure keywords are optimized for search engines (SEO)—if your title doesn't have the word "Climate Change," maybe your abstract should.`,
        mistakes: `1. Citations in Abstract: Never cite other authors here unless absolutely necessary (e.g., if you are refuting a specific famous theory).
2. Undefined Abbreviations: Don't use "SEM" or "PAR" without spelling them out first, unless they are standard (like DNA).
3. Vague Results: "Results were discussed" is a waste of words. Say "Results showed a 20% increase."
4. New Information: Do not put anything in the abstract that is not in the main text.`
      }, 
      id: { 
        what: `Abstrak adalah "Trailer Film" dari riset Anda. Dalam 150–250 kata, ia harus menyajikan ringkasan lengkap dan mandiri dari seluruh makalah. Bagi banyak pembaca (dan editor), ini adalah SATU-SATUNYA bagian yang akan mereka baca. Jika trailernya membosankan, tidak ada yang mau baca makalah lengkapnya.

Strukturkan secara ketat (satu atau dua kalimat per bagian):
1. Konteks/Hook: Apa isu besarnya? (cth: "Polusi plastik mengancam biodiversitas laut global.")
2. Celah (The Gap): Apa yang hilang dari pengetahuan saat ini? (cth: "Namun, data mikroplastik di pulau terluar Indonesia belum ada.")
3. Tujuan: Apa yang studi ini lakukan? (cth: "Studi ini menganalisis sampel sedimen dari 5 pulau terluar Maluku.")
4. Metodologi: Bagaimana caranya? (cth: "Menggunakan spektroskopi FTIR...")
5. Hasil: Apa temuannya? Harus spesifik! (cth: "Ditemukan konsentrasi rata-rata 500 partikel/kg, didominasi polietilena.")
6. Kesimpulan/Implikasi: Lalu kenapa? (cth: "Temuan ini menyarankan arus membawa sampah dari kota, menuntut perubahan kebijakan regional.")`,
        tip: `Tulis Abstrak TERAKHIR. Anda tidak bisa meringkas makalah yang belum ditulis.
Cek batas jumlah kata jurnal dengan religius (biasanya 200 atau 250 kata).
Pastikan kata kunci dimaksimalkan untuk mesin pencari (SEO)—jika judul Anda tidak ada kata "Perubahan Iklim", mungkin abstrak harus ada.`,
        mistakes: `1. Sitasi di Abstrak: Jangan pernah mengutip penulis lain di sini kecuali sangat terpaksa.
2. Singkatan Tanpa Penjelasan: Jangan pakai "SEM" atau "PAR" tanpa dipanjangkan dulu, kecuali sudah standar (seperti DNA).
3. Hasil Samar: "Hasil didiskusikan" itu buang-buang kata. Tulis "Hasil menunjukkan kenaikan 20%."
4. Info Baru: Jangan masukkan apa pun di abstrak yang tidak ada di teks utama.`
      } 
    },
    introduction: { 
      en: { 
        what: `The Introduction sets the stage. It must answer "Why do we care?" and "What do we already know?" leading inevitably to "What don't we know yet?" (The Gap). Use the "Funnel Method": start broad and narrow down to your specific research question.

1. The Hook (Broad Context): Start with the general topic that appeals to a wide audience. (e.g., "Teacher retention is a global crisis.")
2. The "State of the Art" (Literature Review): Briefly summarize what recent major studies have found. Group them by themes, not just a list of names. (e.g., "Studies A and B focus on salary, while C focuses on workload.")
3. The Gap (Problem Statement): Point out what is missing. Is the existing research outdated? Did they ignore a specific region (e.g., Global South)? Did they use a flawed method? Use transition words like "However," "Despite," or "Although."
4. The Solution (Objective): Clearly state your Research Question (RQ) or Hypothesis. "Therefore, this study aims to..."
5. Roadmap: Briefly outline how the paper is organized.`,
        tip: `A good Introduction is an argument, not a history lesson. Every paragraph should lead the reader closer to your specific Research Question.
Cite heavily here. Show the editor you have read the relevant, up-to-date (last 5-10 years) literature in their journal.`,
        mistakes: `1. The "Dawn of Man" Opening: Don't start with "Since the beginning of time..." It's cliché.
2. The Mystery Reveal: Don't hide your research question until the findings. State it clearly on page 2 or 3.
3. Over-citation of One Author: Don't just cite your professor or yourself. It looks biased.
4. No Gap: If you can't articulate what is MISSING in current science, you have no justification for publication.`
      }, 
      id: { 
        what: `Pendahuluan menyiapkan panggung. Harus menjawab "Kenapa kita peduli?" dan "Apa yang sudah kita tahu?", yang berujung pada "Apa yang belum kita tahu?" (Celah Riset). Gunakan "Metode Corong": mulai dari hal luas, menyempit ke pertanyaan riset spesifik Anda.

1. Pancingan (Konteks Luas): Mulai dengan topik umum yang menarik audiens luas. (cth: "Retensi guru adalah krisis global.")
2. "State of the Art" (Tinjauan Literatur): Rangkum singkat temuan studi besar terbaru. Kelompokkan berdasarkan tema, jangan cuma daftar nama. (cth: "Studi A dan B fokus pada gaji, sementara C fokus pada beban kerja.")
3. Celah (Masalah): Tunjuk apa yang kurang. Apakah riset ada sudah kadaluarsa? Apakah mereka abaikan wilayah tertentu (misal: Global South)? Apakah metodenya cacat? Gunakan kata transisi "Namun," "Meskipun," atau "Walaupun."
4. Solusi (Tujuan): Nyatakan Pertanyaan Riset (RQ) atau Hipotesis dengan jelas. "Oleh karena itu, studi ini bertujuan untuk..."
5. Peta Jalan: Rangkum singkat sistematika penulisan.`,
        tip: `Pendahuluan yang baik adalah argumen, bukan pelajaran sejarah. Setiap paragraf harus menuntun pembaca makin dekat ke Pertanyaan Riset Anda.
Banyak sitasi di sini. Tunjukkan pada editor bahwa Anda membaca literatur relevan dan terbaru (5-10 tahun terakhir) di jurnal mereka.`,
        mistakes: `1. Pembukaan "Zaman Batu": Jangan mulai dengan "Sejak awal peradaban..." Itu klise.
2. Rahasia Detektif: Jangan sembunyikan pertanyaan riset sampai akhir. Nyatakan jelas di halaman 2 atau 3.
3. Sitasi Berlebihan Satu Orang: Jangan cuma kutip dosen pembimbing atau diri sendiri. Terlihat bias.
4. Tanpa Celah: Jika Anda tak bisa jelaskan apa yang HILANG di sains saat ini, Anda tak punya alasan untuk terbit.`
      } 
    },
    framework: { 
      en: { 
        what: `The Theoretical or Conceptual Framework is the "Lens" through which you view your data. It explains the relationships between concepts. It is not just a glossary of terms; it is a map.

- For Quantitative: This is usually a "Conceptual Framework" showing independent (X) and dependent (Y) variables and hypothesized relationships (arrows).
- For Qualitative: This is a "Theoretical Framework" (e.g., Foucault's Power Dynamics, Bourdieu's Capital) that sensitizes you to certain patterns in the data.

You must explain WHY you chose this framework. How does it help answer your Research Question better than other frameworks?`,
        tip: `If you propose a new model, draw it! A diagram (Figure 1) is worth a thousand words here.
Don't just name-drop a famous theory (e.g., "We used Grounded Theory") without explaining how you actually applied it.`,
        mistakes: `1. The "Dictionary" Mistake: Just listing definitions of terms without connecting them.
2. Disconnected Framework: Using a framework here that you never mention again in the Discussion. The framework must return in the end to help interpret results.
3. Outdated Theory: Using a theory from 1950 that has been debunked, unless you are revisiting it historically.`
      }, 
      id: { 
        what: `Kerangka Teori atau Konseptual adalah "Kacamata" yang Anda gunakan untuk melihat data. Ini menjelaskan hubungan antar konsep. Ini bukan sekadar glosarium istilah; ini adalah peta.

- Untuk Kuantitatif: Biasanya "Kerangka Konseptual" yang menunjukkan variabel independen (X) dan dependen (Y) serta hubungan hipotesis (panah).
- Untuk Kualitatif: Ini "Kerangka Teori" (misal: Dinamika Kekuasaan Foucault, Modal Bourdieu) yang membuat Anda peka terhadap pola tertentu dalam data.

Anda harus jelaskan KENAPA memilih kerangka ini. Bagaimana ia membantu menjawab Pertanyaan Riset lebih baik dari kerangka lain?`,
        tip: `Jika Anda usulkan model baru, gambarlah! Diagram (Gambar 1) bernilai seribu kata di sini.
Jangan cuma asal sebut teori terkenal (cth: "Kami pakai Grounded Theory") tanpa jelaskan bagaimana cara pakainya.`,
        mistakes: `1. Kesalahan "Kamus": Cuma buat daftar definisi istilah tanpa menghubungkannya.
2. Kerangka Terputus: Pakai kerangka di sini tapi tidak pernah disebut lagi di Diskusi. Kerangka harus kembali di akhir untuk bantu interpretasi hasil.
3. Teori Kadaluarsa: Pakai teori tahun 1950 yang sudah dibantah, kecuali Anda meninjaunya secara historis.`
      } 
    },
    methodology: { 
      en: { 
        what: `The Methodology is the "Recipe". It must be detailed enough that another scientist could replicate your study exactly. Reproducibility is the gold standard of science.

Cover these 3 pillars:
1. Participants/Sampling: Who? How many? Why them? (e.g., "Purposive sampling of 50 teachers.")
2. Data Collection: How? What tools? (e.g., "Semi-structured interviews lasting 60 mins," or "Survey utilizing Likert scale 1-5.") Mention validity and reliability checks (Cronbach's alpha, triangulation).
3. Data Analysis: How did you process the mess? (e.g., "Thematic analysis using NVivo," or "Multiple regression using SPSS.")

Also, explicitly mention ETHICS. Did you get consent? Was it anonymous?`,
        tip: `Use the past tense (e.g., "We measured," not "We will measure").
Justify your choices. Don't just say "we used a survey." Say "we used a survey because the population is too large for interviews."`,
        mistakes: `1. The "Black Box": Saying "data was analyzed" without explaining HOW.
2. Ignoring Bias: failing to mention potential limitations or biases in your sampling.
3. Missing Details: Forgetting to state the dates of data collection or the language used.`
      }, 
      id: { 
        what: `Metodologi adalah "Resep Masakan". Harus cukup detail agar ilmuwan lain bisa mengulang studi Anda persis sama. Reproducibility adalah standar emas sains.

Cakup 3 pilar ini:
1. Partisipan/Sampling: Siapa? Berapa banyak? Kenapa mereka? (cth: "Purposive sampling terhadap 50 guru.")
2. Pengumpulan Data: Bagaimana? Alat apa? (cth: "Wawancara semi-struktur 60 menit," atau "Survei skala Likert 1-5.") Sebutkan cek validitas dan reliabilitas (Cronbach's alpha, triangulasi).
3. Analisis Data: Bagaimana memproses data mentah? (cth: "Analisis tematik pakai NVivo," atau "Regresi berganda pakai SPSS.")

Juga, sebutkan ETIKA secara eksplisit. Ada persetujuan (consent)? Anonim?`,
        tip: `Gunakan kata kerja lampau (cth: "Kami mengukur", bukan "Kami akan mengukur").
Justifikasi pilihan Anda. Jangan cuma bilang "kami pakai survei." Bilang "kami pakai survei karena populasi terlalu besar untuk wawancara."`,
        mistakes: `1. "Kotak Hitam": Bilang "data dianalisis" tanpa jelaskan CARANYA.
2. Abaikan Bias: Gagal menyebutkan potensi keterbatasan atau bias dalam sampling Anda.
3. Detail Hilang: Lupa sebutkan tanggal pengambilan data atau bahasa yang digunakan.`
      } 
    },
    findings: { 
      en: { 
        what: `The Findings section is for "Data Only." It is a neutral report of what you found. Do not interpret yet (save that for Discussion). Do not cite other authors here.

Structure:
- Organize logically (e.g., by Research Question 1, then RQ 2).
- Use visual aids: Tables for exact numbers, Graphs for trends.
- Use the "Sandwich Method":
  - Top Bun: Introduce the table/graph ("Table 1 shows...").
  - Meat: The Visual itself.
  - Bottom Bun: Highlight the key numbers in text ("As shown, 70% of respondents agreed...").

Report negative results too! If your hypothesis failed, that is scientifically valuable.`,
        tip: `Be concise. Don't repeat every single number from the table in the text; just highlight the most significant ones.
Use subheadings to guide the reader.`,
        mistakes: `1. Interpreting too early: Saying "The score was low, which suggests bad teaching..." (Stop at "The score was low." Save the "suggests" for Discussion).
2. Data Dumping: Pasting raw SPSS output or interview transcripts without cleaning/summarizing.
3. Redundancy: Repeating the same data in text, table, and figure.`
      }, 
      id: { 
        what: `Bagian Temuan adalah untuk "Hanya Data". Ini laporan netral apa yang Anda temukan. Jangan interpretasi dulu (simpan untuk Diskusi). Jangan kutip penulis lain di sini.

Struktur:
- Organisasi logis (misal: per Pertanyaan Riset 1, lalu RQ 2).
- Gunakan bantuan visual: Tabel untuk angka persis, Grafik untuk tren.
- Gunakan "Metode Sandwich":
  - Roti Atas: Kenalkan tabel/grafik ("Tabel 1 menunjukkan...").
  - Daging: Visual itu sendiri.
  - Roti Bawah: Soroti angka kunci dalam teks ("Seperti terlihat, 70% responden setuju...").

Laporkan hasil negatif juga! Jika hipotesis gagal, itu berharga secara ilmiah.`,
        tip: `Ringkas. Jangan ulang setiap angka dari tabel ke dalam teks; soroti saja yang paling signifikan.
Gunakan sub-judul untuk menuntun pembaca.`,
        mistakes: `1. Interpretasi terlalu dini: Bilang "Skor rendah, yang menyarankan pengajaran buruk..." (Stop di "Skor rendah." Simpan "menyarankan" untuk Diskusi).
2. Muntah Data: Paste output mentah SPSS atau transkrip wawancara tanpa dibersihkan/dirangkum.
3. Redundansi: Mengulang data yang sama di teks, tabel, dan gambar.`
      } 
    },
    discussion: { 
      en: { 
        what: `The Discussion is the "So What?". This is where you earn your PhD. You must interpret the findings and link them back to the Introduction and Theory.

Answer these questions:
1. Meaning: What do the results mean?
2. Comparison: Do your results agree or disagree with previous studies (Smith, 2020)? If you disagree, explain why (e.g., "Maybe because our sample was urban, while Smith's was rural").
3. Mechanism: Why did this happen? Use your Theoretical Framework to explain the mechanism.
4. Implications: What does this mean for policy, practice, or future theory?

Be honest about LIMITATIONS. Sample size too small? Just one region? Admitting this increases credibility.`,
        tip: `Do not just repeat the Results. "The score was 50" is a Result. "The score was 50, which is surprisingly high compared to global averages" is Discussion.
Use "hedging" language: "This suggests," "It implies," rather than "This proves." Science rarely proves anything 100%.`,
        mistakes: `1. New Results: Do not introduce new numbers here that weren't in the Findings.
2. Speculation: Don't make claims your data doesn't support.
3. Ignoring Conflict: If your data contradicts a major theory, don't hide it. embrace it—that's the most interesting part!`
      }, 
      id: { 
        what: `Diskusi adalah "Lalu Kenapa?". Di sinilah nilai utama keilmuan Anda. Anda harus interpretasi temuan dan hubungkan balik ke Pendahuluan dan Teori.

Jawab pertanyaan ini:
1. Makna: Apa arti hasil ini?
2. Perbandingan: Apakah hasil Anda setuju atau bantah studi sebelumnya (Smith, 2020)? Jika beda, jelaskan kenapa (cth: "Mungkin karena sampel kami kota, Smith desa").
3. Mekanisme: Kenapa ini terjadi? Gunakan Kerangka Teori untuk jelaskan mekanismenya.
4. Implikasi: Apa artinya bagi kebijakan, praktik, atau teori masa depan?

Jujurlah soal KETERBATASAN. Sampel terlalu kecil? Cuma satu wilayah? Mengakui ini menaikkan kredibilitas.`,
        tip: `Jangan cuma ulang Hasil. "Skornya 50" itu Hasil. "Skornya 50, yang mana sangat tinggi dibanding rata-rata global" itu Diskusi.
Gunakan bahasa "hati-hati": "Ini menyarankan," "Ini mengimplikasikan," daripada "Ini membuktikan." Sains jarang membuktikan sesuatu 100%.`,
        mistakes: `1. Hasil Baru: Jangan masukkan angka baru di sini yang tidak ada di Temuan.
2. Spekulasi: Jangan buat klaim yang tidak didukung data.
3. Abaikan Konflik: Jika data Anda bantah teori besar, jangan sembunyikan. Rangkul itu—itu bagian paling menarik!`
      } 
    },
    conclusion: { 
      en: { 
        what: `The Conclusion is the "Mic Drop." It is not just a summary; it is a synthesis. Zoom out from the specifics back to the big picture.

Structure:
1. Restate the main answer to your Research Question (in different words).
2. Synthesize the main points—show how they fit together.
3. Practical Contribution: Who should use this info? Teachers? Policymakers?
4. Future Research: What is the next logical step for science?
5. Final Closing Statement: Leave the reader with a strong, lasting thought.`,
        tip: `Keep it short. Usually 1-2 paragraphs.
Make sure your conclusion matches your introduction. If you promised to solve X, ensure you conclude about X.`,
        mistakes: `1. "More research is needed": This is a weak ending. Be specific: "Future research should focus on X variable."
2. Introducing new arguments: The trial is over. No new evidence allowed.
3. Just summarizing: Don't just list what you did. Explain what it amounts to.`
      }, 
      id: { 
        what: `Kesimpulan adalah "Mic Drop". Bukan sekadar ringkasan; ini sintesis. Zoom out dari hal spesifik kembali ke gambaran besar.

Struktur:
1. Nyatakan ulang jawaban utama Pertanyaan Riset (dengan kata beda).
2. Sintesis poin utama—tunjukkan bagaimana mereka saling terkait.
3. Kontribusi Praktis: Siapa yang harus pakai info ini? Guru? Pembuat kebijakan?
4. Riset Masa Depan: Apa langkah logis sains berikutnya?
5. Pernyataan Penutup Akhir: Tinggalkan pembaca dengan pemikiran kuat yang membekas.`,
        tip: `Buat singkat. Biasanya 1-2 paragraf.
Pastikan kesimpulan cocok dengan pendahuluan. Jika janji selesaikan X, pastikan simpulkan soal X.`,
        mistakes: `1. "Lebih banyak riset dibutuhkan": Ini ending lemah. Spesifiklah: "Riset depan harus fokus ke variabel X."
2. Argumen baru: Sidang sudah selesai. Tak boleh ada bukti baru.
3. Cuma meringkas: Jangan cuma daftar apa yang Anda buat. Jelaskan apa maknanya secara total.`
      } 
    }
  },
    project_proposal: {
    _analogy: { 
      en: 'A proposal is a sales pitch where trust is the currency.', 
      id: 'Proposal adalah jualan di mana kepercayaan adalah mata uangnya.' 
    },
    executive_summary: { 
      en: { 
        what: `This section is the strategic “front page” of your proposal. It must function as a fully standalone document that communicates the essence of your project in a concise, compelling, and decision-oriented format. Assume this is the only page a busy Minister, CEO, or donor will read before deciding whether to proceed.

Your sales pitch must clearly answer the core “Wh-questions” in a structured yet persuasive flow:

1. Who are you?
Briefly introduce your organization, team, or consortium. Establish credibility by highlighting relevant experience, proven track records, partnerships, and unique strengths that position you to deliver results. Focus on authority and trustworthiness.

2. What is the problem?
Define the problem clearly and strategically. Use concise evidence, data, or observable consequences to demonstrate urgency and scale. Explain why this issue matters now, and what risks emerge if it remains unaddressed. Avoid lengthy background; focus on clarity and relevance.

3. What is your solution?
Present your proposed intervention in a simple, outcome-focused manner. Explain how it directly addresses the identified problem. Emphasize innovation, feasibility, scalability, and alignment with policy or institutional priorities. Make it clear why your approach is different, practical, and implementable.

4. How much investment is required?
State the funding amount transparently. Briefly outline how resources will be allocated (e.g., capacity building, digital systems, infrastructure, research, pilot implementation). Show that the budget is proportional, strategic, and efficient.

5. What is the Return on Investment (Impact)?
This is the most critical part. Describe measurable outcomes and long-term benefits. Clarify how the project generates value—whether through cost savings, increased productivity, strengthened institutions, improved public trust, social stability, or economic growth. If possible, quantify impact (e.g., number of beneficiaries, efficiency gains, policy improvements).

The tone must be confident, forward-looking, and solution-driven. Every sentence should move the reader toward one conclusion: this project is necessary, credible, financially sound, and impactful.`,
        tip: `Write this section LAST. Although it sits at the front, you cannot effectively summarize a project that hasn't been fully detailed yet.

Use the "Hook & Anchor" technique:
- The Hook: Start with a startling statistic or a compelling narrative that immediately grabs attention (e.g., "Every minute, one truckload of plastic enters our ocean").
- The Anchor: End with a solid, verifiable impact statement that grounds the proposal in reality (e.g., "This $85k investment will remove 10 tons of debris and create 500 green jobs").

Format matters. Use bold text for key figures (amounts, dates, outputs) so skimmers can catch the main points in 5 seconds.`,
        mistakes: `1. The "Cut & Paste" Error: Do not simply copy the first paragraph of your Introduction. This section needs its own unique, punchy flow.
2. The Mystery Novel Approach: Do not hide the budget request or the specific solution until the end. Be direct upfront.
3. Overloading with Jargon: Keep it accessible. Avoid technical acronyms that might confuse a high-level generalist reader.
4. Vagueness: Avoid phrases like "we hope to support..." instead say "we will implement...".`
      }, 
      id: { 
        what: `Bagian ini adalah "halaman depan" strategis dari proposal Anda. Ia harus berfungsi sebagai dokumen mandiri yang mengomunikasikan esensi proyek Anda dalam format yang ringkas, menarik, dan berorientasi pada keputusan. Asumsikan ini adalah satu-satunya halaman yang akan dibaca oleh Menteri, CEO, atau donor yang sibuk sebelum memutuskan untuk lanjut.

Sales pitch Anda harus menjawab "Pertanyaan-W" inti dalam alur yang terstruktur namun persuasif:

1. Siapa Anda?
Perkenalkan organisasi, tim, atau konsorsium Anda secara singkat. Bangun kredibilitas dengan menonjolkan pengalaman relevan, rekam jejak terbukti, kemitraan, dan kekuatan unik yang memposisikan Anda untuk memberikan hasil. Fokus pada otoritas dan kepercayaan.

2. Apa masalahnya?
Definisikan masalah dengan jelas dan strategis. Gunakan bukti ringkas, data, atau konsekuensi yang dapat diamati untuk menunjukkan urgensi dan skala. Jelaskan mengapa masalah ini penting sekarang, dan risiko apa yang muncul jika tidak ditangani. Hindari latar belakang yang panjang; fokus pada kejelasan dan relevansi.

3. Apa solusi Anda?
Sajikan intervensi yang Anda usulkan dengan cara yang sederhana dan berfokus pada hasil. Jelaskan bagaimana hal itu secara langsung mengatasi masalah yang diidentifikasi. Tekankan inovasi, kelayakan, skalabilitas, dan keselarasan dengan kebijakan atau prioritas institusional. Jelaskan mengapa pendekatan Anda berbeda, praktis, dan dapat diterapkan.

4. Berapa investasi yang dibutuhkan?
Nyatakan jumlah dana secara transparan. Uraikan secara singkat bagaimana sumber daya akan dialokasikan (misalnya, pengembangan kapasitas, sistem digital, infrastruktur, penelitian, percontohan). Tunjukkan bahwa anggaran tersebut proporsional, strategis, dan efisien.

5. Apa Return on Investment (Dampak)-nya?
Ini adalah bagian paling kritis. Jelaskan hasil yang terukur dan manfaat jangka panjang. Perjelas bagaimana proyek menghasilkan nilai—baik melalui penghematan biaya, peningkatan produktivitas, penguatan institusi, peningkatan kepercayaan publik, stabilitas sosial, atau pertumbuhan ekonomi. Jika memungkinkan, kuantifikasi dampak (misalnya, jumlah penerima manfaat, peningkatan efisiensi, perbaikan kebijakan).

Nada tulisan harus percaya diri, berpandangan ke depan, dan didorong oleh solusi. Setiap kalimat harus menggerakkan pembaca menuju satu kesimpulan: proyek ini perlu, kredibel, sehat secara finansial, dan berdampak.`,
        tip: `Tulis bagian ini TERAKHIR. Meskipun letaknya di depan, Anda tidak bisa merangkum proyek yang belum didetailkan sepenuhnya.

Gunakan teknik "Kail & Jangkar" (Hook & Anchor):
- Kail: Mulai dengan statistik mengejutkan atau narasi kuat yang langsung menarik perhatian (misal: "Tiap menit, satu truk plastik masuk ke laut kita").
- Jangkar: Akhiri dengan pernyataan dampak yang solid dan terverifikasi (misal: "Investasi $85rb ini akan mengangkat 10 ton sampah dan menciptakan 500 lapangan kerja hijau").

Format itu penting. Gunakan teks tebal untuk angka-angka kunci (dana, tanggal, output) agar pembaca cepat bisa menangkap poin utama dalam 5 detik.`,
        mistakes: `1. Kesalahan "Copy Paste": Jangan cuma menyalin paragraf pertama Pendahuluan. Bagian ini butuh alur yang unik dan nendang.
2. Pendekatan Novel Misteri: Jangan sembunyikan permintaan dana atau solusi spesifik sampai akhir kalimat. Langsung to the point.
3. Terlalu Banyak Jargon: Jaga agar tetap mudah dibaca. Hindari akronim teknis yang membingungkan pembaca umum level tinggi.
4. Keragu-raguan: Hindari frasa "kami berharap bisa mendukung..." ganti dengan "kami akan melaksanakan...".`
      } 
    },
    situational_analysis: { 
      en: { 
        what: `This section acts as the rigorous, data-driven diagnostic foundation of your proposal. You are not just describing a situation; you are building a compelling legal case that a crisis exists and demands immediate intervention. A strong situational analysis moves from the general to the specific using the "Inverted Pyramid" structure:

1. The Macro Context (Global/National):
Begin with the big picture to establish relevance. Cite specific Sustainable Development Goals (SDGs), National Medium-Term Development Plans (RPJMN), or international climate commitments. This proves your project is not an isolated effort but a crucial piece of a larger global or national puzzle.

2. The Meso Context (Regional/Sectoral):
Narrow down to the specific region or sector. What is the state of ocean literacy in Eastern Indonesia specifically? Use comparative data. For example, "While Java has 50% waste collection coverage, Maluku only has 10%." This highlights inequality and urgency.

3. The Micro Context (The Specific Gap):
This is where you identify the "bleeding wound." What exactly is broken in the target community? Is it a lack of infrastructure? A lack of knowledge? A cultural barrier? Use hard data from local surveys or credible proxies.

4. Stakeholder Mapping:
Demonstrate your political intelligence. Who holds the power? Who are the potential spoilers? Analyze the ecosystem:
- Beneficiaries: Who gets helped?
- Allies: Local NGOs, progressive leaders.
- Blockers: Waste syndicates, corrupt officials, or cultural resistance.

5. The "Null Hypothesis" (Consequences of Inaction):
Conclude by explaining what happens if this project is NOT funded. Will the coral reefs die in 5 years? Will youth unemployment rise? Paint a clear picture of the cost of doing nothing.`,
        tip: `Data is your currency, but stories are your vehicle.
- Visuals: If possible, refer to charts or graphs (e.g., "See Annex A for waste composition data").
- Quotes: Use a direct quote from a community member to humanize the statistics.
- Alignment: Explicitly use the donor's language. If they care about "Gender," highlight how the problem disproportionately affects women.`,
        mistakes: `1. Defining the Problem as "Lack of Your Solution": Don't say "The problem is there is no app." Say "The problem is inefficient data collection leading to poor policy." The app is the solution, not the problem's absence.
2. Using Outdated Data: Citing a World Bank report from 2010 in a 2024 proposal kills credibility immediately.
3. Ignoring Existing Efforts: Failing to mention what the government or other NGOs are already doing makes you look ignorant or arrogant.`
      }, 
      id: { 
        what: `Bagian ini berfungsi sebagai fondasi diagnostik yang ketat dan berbasis data untuk proposal Anda. Anda tidak sekadar mendeskripsikan situasi; Anda sedang membangun kasus hukum yang meyakinkan bahwa krisis itu nyata dan menuntut intervensi segera. Analisis situasi yang kuat bergerak dari umum ke khusus menggunakan struktur "Piramida Terbalik":

1. Konteks Makro (Global/Nasional):
Mulailah dengan gambaran besar untuk membangun relevansi. Kutip Tujuan Pembangunan Berkelanjutan (SDGs), RPJMN, atau komitmen iklim internasional yang spesifik. Ini membuktikan proyek Anda bukan upaya terisolasi, tapi kepingan penting dari teka-teki global/nasional yang lebih besar.

2. Konteks Meso (Regional/Sektoral):
Kerucutkan ke wilayah atau sektor spesifik. Bagaimana kondisi literasi laut di Indonesia Timur secara khusus? Gunakan data perbandingan. Contoh: "Sementara Jawa punya cakupan sampah 50%, Maluku hanya 10%." Ini menonjolkan ketimpangan dan urgensi.

3. Konteks Mikro (Celah Spesifik):
Di sinilah Anda mengidentifikasi "luka yang berdarah". Apa sebenarnya yang rusak di komunitas target? Apakah kurang infrastruktur? Kurang pengetahuan? Hambatan budaya? Gunakan data keras dari survei lokal atau proksi yang kredibel.

4. Pemetaan Pemangku Kepentingan (Stakeholder):
Tunjukkan kecerdasan politik Anda. Siapa pemegang kekuasaan? Siapa pengacau potensial? Analisis ekosistemnya:
- Penerima Manfaat: Siapa yang dibantu?
- Sekutu: NGO lokal, pemimpin progresif.
- Penghambat: Sindikat sampah, pejabat korup, atau resistensi budaya.

5. "Hipotesis Nol" (Konsekuensi Tanpa Aksi):
Tutup dengan menjelaskan apa yang terjadi jika proyek ini TIDAK didanai. Apakah terumbu karang mati dalam 5 tahun? Pengangguran naik? Lukiskan gambaran jelas tentang "biaya dari tidak melakukan apa-apa".`,
        tip: `Data adalah mata uang Anda, tapi cerita adalah kendaraan Anda.
- Visual: Jika memungkinkan, rujuk ke grafik (cth: "Lihat Lampiran A untuk data komposisi sampah").
- Kutipan: Gunakan kutipan langsung dari warga untuk memanusiakan statistik.
- Penyelarasan: Gunakan bahasa donor secara eksplisit. Jika mereka peduli "Gender", soroti bagaimana masalah ini membebani perempuan secara tidak proporsional.`,
        mistakes: `1. Mendefinisikan Masalah sebagai "Ketiadaan Solusi Anda": Jangan bilang "Masalahnya tidak ada aplikasi." Bilang "Masalahnya adalah pengumpulan data tidak efisien yang berujung pada kebijakan buruk." Aplikasi itu solusi, bukan masalah.
2. Menggunakan Data Kadaluarsa: Mengutip laporan Bank Dunia tahun 2010 di proposal tahun 2024 membunuh kredibilitas seketika.
3. Mengabaikan Upaya yang Ada: Gagal menyebutkan apa yang sudah dilakukan pemerintah atau NGO lain membuat Anda terlihat tidak tahu atau arogan.`
      } 
    },
    methodology: { 
      en: { 
        what: `This section explains the "Theory of Change" or the architectural logic of your intervention. It answers the question: "Why do you believe this specific set of activities will lead to the desired results?" It bridges the gap between the Problem (Section 2) and the Solution (Section 4).

Your methodology should cover three key dimensions:

1. The Strategic Framework:
What established model are you using? Are you using "Participatory Action Research (PAR)"? "Citizen Science"? "Behavioral Nudging"? Explaining the theoretical framework proves you are an expert, not just an executor. Explain why this model is superior to traditional top-down approaches.

2. Innovation & Value Add:
What makes your approach different?
- Is it a new technology (e.g., offline-first PWA)?
- Is it a new process (e.g., integrating Customary Law/Adat with modern science)?
- Is it a new partnership model?
Highlight the "Secret Sauce" that only your organization can bring.

3. Cross-Cutting Issues (GESI):
You must explicitly address Gender Equality and Social Inclusion (GESI). Donors require this. Do not just treat it as a checkbox. Explain:
- How will you ensure women's participation? (e.g., timing workshops to fit domestic schedules).
- How will you include marginalized groups? (e.g., disability-friendly app UI).
- How does the project challenge structural inequalities?

4. Sustainability Logic:
Briefly touch upon the logic of how this method leads to lasting change. For example, "By training local trainers (ToT), we ensure knowledge remains in the village after we leave."`,
        tip: `Visuals are powerful here. If you can, describe a diagram or a flowchart (e.g., "Figure 1: The Data-to-Action Cycle").
Show, don't just tell. Instead of saying "we are inclusive," say "we have a mandatory 50% quota for female leadership roles in the Blue Guardian committee."`,
        mistakes: `1. Confusing Methodology with Activities: Methodology is the "Philosophy/Strategy" (e.g., Citizen Science). Activities are the "Tasks" (e.g., holding a workshop). Don't just list tasks here.
2. Tokenism in Gender: Writing one sentence saying "women will be invited" is not enough. You need a strategy for empowerment.
3. Too Academic: Avoid writing a thesis. Keep the theory practical and directly applicable to the project's success.`
      }, 
      id: { 
        what: `Bagian ini menjelaskan "Teori Perubahan" atau logika arsitektur intervensi Anda. Ini menjawab pertanyaan: "Mengapa Anda yakin rangkaian kegiatan ini akan menghasilkan dampak yang diinginkan?" Ini menjembatani Masalah (Bab 2) dan Solusi (Bab 4).

Metodologi Anda harus mencakup tiga dimensi kunci:

1. Kerangka Strategis:
Model mapan apa yang Anda pakai? "Participatory Action Research (PAR)"? "Citizen Science"? "Behavioral Nudging"? Menjelaskan kerangka teori membuktikan Anda ahli, bukan sekadar pelaksana. Jelaskan kenapa model ini lebih unggul dari pendekatan top-down tradisional.

2. Inovasi & Nilai Tambah:
Apa yang membuat pendekatan Anda beda?
- Apakah teknologi baru (cth: aplikasi offline-first)?
- Apakah proses baru (cth: integrasi Hukum Adat dengan sains modern)?
- Apakah model kemitraan baru?
Soroti "Bumbu Rahasia" yang hanya bisa dibawa oleh organisasi Anda.

3. Isu Lintas Sektoral (GESI):
Anda wajib membahas Kesetaraan Gender & Inklusi Sosial (GESI). Donor menuntut ini. Jangan jadikan sekadar checklist. Jelaskan:
- Cara memastikan partisipasi perempuan? (cth: waktu workshop disesuaikan jadwal domestik).
- Cara merangkul kaum marjinal? (cth: UI aplikasi ramah disabilitas).
- Bagaimana proyek menantang ketimpangan struktural?

4. Logika Keberlanjutan:
Singgung sedikit logika bagaimana metode ini membawa perubahan awet. Cth: "Dengan melatih pelatih lokal (ToT), ilmu tetap tinggal di desa setelah kami pergi."`,
        tip: `Visual sangat kuat di sini. Jika bisa, deskripsikan diagram atau alur (cth: "Gambar 1: Siklus Data-ke-Aksi").
Tunjukkan, jangan cuma bilang. Daripada bilang "kami inklusif", bilang "kami punya kuota wajib 50% peran kepemimpinan perempuan di komite Blue Guardian."`,
        mistakes: `1. Menukar Metodologi dengan Aktivitas: Metodologi itu "Filosofi/Strategi" (cth: Citizen Science). Aktivitas itu "Tugas" (cth: gelar workshop). Jangan cuma buat daftar tugas di sini.
2. Tokenisme Gender: Menulis satu kalimat "perempuan akan diundang" tidak cukup. Anda butuh strategi pemberdayaan.
3. Terlalu Akademis: Jangan tulis tesis. Jaga teori tetap praktis dan bisa diterapkan langsung untuk kesuksesan proyek.`
      } 
    },
    technical_implementation: { 
      en: { 
        what: `This is the "Engine Room" of your proposal. It translates abstract strategies into a concrete, chronological battle plan. Donors review this section to assess feasibility: "Can they actually pull this off in 18 months?"

Structure this section by Phases or Work Packages (WPs) to show logical progression:

Phase 1: Mobilization & Inception (Months 1-3)
- Crucial but often ignored. Includes hiring staff, securing permits, setting up the office, and refining the baseline data.
- Output: Inception Report, Team hired.

Phase 2: Development & Preparation (Months 4-6)
- Developing the curriculum, building the app, procuring equipment.
- Output: App Beta Version, Training Modules finalized.

Phase 3: Execution & Deployment (Months 7-15)
- The core activities. Trainings, workshops, data collection, advocacy events.
- Output: 500 youth trained, 5 reports produced.

Phase 4: Monitoring, Evaluation & Closing (Months 16-18)
- Analyzing data, final audits, dissemination of results, handover of assets.
- Output: Final Report, Audit Report, Asset Transfer.

For each phase, specify:
- Who is responsible? (e.g., Project Manager, Field Coordinator).
- Where does it happen? (e.g., 3 pilot villages).
- What are the deliverables?`,
        tip: `Think of this as a narrative Gantt Chart.
- Be Realistic: Always add a "buffer" for delays. Donors prefer realistic timelines over optimistic ones that will inevitably fail.
- Detail Matters: Don't just say "Training." Say "5-day intensive bootcamp for 50 people in Makassar."
- Resources: Mention what resources (tablets, boats, hall rental) are needed for these activities, linking it to the budget.`,
        mistakes: `1. Ignoring the Setup Phase: Projects never start at full speed on Day 1. Failing to plan for recruitment/permits leads to immediate delays.
2. The "Hockey Stick" Schedule: Cramming 80% of activities into the last 3 months. Distribute work evenly.
3. Vague Geographies: Be specific. "Indonesia" is too big. "Coastal villages in North Minahasa" is credible.`
      }, 
      id: { 
        what: `Ini adalah "Ruang Mesin" proposal Anda. Ini menerjemahkan strategi abstrak menjadi rencana tempur kronologis yang konkret. Donor meninjau bagian ini untuk menilai kelayakan: "Bisakah mereka benar-benar melakukan ini dalam 18 bulan?"

Strukturkan bagian ini berdasarkan Fase atau Paket Kerja (WP) untuk menunjukkan progresi logis:

Fase 1: Mobilisasi & Insepsi (Bulan 1-3)
- Krusial tapi sering diabaikan. Termasuk rekrut staf, urus izin, sewa kantor, dan pemurnian data dasar.
- Output: Laporan Insepsi, Tim lengkap.

Fase 2: Pengembangan & Persiapan (Bulan 4-6)
- Bikin kurikulum, coding aplikasi, belanja alat.
- Output: Aplikasi Versi Beta, Modul Pelatihan final.

Fase 3: Eksekusi & Penyebaran (Bulan 7-15)
- Aktivitas inti. Pelatihan, workshop, ambil data, advokasi.
- Output: 500 pemuda terlatih, 5 laporan terbit.

Fase 4: Monev & Penutupan (Bulan 16-18)
- Analisis data, audit akhir, diseminasi hasil, serah terima aset.
- Output: Laporan Akhir, Laporan Audit, Transfer Aset.

Untuk tiap fase, sebutkan:
- Siapa tanggung jawab? (cth: PM, Koordinator Lapangan).
- Di mana lokasinya? (cth: 3 desa pilot).
- Apa serah-terimanya?`,
        tip: `Anggap ini narasi Gantt Chart.
- Realistis: Selalu beri "buffer" (waktu cadangan) untuk penundaan. Donor lebih suka jadwal realistis daripada optimis yang pasti gagal.
- Detail Itu Penting: Jangan cuma tulis "Pelatihan". Tulis "Bootcamp intensif 5 hari untuk 50 orang di Makassar".
- Sumber Daya: Sebutkan alat apa (tablet, perahu, sewa aula) yang dibutuhkan, hubungkan dengan budget.`,
        mistakes: `1. Mengabaikan Fase Persiapan: Proyek tidak pernah ngebut di Hari ke-1. Gagal merencanakan rekrutmen/izin bikin langsung telat.
2. Jadwal "Hockey Stick": Menumpuk 80% aktivitas di 3 bulan terakhir. Sebar beban kerja merata.
3. Lokasi Samar: Harus spesifik. "Indonesia" itu terlalu besar. "Desa pesisir di Minahasa Utara" itu kredibel.`
      } 
    },
    risk_management: { 
      en: { 
        what: `A proposal without risks is a lie. This section demonstrates your maturity and foresight. It shows the donor that you have anticipated potential pitfalls and have a "Plan B" ready to protect their investment.

Present this as a structured Risk Matrix covering four categories:

1. Political & Legal Risks:
- Risk: Elections causing leadership changes in villages.
- Mitigation: Secure MOUs with the institution (Pemdes), not the individual. Build broad coalitions.

2. Operational & Technical Risks:
- Risk: App failure in no-signal zones; Boat breakdown.
- Mitigation: Offline-first architecture; Renting local boats with backup availability.

3. Financial Risks:
- Risk: Currency fluctuation (IDR vs USD) or inflation.
- Mitigation: Maintaining a contingency fund (if allowed) or front-loading hardware purchases.

4. Social & Safety Risks:
- Risk: Community resistance; Accidents at sea.
- Mitigation: Involving Adat leaders early; Mandatory life vests and insurance for volunteers.

For each risk, assess the Probability (Low/Med/High) and Impact (Low/Med/High).`,
        tip: `Focus on "Externalities"—things outside your control. You cannot control the weather or elections, but you can control how you react to them.
Admitting risk increases trust. It shows you are not naive about the challenges of working in remote Indonesia.`,
        mistakes: `1. "No Risks Expected": Writing this is the fastest way to get rejected. It screams amateurism.
2. Internal Risks as External: "Staff might quit" or "Laptop might break" are management issues, not project risks. Have a HR/IT policy for that.
3. Weak Mitigation: "We will monitor the situation" is not a mitigation. "We will switch to paper surveys" is a mitigation.`
      }, 
      id: { 
        what: `Proposal tanpa risiko adalah kebohongan. Bagian ini menunjukkan kedewasaan dan pandangan jauh ke depan Anda. Ini menunjukkan pada donor bahwa Anda sudah antisipasi lubang masalah dan punya "Rencana B" untuk melindungi uang mereka.

Sajikan ini sebagai Matriks Risiko terstruktur mencakup empat kategori:

1. Risiko Politik & Legal:
- Risiko: Pilkada bikin ganti pemimpin desa.
- Mitigasi: Ikat MOU dengan institusi (Pemdes), bukan orangnya. Bangun koalisi luas.

2. Risiko Operasional & Teknis:
- Risiko: Aplikasi mati di area tanpa sinyal; Perahu mogok.
- Mitigasi: Arsitektur offline-first; Sewa perahu lokal dengan cadangan.

3. Risiko Finansial:
- Risiko: Fluktuasi kurs (IDR vs USD) atau inflasi.
- Mitigasi: Dana kontingensi (jika boleh) atau beli alat di awal (front-loading).

4. Risiko Sosial & Keselamatan:
- Risiko: Resistensi warga; Kecelakaan di laut.
- Mitigasi: Libatkan tokoh Adat di awal; Wajib pelampung dan asuransi relawan.

Untuk tiap risiko, nilai Probabilitas (Rendah/Sedang/Tinggi) dan Dampak (Rendah/Sedang/Tinggi).`,
        tip: `Fokus pada "Eksternalitas"—hal di luar kendali Anda. Anda tak bisa kendalikan cuaca/pemilu, tapi bisa kendalikan reaksi Anda.
Mengakui risiko menaikkan kepercayaan. Ini bukti Anda tidak naif soal tantangan kerja di pelosok Indonesia.`,
        mistakes: `1. "Tidak Ada Risiko": Menulis ini adalah cara tercepat untuk ditolak. Ini teriakan amatir.
2. Risiko Internal dianggap Eksternal: "Staf mungkin resign" atau "Laptop rusak" itu isu manajemen, bukan risiko proyek. Siapkan kebijakan HR/IT untuk itu.
3. Mitigasi Lemah: "Kami akan pantau situasi" bukan mitigasi. "Kami akan beralih ke survei kertas" itu mitigasi.`
      } 
    },
    logframe: { 
      en: { 
        what: `The Logical Framework (LogFrame) is the "Contract of Success." It is the ruler against which your project will be audited. It connects the hierarchy of change:
Input -> Activity -> Output -> Outcome -> Impact.

You must define clear Key Performance Indicators (KPIs) and Means of Verification (MoV).

1. Impact (Long-Term Goal):
The broader change (e.g., "Reduced marine plastic leakage in Eastern Indonesia").
KPI: % reduction in debris; Local budget allocation increase.

2. Outcome (Medium-Term Effect):
Behavioral or institutional change (e.g., "Villages adopt data-driven waste policies").
KPI: # of Village Regulations (Perdes) passed; # of citations of your data in gov reports.

3. Outputs (Direct Deliverables):
The immediate results of activities (e.g., "Youth trained," "App developed").
KPI: 500 youth certified; 1 App launched; 5 reports published.

Ensure your indicators are SMART: Specific, Measurable, Achievable, Relevant, Time-bound.`,
        tip: `Donors buy OUTCOMES, not Outputs.
- Output: "We held a training." (So what?)
- Outcome: "Trainees used the skills to secure a job." (That's value!)
- MoV Reality Check: Can you afford to verify the data? Don't promise a "National Census" if you only have budget for a "Sample Survey."`,
        mistakes: `1. Vague Verbs: Avoid "understand," "aware," or "empowered." How do you measure awareness? Use "pass a test," "attend," or "advocate" instead.
2. Outcome/Output Confusion: "App downloaded" is an Output. "App used to report crime" is an Outcome.
3. Overpromising Impact: Don't promise to "End Poverty" with $85k. Promise to "Increase income for 50 households."`
      }, 
      id: { 
        what: `Kerangka Logis (LogFrame) adalah "Kontrak Keberhasilan". Ini adalah penggaris yang dipakai untuk mengaudit proyek Anda. Menghubungkan hierarki perubahan:
Input -> Aktivitas -> Output -> Outcome -> Impact.

Anda harus definisikan Indikator Kinerja Utama (KPI) dan Alat Verifikasi (MoV) yang jelas.

1. Impact (Tujuan Jangka Panjang):
Perubahan luas (cth: "Berkurangnya kebocoran plastik di Indonesia Timur").
KPI: % pengurangan sampah; Kenaikan alokasi anggaran daerah.

2. Outcome (Efek Jangka Menengah):
Perubahan perilaku/institusi (cth: "Desa adopsi kebijakan sampah berbasis data").
KPI: # Perdes disahkan; # sitasi data Anda di laporan pemda.

3. Outputs (Serah Terima Langsung):
Hasil langsung aktivitas (cth: "Pemuda dilatih", "Aplikasi jadi").
KPI: 500 pemuda bersertifikat; 1 Aplikasi rilis; 5 laporan terbit.

Pastikan indikator SMART: Spesifik, Terukur, Dapat Dicapai, Relevan, Berbatas Waktu.`,
        tip: `Donor membeli OUTCOME, bukan Output.
- Output: "Kami gelar pelatihan." (Terus kenapa?)
- Outcome: "Peserta pakai skill untuk dapat kerja." (Itu baru nilai!)
- Cek Realita MoV: Mampukah Anda biayai verifikasinya? Jangan janji "Sensus Nasional" kalau budget cuma cukup "Survei Sampel".`,
        mistakes: `1. Kata Kerja Samar: Hindari "memahami", "sadar", "berdaya". Gimana ukur sadar? Gunakan "lulus tes", "hadir", atau "mengadvokasi".
2. Bingung Outcome/Output: "Aplikasi diunduh" itu Output. "Aplikasi dipakai lapor kejahatan" itu Outcome.
3. Janji Surga: Jangan janji "Hapus Kemiskinan" dengan $85rb. Janjikan "Naikkan income 50 KK".`
      } 
    },
    visibility_strategy: { 
      en: { 
        what: `Donors are also investors; they need Public Relations (PR) and visibility to justify their spending to their taxpayers or board members. This section details how you will ensure the donor gets credit and how the project's lessons will be shared.

1. Branding & Identity:
- Where will the donor's logo appear? (e.g., Volunteer vests, App splash screen, Banners, Report covers).
- Compliance: Explicitly state you will follow their "Branding Guidelines" (colors, safe space, etc.).

2. Digital & Social Media Campaign:
- Define targets: "1 Million Impressions," "5,000 Engagements."
- Channels: Instagram/TikTok for youth; LinkedIn/Twitter for policy influence.
- Content: "Before & After" cleanup photos, Human interest stories of the 'Blue Guardians.'

3. Knowledge Products & Dissemination:
- What stays behind? White papers, Policy Briefs, Documentaries.
- Events: Launch event, Closing town hall, Webinars.

4. Target Audiences:
- Who needs to see this? (Local Gov, General Public, Other NGOs).`,
        tip: `Treat the donor as a partner, not an ATM.
- Budget for It: High-quality photos require a professional photographer. Drone shots look great in annual reports. Budget specifically for "Communication & Documentation."
- The "Human Story": Donors love stories of individual transformation. Promise to produce "5 Case Studies of Changemakers."`,
        mistakes: `1. "Build it and they will come": Assuming people will know about your good work without promotion. You need to shout about it.
2. Ignoring Guidelines: Stretching a donor's logo or putting it on a trash bin is a major offense.
3. Zero Budget: Expecting the Project Manager to also be the Photographer, Writer, and Social Media Manager. It fails.`
      }, 
      id: { 
        what: `Donor juga investor; mereka butuh PR dan visibilitas untuk menjustifikasi pengeluaran ke pembayar pajak atau dewan direksi. Bagian ini merinci bagaimana Anda memastikan donor dapat kredit dan bagaimana pelajaran proyek dibagikan.

1. Branding & Identitas:
- Di mana logo donor muncul? (cth: Rompi relawan, Layar buka Aplikasi, Spanduk, Sampul laporan).
- Kepatuhan: Nyatakan eksplisit akan ikuti "Pedoman Branding" mereka (warna, posisi, dll).

2. Kampanye Digital & Medsos:
- Target: "1 Juta Impresi", "5.000 Engagement".
- Kanal: IG/TikTok untuk pemuda; LinkedIn/Twitter untuk pengaruh kebijakan.
- Konten: Foto "Before & After", Cerita humanis para 'Blue Guardians'.

3. Produk Pengetahuan & Diseminasi:
- Apa yang tertinggal? Kertas Putih, Ringkasan Kebijakan, Dokumenter.
- Acara: Event peluncuran, Town hall penutupan, Webinar.

4. Target Audiens:
- Siapa yang perlu lihat? (Pemda, Publik Umum, NGO lain).`,
        tip: `Perlakukan donor sebagai mitra, bukan ATM.
- Anggarkan: Foto bagus butuh fotografer pro. Shot drone terlihat keren di laporan tahunan. Anggarkan khusus untuk "Komunikasi & Dokumentasi".
- "Cerita Manusia": Donor suka cerita transformasi individu. Janjikan buat "5 Studi Kasus Pembawa Perubahan".`,
        mistakes: `1. "Kerja bagus pasti viral": Asumsi orang akan tahu kerja bagus Anda tanpa promosi. Anda harus teriakkan itu.
2. Abaikan Pedoman: Menarik/gepengkan logo donor atau taruh di tempat sampah adalah pelanggaran berat.
3. Budget Nol: Berharap PM juga jadi Fotografer, Penulis, dan Admin Medsos. Pasti gagal.`
      } 
    },
    budget_narrative: { 
      en: { 
        what: `This is the "Justification of Costs." While the Excel sheet shows the numbers, this narrative explains the logic behind them. It connects every dollar requested to a specific project activity. It proves "Value for Money"—that you are efficient, not just cheap.

Structure it by budget lines (usually A, B, C, D):

A. Personnel (Staffing):
- Why do you need a Project Manager at $1,500/mo? Explain their qualifications and responsibilities.
- Justify the "Field Coordinators"—working in remote areas requires intense supervision.

B. Program Activities:
- Explain the unit costs. "The training cost is based on $20/pax for food, venue, and kit for 5 days."
- Travel: "Boat rental is high because target villages are 4 hours apart."

C. Equipment & Technology:
- Why buy 10 tablets? Why rent a server? Explain that volunteers don't own smartphones, necessitating communal devices.

D. Administrative & Overhead:
- Transparency on rent, utilities, and audit fees. Donors typically cap this at 7-10%.

The goal is to show that the budget is LEAN but REALISTIC.`,
        tip: `Don't be afraid of salaries. Donors know that "if you pay peanuts, you get monkeys." Justify that high-quality talent ensures project success and sustainability.
- Unit Costs: Always reference market rates (e.g., "Standard UN rate for per diem").
- Contribution: Mention if you have "In-Kind" contribution (e.g., "Office space provided by local partner"). It makes the deal sweeter.`,
        mistakes: `1. Math Errors: If the narrative says $10k and Excel says $12k, you lose trust immediately.
2. Lump Sums: "Miscellaneous: $5,000." No donor accepts this. Break it down.
3. All Program, No Admin: Asking for 100% program funds implies you have no office, electricity, or management. It looks suspicious and unsustainable.`
      }, 
      id: { 
        what: `Ini adalah "Justifikasi Biaya". Sementara Excel menunjukkan angka, narasi ini menjelaskan logika di baliknya. Ini menghubungkan setiap dolar dengan aktivitas proyek. Membuktikan "Value for Money"—bahwa Anda efisien, bukan murahan.

Strukturkan berdasarkan lini anggaran (biasanya A, B, C, D):

A. Personel (Staf):
- Kenapa butuh PM dengan gaji $1.500/bln? Jelaskan kualifikasi dan tanggung jawabnya.
- Justifikasi "Koordinator Lapangan"—kerja di pelosok butuh supervisi ketat.

B. Aktivitas Program:
- Jelaskan biaya satuan. "Biaya training berbasis $20/org untuk makan, venue, dan kit selama 5 hari."
- Travel: "Sewa perahu mahal karena jarak antar desa 4 jam."

C. Alat & Teknologi:
- Kenapa beli 10 tablet? Kenapa sewa server? Jelaskan bahwa relawan tak punya HP, jadi butuh alat komunal.

D. Admin & Overhead:
- Transparansi sewa kantor, listrik, biaya audit. Donor biasanya batasi ini 7-10%.

Tujuannya menunjukkan budget itu RAMPING tapi REALISTIS.`,
        tip: `Jangan takut soal gaji. Donor tahu "ada harga ada rupa". Justifikasi bahwa talenta berkualitas menjamin sukses dan keberlanjutan proyek.
- Biaya Satuan: Selalu rujuk harga pasar (cth: "Standar uang harian PBB").
- Kontribusi: Sebutkan jika ada kontribusi "In-Kind" (cth: "Kantor disediakan mitra lokal"). Ini nilai plus.`,
        mistakes: `1. Salah Hitung: Jika narasi bilang $10k tapi Excel $12k, kepercayaan hilang seketika.
2. Gelondongan: "Lain-lain: $5.000". Gak ada donor terima ini. Pecah detailnya.
3. Semua Program, Tanpa Admin: Minta 100% dana program mengisyaratkan Anda tak punya kantor, listrik, atau manajemen. Terlihat mencurigakan dan tak sustainable.`
      } 
    },
    sustainability: { 
      en: { 
        what: `The "Exit Strategy." Donors are terrified of projects that collapse the moment the funding stops. You must convince them that you are building a permanent asset, not a temporary event. Address three pillars of sustainability:

1. Financial Sustainability:
- Who pays next? Do not say "another donor."
- Better answers: "Integration into Village Fund (Dana Desa)," "Selling verified plastic credits," "Subscription fee from resorts."

2. Institutional Sustainability:
- Who runs it next?
- Strategy: MOUs with local government to adopt the program. Creating a local "Youth Association" that is legally registered.

3. Technical Sustainability:
- Does the knowledge stay?
- Strategy: Training of Trainers (ToT). The "LautKita" app code is open-source. Manuals are left in the village library.

Conclude with a vision of the post-project landscape: "Even without further funding, the 5 data hubs will continue to operate using Village Funds."`,
        tip: `You are planting a perennial tree (lives for years), not an annual flower (dies in winter).
- Policy is Key: The strongest sustainability is changing a law or regulation (Perdes). Once it's law, the budget follows automatically.
- Ownership: Emphasize that the "Community owns the data," not the NGO.`,
        mistakes: `1. "We will apply for Phase 2 funding": That is dependency, not sustainability.
2. "The project ends when funding ends": Immediate rejection.
3. Vague Asset Handover: Be clear. "Laptops will be donated to the Village Office," not "Laptops will be kept by staff."`
      }, 
      id: { 
        what: `"Strategi Keluar" (Exit Strategy). Donor takut pada proyek yang rubuh begitu dana setop. Anda harus yakinkan mereka bahwa Anda membangun aset permanen, bukan event sesaat. Bahas tiga pilar keberlanjutan:

1. Keberlanjutan Finansial:
- Siapa bayar nanti? Jangan bilang "donor lain".
- Jawaban lebih baik: "Integrasi ke Dana Desa", "Jual kredit plastik", "Iuran dari resor wisata".

2. Keberlanjutan Institusional:
- Siapa yang urus nanti?
- Strategi: MOU dengan Pemda untuk adopsi program. Membentuk "Asosiasi Pemuda" lokal berbadan hukum.

3. Keberlanjutan Teknis:
- Apakah ilmunya tertinggal?
- Strategi: Training of Trainers (ToT). Kode aplikasi open-source. Manual ditinggal di perpustakaan desa.

Tutup dengan visi pasca-proyek: "Bahkan tanpa dana tambahan, 5 hub data akan terus operasi pakai Dana Desa."`,
        tip: `Anda menanam pohon beringin (hidup tahunan), bukan bunga musiman.
- Kebijakan itu Kunci: Keberlanjutan terkuat adalah ubah aturan (Perdes). Sekali jadi hukum, anggaran otomatis ikut.
- Kepemilikan: Tekankan "Warga memiliki datanya", bukan NGO.`,
        mistakes: `1. "Kami akan ajukan dana Fase 2": Itu ketergantungan, bukan sustainability.
2. "Proyek selesai saat dana habis": Penolakan langsung.
3. Serah Terima Aset Samar: Harus jelas. "Laptop dihibahkan ke Kantor Desa", bukan "Laptop disimpan staf".`
      } 
    }
  },

// === PANDUAN UNTUK TEMPLATE BARU ===
working_paper: {
  _analogy: { en: 'A working paper is a work in progress, open for feedback.', id: 'Working paper adalah karya yang sedang berjalan, terbuka untuk masukan.' },
  abstract: {
    en: { what: 'State the research question, preliminary findings, and contribution.', tip: 'Emphasize novelty.' },
    id: { what: 'Nyatakan pertanyaan penelitian, temuan awal, dan kontribusi.', tip: 'Tekankan kebaruan.' }
  },
  introduction: {
    en: { what: 'Introduce the problem and why it matters now.', tip: 'Cite recent developments.' },
    id: { what: 'Perkenalkan masalah dan mengapa penting saat ini.', tip: 'Kutip perkembangan terbaru.' }
  },
  literature_review: {
    en: { what: 'Discuss relevant prior work and identify gaps.', tip: 'Focus on literature from the last 5 years.' },
    id: { what: 'Bahas karya sebelumnya yang relevan dan identifikasi celah.', tip: 'Fokus pada literatur 5 tahun terakhir.' }
  },
  theoretical_framework: {
    en: { what: 'Outline the concepts or models guiding your analysis.', tip: 'Keep it concise; elaborate in later versions.' },
    id: { what: 'Gariskan konsep atau model yang memandu analisis Anda.', tip: 'Tetap ringkas; akan diperluas di versi selanjutnya.' }
  },
  preliminary_analysis: {
    en: { what: 'Present early data or stylized facts.', tip: 'Acknowledge limitations.' },
    id: { what: 'Sajikan data awal atau fakta bergaya.', tip: 'Akui keterbatasan.' }
  },
  discussion: {
    en: { what: 'Interpret findings and link to literature.', tip: 'Suggest implications.' },
    id: { what: 'Interpretasikan temuan dan hubungkan dengan literatur.', tip: 'Sarankan implikasi.' }
  },
  conclusion: {
    en: { what: 'Summarize and outline next steps.', tip: 'Invite feedback.' },
    id: { what: 'Ringkas dan gariskan langkah selanjutnya.', tip: 'Undang masukan.' }
  }
},
dissertation_thesis: {
  _analogy: { en: 'A thesis is your contribution to a scholarly conversation.', id: 'Tesis adalah kontribusi Anda dalam percakapan ilmiah.' },
  abstract: {
    en: { what: 'Summarize each essay/chapter, overall contribution.', tip: 'Write after completing the dissertation.' },
    id: { what: 'Ringkas setiap esai/bab, kontribusi keseluruhan.', tip: 'Tulis setelah menyelesaikan disertasi.' }
  },
  introduction: {
    en: { what: 'Present the overarching research question and why it matters.', tip: 'Outline the structure.' },
    id: { what: 'Sajikan pertanyaan penelitian utama dan mengapa penting.', tip: 'Gariskan struktur.' }
  },
  literature_review: {
    en: { what: 'Synthesize literature that frames all essays.', tip: 'Identify the gap your thesis fills.' },
    id: { what: 'Sintesis literatur yang membingkai semua esai.', tip: 'Identifikasi celah yang diisi tesis Anda.' }
  },
  methodology: {
    en: { what: 'Describe methods used across essays (if common).', tip: 'Justify choices.' },
    id: { what: 'Jelaskan metode yang digunakan di semua esai (jika umum).', tip: 'Justifikasi pilihan.' }
  },
  findings: {
    en: { what: 'Present key results from each essay.', tip: 'Use subheadings per essay.' },
    id: { what: 'Sajikan hasil utama dari setiap esai.', tip: 'Gunakan subjudul per esai.' }
  },
  discussion: {
    en: { what: 'Integrate findings, discuss implications, limitations.', tip: 'Connect back to literature.' },
    id: { what: 'Integrasikan temuan, bahas implikasi, keterbatasan.', tip: 'Hubungkan kembali ke literatur.' }
  },
  conclusion: {
    en: { what: 'Summarize contributions and future research.', tip: 'End with a strong takeaway.' },
    id: { what: 'Ringkas kontribusi dan penelitian selanjutnya.', tip: 'Akhiri dengan pesan kuat.' }
  },
  references: {
    en: { what: 'List all cited works in consistent style.', tip: 'Use reference manager.' },
    id: { what: 'Daftar semua karya yang dikutip dengan gaya konsisten.', tip: 'Gunakan manajer referensi.' }
  }
},
policy_brief: {
  _analogy: { en: 'A policy brief is a call to action for busy policymakers.', id: 'Policy brief adalah ajakan bertindak untuk pembuat kebijakan yang sibuk.' },
  executive_summary: {
    en: { what: 'State the problem, key recommendation, and main evidence.', tip: 'One paragraph max.' },
    id: { what: 'Nyatakan masalah, rekomendasi utama, dan bukti utama.', tip: 'Maksimal satu paragraf.' }
  },
  key_recommendations: {
    en: { what: 'List 3–5 actionable recommendations.', tip: 'Make them specific and feasible.' },
    id: { what: 'Daftar 3–5 rekomendasi yang dapat ditindaklanjuti.', tip: 'Buatlah spesifik dan layak.' }
  },
  context: {
    en: { what: 'Briefly describe the policy issue and its importance.', tip: 'Use a hook to grab attention.' },
    id: { what: 'Jelaskan secara singkat masalah kebijakan dan pentingnya.', tip: 'Gunakan kalimat pembuka yang menarik.' }
  },
  evidence: {
    en: { what: 'Present data, research, or case studies supporting your recommendations.', tip: 'Highlight 2–3 key facts.' },
    id: { what: 'Sajikan data, penelitian, atau studi kasus yang mendukung rekomendasi Anda.', tip: 'Sorot 2–3 fakta kunci.' }
  },
  implications: {
    en: { what: 'Discuss costs, benefits, and trade-offs.', tip: 'Be honest about uncertainties.' },
    id: { what: 'Bahas biaya, manfaat, dan trade-off.', tip: 'Jujurlah tentang ketidakpastian.' }
  },
  conclusion: {
    en: { what: 'Reiterate the call to action.', tip: 'Keep it short.' },
    id: { what: 'Ulangi ajakan bertindak.', tip: 'Tetap singkat.' }
  }
},
policy_paper: {
  _analogy: { en: 'A policy paper is a deep dive into options.', id: 'Policy paper adalah analisis mendalam tentang pilihan-pilihan.' },
  executive_summary: {
    en: { what: 'Summarize the problem, options analyzed, and recommended course.', tip: 'Include key numbers.' },
    id: { what: 'Ringkas masalah, opsi yang dianalisis, dan arah yang direkomendasikan.', tip: 'Sertakan angka-angka kunci.' }
  },
  problem_definition: {
    en: { what: 'Define the issue with evidence.', tip: 'Use data to show magnitude.' },
    id: { what: 'Definisikan masalah dengan bukti.', tip: 'Gunakan data untuk menunjukkan besaran.' }
  },
  policy_options: {
    en: { what: 'Describe each option clearly.', tip: 'Include a “no action” baseline.' },
    id: { what: 'Jelaskan setiap opsi dengan jelas.', tip: 'Sertakan opsi “tanpa tindakan” sebagai dasar.' }
  },
  analysis: {
    en: { what: 'Evaluate options against criteria (cost, effectiveness, equity, feasibility).', tip: 'Use a comparison matrix.' },
    id: { what: 'Evaluasi opsi berdasarkan kriteria (biaya, efektivitas, kesetaraan, kelayakan).', tip: 'Gunakan matriks perbandingan.' }
  },
  recommendations: {
    en: { what: 'State your preferred option and justify.', tip: 'Address implementation challenges.' },
    id: { what: 'Nyatakan opsi pilihan Anda dan beri justifikasi.', tip: 'Bahasa tantangan implementasi.' }
  },
  implementation: {
    en: { what: 'Outline steps, timeline, and responsible actors.', tip: 'Mention monitoring mechanisms.' },
    id: { what: 'Gariskan langkah, jadwal, dan aktor yang bertanggung jawab.', tip: 'Sebutkan mekanisme pemantauan.' }
  }
},
white_paper: {
  _analogy: { en: 'A white paper is a persuasive technical brief.', id: 'White paper adalah brief teknis yang persuasif.' },
  executive_summary: {
    en: { what: 'Summarize the problem, solution, and benefits.', tip: 'Target C-level readers.' },
    id: { what: 'Ringkas masalah, solusi, dan manfaat.', tip: 'Targetkan pembaca tingkat direksi.' }
  },
  introduction: {
    en: { what: 'Set the stage: why this issue matters now.', tip: 'Use a compelling statistic.' },
    id: { what: 'Atur panggung: mengapa masalah ini penting saat ini.', tip: 'Gunakan statistik yang menarik.' }
  },
  current_challenges: {
    en: { what: 'Describe pain points and limitations of existing approaches.', tip: 'Be specific with examples.' },
    id: { what: 'Jelaskan masalah dan keterbatasan pendekatan yang ada.', tip: 'Berikan contoh spesifik.' }
  },
  proposed_solution: {
    en: { what: 'Explain your solution, how it works, and its uniqueness.', tip: 'Use diagrams if possible (describe).' },
    id: { what: 'Jelaskan solusi Anda, cara kerjanya, dan keunikannya.', tip: 'Gunakan diagram jika memungkinkan (deskripsikan).' }
  },
  benefits: {
    en: { what: 'Quantify advantages: ROI, efficiency, security.', tip: 'Compare to alternatives.' },
    id: { what: 'Kuantifikasi keuntungan: ROI, efisiensi, keamanan.', tip: 'Bandingkan dengan alternatif.' }
  },
  roadmap: {
    en: { what: 'Outline implementation phases and timeline.', tip: 'Be realistic.' },
    id: { what: 'Gariskan fase implementasi dan jadwal.', tip: 'Bersikaplah realistis.' }
  },
  conclusion: {
    en: { what: 'Reinforce the call to adopt the solution.', tip: 'End with contact/next steps.' },
    id: { what: 'Perkuat ajakan untuk mengadopsi solusi.', tip: 'Akhiri dengan kontak/langkah selanjutnya.' }
  }
},
position_paper: {
  _analogy: { en: 'A position paper states where you stand.', id: 'Position paper menyatakan posisi Anda.' },
  executive_summary: {
    en: { what: 'State your position and main arguments.', tip: 'One paragraph.' },
    id: { what: 'Nyatakan posisi Anda dan argumen utama.', tip: 'Satu paragraf.' }
  },
  introduction: {
    en: { what: 'Introduce the issue and why it’s contested.', tip: 'Brief background.' },
    id: { what: 'Perkenalkan isu dan mengapa diperdebatkan.', tip: 'Latar belakang singkat.' }
  },
  stance: {
    en: { what: 'Clearly articulate your position.', tip: 'Use a strong thesis statement.' },
    id: { what: 'Artikulasikan posisi Anda dengan jelas.', tip: 'Gunakan pernyataan tesis yang kuat.' }
  },
  arguments: {
    en: { what: 'Present supporting evidence and reasoning.', tip: 'Address each argument separately.' },
    id: { what: 'Sajikan bukti dan alasan pendukung.', tip: 'Tangani setiap argumen secara terpisah.' }
  },
  counterarguments: {
    en: { what: 'Acknowledge opposing views and rebut them.', tip: 'Show fairness and strength.' },
    id: { what: 'Akui pandangan yang berlawanan dan bantah.', tip: 'Tunjukkan keadilan dan kekuatan.' }
  },
  conclusion: {
    en: { what: 'Summarize and call for action.', tip: 'Reiterate the stakes.' },
    id: { what: 'Ringkas dan ajak bertindak.', tip: 'Ulangi apa yang dipertaruhkan.' }
  }
},
technical_report: {
  _analogy: { en: 'A technical report is a lab notebook for others.', id: 'Laporan teknis adalah catatan laboratorium untuk orang lain.' },
  abstract: {
    en: { what: 'Summarize objectives, methods, key results, and conclusions.', tip: 'Include numerical highlights.' },
    id: { what: 'Ringkas tujuan, metode, hasil utama, dan kesimpulan.', tip: 'Sertakan sorotan numerik.' }
  },
  introduction: {
    en: { what: 'State the problem and context.', tip: 'Mention who commissioned it.' },
    id: { what: 'Nyatakan masalah dan konteks.', tip: 'Sebutkan siapa yang memesannya.' }
  },
  system_overview: {
    en: { what: 'Describe the hardware/software/system under test.', tip: 'Include specifications.' },
    id: { what: 'Jelaskan perangkat keras/perangkat lunak/sistem yang diuji.', tip: 'Sertakan spesifikasi.' }
  },
  methodology: {
    en: { what: 'Detail test setup, procedures, and measurement tools.', tip: 'Include calibration info.' },
    id: { what: 'Rinci pengaturan uji, prosedur, dan alat ukur.', tip: 'Sertakan info kalibrasi.' }
  },
  results: {
    en: { what: 'Present data in tables/figures with brief descriptions.', tip: 'Do not interpret yet.' },
    id: { what: 'Sajikan data dalam tabel/figur dengan deskripsi singkat.', tip: 'Jangan interpretasi dulu.' }
  },
  discussion: {
    en: { what: 'Interpret results, compare to expectations, note anomalies.', tip: 'Suggest improvements.' },
    id: { what: 'Interpretasi hasil, bandingkan dengan harapan, catat anomali.', tip: 'Sarankan perbaikan.' }
  },
  conclusion: {
    en: { what: 'Summarize main takeaways.', tip: 'Mention if further testing is needed.' },
    id: { what: 'Ringkas kesimpulan utama.', tip: 'Sebutkan jika diperlukan pengujian lebih lanjut.' }
  }
},
guideline_sop: {
  _analogy: { en: 'An SOP is a recipe for consistency.', id: 'SOP adalah resep untuk konsistensi.' },
  purpose: {
    en: { what: 'Explain why the SOP exists.', tip: 'Link to regulations if applicable.' },
    id: { what: 'Jelaskan mengapa SOP ini ada.', tip: 'Hubungkan dengan regulasi jika ada.' }
  },
  scope: {
    en: { what: 'Define who and what the SOP covers.', tip: 'Mention exclusions.' },
    id: { what: 'Tentukan siapa dan apa yang dicakup SOP.', tip: 'Sebutkan pengecualian.' }
  },
  definitions: {
    en: { what: 'Define key terms and acronyms.', tip: 'Keep it simple.' },
    id: { what: 'Definisikan istilah dan akronim kunci.', tip: 'Tetap sederhana.' }
  },
  responsibilities: {
    en: { what: 'List roles and their duties.', tip: 'Use a table if many.' },
    id: { what: 'Daftar peran dan tugas mereka.', tip: 'Gunakan tabel jika banyak.' }
  },
  procedure: {
    en: { what: 'Provide step-by-step instructions.', tip: 'Use numbered steps, active voice.' },
    id: { what: 'Berikan instruksi langkah demi langkah.', tip: 'Gunakan langkah bernomor, kalimat aktif.' }
  },
  compliance: {
    en: { what: 'Explain consequences of non-compliance.', tip: 'Reference related policies.' },
    id: { what: 'Jelaskan konsekuensi ketidakpatuhan.', tip: 'Rujuk kebijakan terkait.' }
  },
  references: {
    en: { what: 'List related documents and regulations.', tip: 'Include version numbers.' },
    id: { what: 'Daftar dokumen dan regulasi terkait.', tip: 'Sertakan nomor versi.' }
  }
},
regulatory_impact_assessment: {
  _analogy: { en: 'An RIA is a cost–benefit analysis for rules.', id: 'RIA adalah analisis biaya-manfaat untuk peraturan.' },
  executive_summary: {
    en: { what: 'Summarize the problem, preferred option, and net benefits.', tip: 'Highlight key numbers.' },
    id: { what: 'Ringkas masalah, opsi yang dipilih, dan manfaat bersih.', tip: 'Sorot angka-angka kunci.' }
  },
  problem_identification: {
    en: { what: 'Describe the market failure or issue.', tip: 'Use evidence.' },
    id: { what: 'Jelaskan kegagalan pasar atau masalah.', tip: 'Gunakan bukti.' }
  },
  objectives: {
    en: { what: 'State what the regulation aims to achieve.', tip: 'Be specific and measurable.' },
    id: { what: 'Nyatakan apa yang ingin dicapai oleh regulasi.', tip: 'Spesifik dan terukur.' }
  },
  options: {
    en: { what: 'List alternative approaches, including “do nothing”.', tip: 'Describe each concisely.' },
    id: { what: 'Daftar pendekatan alternatif, termasuk “tidak melakukan apa pun”.', tip: 'Jelaskan masing-masing secara ringkas.' }
  },
  impact_analysis: {
    en: { what: 'Quantify costs, benefits, and distributional effects.', tip: 'Use monetized values where possible.' },
    id: { what: 'Kuantifikasi biaya, manfaat, dan efek distribusi.', tip: 'Gunakan nilai moneter jika memungkinkan.' }
  },
  consultation: {
    en: { what: 'Summarize stakeholder feedback and how it influenced the analysis.', tip: 'Be transparent.' },
    id: { what: 'Ringkas masukan pemangku kepentingan dan bagaimana pengaruhnya terhadap analisis.', tip: 'Bersikaplah transparan.' }
  },
  recommendation: {
    en: { what: 'State the preferred option and justification.', tip: 'Mention next steps.' },
    id: { what: 'Nyatakan opsi yang dipilih dan justifikasi.', tip: 'Sebutkan langkah selanjutnya.' }
  }
}

  /* ------------------------------------------------------------- */
};

const CATEGORY_CONFIG = {
  academic: { label: 'Academic', color: 'blue', icon: <GraduationCap className="w-5 h-5" />, logic: 'IMRaD' },
  policy: { label: 'Policy', color: 'emerald', icon: <Scale className="w-5 h-5" />, logic: 'Problem–Solution' },
  media: { label: 'Media', color: 'orange', icon: <Newspaper className="w-5 h-5" />, logic: 'Narrative' }
};

// 3. MODULE REGISTRY (Tombol Template yang Muncul)
const MODULE_REGISTRY_DEFINITION = [
  { 
      id: 'journal_article', 
      name: 'Journal Article', 
      category: 'academic', 
      schema_version: SCHEMA_VERSION, 
      structural_sections: ['abstract','introduction','framework','methodology','findings','discussion','conclusion'], 
      color: 'blue', 
      description: 'Full empirical research paper.' 
  },
  
  /* --- AREA EDIT (PAK ANGGA): DAFTARKAN TOMBOL BARU DI SINI --- */
  
  { 
      id: 'project_proposal', // HARUS SAMA dengan ID di DUMMY_DATA dan GUIDANCE
      name: 'Project Proposal', // Nama yang muncul di tombol
      category: 'academic', // Kategori: 'academic', 'policy', atau 'media'
      schema_version: SCHEMA_VERSION, 
      // Urutan bagian-bagian dokumen
      structural_sections: ['executive_summary','situational_analysis','methodology','technical_implementation','logframe','budget_narrative','sustainability'], 
      color: 'blue', 
      description: 'Proposal pendanaan proyek standar.' 
  }, { 
  id: 'working_paper', 
  name: 'Working Paper', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','literature_review','theoretical_framework','preliminary_analysis','discussion','conclusion'], 
  color: 'blue', 
  description: 'Preliminary research findings shared for feedback.' 
},
{ 
  id: 'dissertation_thesis', 
  name: 'Dissertation / Thesis', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','literature_review','methodology','findings','discussion','conclusion','references'], 
  color: 'blue', 
  description: 'Original research for doctoral or master\'s degree.' 
},
{ 
  id: 'policy_brief', 
  name: 'Policy Brief', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','key_recommendations','context','evidence','implications','conclusion'], 
  color: 'emerald', 
  description: 'Concise summary of policy issue and recommendations.' 
},
{ 
  id: 'policy_paper', 
  name: 'Policy Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','problem_definition','policy_options','analysis','recommendations','implementation'], 
  color: 'emerald', 
  description: 'Detailed analysis of policy options.' 
},
{ 
  id: 'white_paper', 
  name: 'White Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','introduction','current_challenges','proposed_solution','benefits','roadmap','conclusion'], 
  color: 'emerald', 
  description: 'Authoritative report on a specific issue and solution.' 
},
{ 
  id: 'position_paper', 
  name: 'Position Paper', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','introduction','stance','arguments','counterarguments','conclusion'], 
  color: 'emerald', 
  description: 'Statement of an organization\'s or individual\'s position.' 
},
{ 
  id: 'technical_report', 
  name: 'Technical Report', 
  category: 'academic', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['abstract','introduction','system_overview','methodology','results','discussion','conclusion'], 
  color: 'blue', 
  description: 'Documentation of technical research or development.' 
},
{ 
  id: 'guideline_sop', 
  name: 'Guideline / SOP Document', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['purpose','scope','definitions','responsibilities','procedure','compliance','references'], 
  color: 'emerald', 
  description: 'Standard operating procedures or guidelines.' 
},
{ 
  id: 'regulatory_impact_assessment', 
  name: 'Regulatory Impact Assessment', 
  category: 'policy', 
  schema_version: SCHEMA_VERSION, 
  structural_sections: ['executive_summary','problem_identification','objectives','options','impact_analysis','consultation','recommendation'], 
  color: 'emerald', 
  description: 'Evaluation of effects of proposed regulations.' 
},

  /* ------------------------------------------------------------- */
  
  { id: 'conference_paper', name: 'Conference Paper', category: 'academic', schema_version: SCHEMA_VERSION, structural_sections: ['abstract','introduction','related_work','method','experiments','conclusion'], color: 'blue', description: 'Concise research contribution.' },
  { id: 'research_report', name: 'Research Report', category: 'academic', schema_version: SCHEMA_VERSION, structural_sections: ['executive_summary','background','methodology','findings','recommendations'], color: 'blue', description: 'Commissioned investigation.' }
];

/* ═══════════════════════════════════════════════════════════════
   LOGIC & UI (JANGAN DIUBAH KECUALI PAHAM REACT)
═══════════════════════════════════════════════════════════════ */

const colorMap = {
  blue: { bg: 'bg-blue-500/10', border: 'border-blue-500/30 hover:border-blue-500', text: 'text-blue-400', badge: 'bg-blue-900/50 text-blue-300 border-blue-500/30', glow: 'hover:shadow-blue-500/10' },
  emerald: { bg: 'bg-emerald-500/10', border: 'border-emerald-500/30 hover:border-emerald-500', text: 'text-emerald-400', badge: 'bg-emerald-900/50 text-emerald-300 border-emerald-500/30', glow: 'hover:shadow-emerald-500/10' },
  orange: { bg: 'bg-orange-500/10', border: 'border-orange-500/30 hover:border-orange-500', text: 'text-orange-400', badge: 'bg-orange-900/50 text-orange-300 border-orange-500/30', glow: 'hover:shadow-orange-500/10' }
};

class ModuleInstaller {
  constructor() { this.registry = {}; }
  install(modules) { modules.forEach(mod => this.registry[mod.id] = mod); }
  get(id) { return this.registry[id] || null; }
  getByCategory(cat) { return Object.values(this.registry).filter(m => m.category === cat); }
}
const installer = new ModuleInstaller();
installer.install(MODULE_REGISTRY_DEFINITION);
const generateId = () => Math.random().toString(36).substr(2, 9);
const buildModuleData = (moduleId, isTutorial) => {
  const mod = installer.get(moduleId);
  if (!mod) return null;
  const dummyMod = DUMMY_DATA[moduleId];
  const guidanceMod = GUIDANCE[moduleId] || {};
  const sections = mod.structural_sections.map(secKey => ({
    id: generateId(), sectionKey: secKey,
    content: isTutorial ? (dummyMod?.sections.find(s => s.key === secKey)?.content || `<h3>${secKey.replace(/_/g,' ')}</h3><p>...</p>`) : `<h3>${secKey.replace(/_/g,' ')}</h3><p>[Write here...]</p>`,
    guidance: { en: guidanceMod[secKey]?.en || { what: 'Write content.' }, id: guidanceMod[secKey]?.id || { what: 'Tulis konten.' } },
    analogy: { en: guidanceMod._analogy?.en, id: guidanceMod._analogy?.id },
    aiFeedback: null
  }));
  return { id: generateId(), moduleId, title: isTutorial ? (dummyMod?.title || mod.name) : `My ${mod.name}`, sections, metadata: mod };
};

/* ═══════════════════════════════════════════════════════════════
   UI COMPONENTS
═══════════════════════════════════════════════════════════════ */

const ErrorToast = ({ message, onClose, onRetry }) => {
    if (!message) return null;
    return (
        <div className="fixed bottom-6 right-6 max-w-sm w-full bg-slate-900 border border-red-500/50 text-white p-4 rounded-xl shadow-2xl z-[100] anim-up flex gap-3">
            <div className="p-2 bg-red-500/20 rounded-full h-fit">
                <AlertTriangle className="w-5 h-5 text-red-400" />
            </div>
            <div className="flex-1">
                <h4 className="font-bold text-red-400 text-sm mb-1">Proses AI Gagal</h4>
                <p className="text-xs text-slate-300 leading-relaxed mb-3">{message}</p>
                <div className="flex gap-2">
                    <button onClick={onRetry} className="flex-1 py-1.5 bg-red-600 hover:bg-red-700 rounded-lg text-[10px] font-bold transition-colors">
                        Coba Lagi
                    </button>
                    <button onClick={onClose} className="px-3 py-1.5 bg-slate-800 hover:bg-slate-700 rounded-lg text-[10px] font-bold transition-colors">
                        Tutup
                    </button>
                </div>
            </div>
        </div>
    );
};

const AIMonitor = ({ status }) => {
    if (!status) return null;
    return (
        <div className="fixed bottom-6 left-6 bg-slate-900/90 backdrop-blur border border-blue-500/30 p-2.5 rounded-lg shadow-xl z-50 flex items-center gap-3 anim-fade">
            <div className="p-1.5 bg-blue-500/20 rounded-md">
                <Terminal className="w-3.5 h-3.5 text-blue-400" />
            </div>
            <span className="text-[10px] font-mono text-blue-300">{status}</span>
        </div>
    );
};

const RichTextEditor = ({ initialContent, onSave, onCancel }) => {
  const editorRef = useRef(null);
  const execCmd = (cmd, val = null) => { document.execCommand(cmd, false, val); editorRef.current.focus(); };
  return (
    <div className="border-2 border-blue-400 rounded-xl overflow-hidden bg-white flex flex-col shadow-lg anim-scale">
      <div className="bg-slate-50 border-b p-2 flex gap-1 items-center flex-wrap">
        <button onClick={() => execCmd('bold')} className="p-1.5 hover:bg-slate-200 rounded" title="Bold"><Bold className="w-3.5 h-3.5"/></button>
        <button onClick={() => execCmd('italic')} className="p-1.5 hover:bg-slate-200 rounded" title="Italic"><Italic className="w-3.5 h-3.5"/></button>
        <div className="w-px h-4 bg-slate-300 mx-1"/>
        <button onClick={() => execCmd('formatBlock','H3')} className="px-2 py-1 hover:bg-slate-200 rounded text-xs font-bold">H3</button>
        <button onClick={() => execCmd('formatBlock','P')} className="px-2 py-1 hover:bg-slate-200 rounded text-xs">¶</button>
        <div className="w-px h-4 bg-slate-300 mx-1"/>
        <button onClick={() => execCmd('insertUnorderedList')} className="p-1.5 hover:bg-slate-200 rounded"><List className="w-3.5 h-3.5"/></button>
        <button onClick={() => execCmd('insertOrderedList')} className="p-1.5 hover:bg-slate-200 rounded text-xs font-mono">1.</button>
      </div>
      <div ref={editorRef} className="p-4 outline-none prose-card text-sm" contentEditable suppressContentEditableWarning
        dangerouslySetInnerHTML={{ __html: initialContent }} style={{ minHeight: '140px' }}/>
      <div className="p-2 border-t bg-slate-50 flex justify-end gap-2">
        <button onClick={onCancel} className="px-3 py-1.5 text-xs text-slate-600 hover:bg-slate-100 rounded-lg">Batal</button>
        <button onClick={() => onSave(editorRef.current.innerHTML)} className="px-4 py-1.5 text-xs bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">Simpan</button>
      </div>
    </div>
  );
};

const GuidancePanel = ({ section, moduleId, lang, onRunAI, isProcessing, setLang }) => {
  const [tab, setTab] = useState('what');
  
  if (!section) return (
    <div className="flex flex-col items-center justify-center h-full text-slate-500 p-6">
      <BookOpen className="w-12 h-12 mb-3 text-slate-300"/>
      <p className="text-sm text-center">Pilih bagian untuk melihat panduan</p>
    </div>
  );

  const g = section.guidance?.[lang] || {};
  const analogy = section.analogy?.[lang] || '';
  const tabs = [
    { id: 'what', label: lang === 'en' ? 'What to Write' : 'Apa yang Ditulis', icon: <PenTool className="w-3 h-3"/> },
    { id: 'tip', label: lang === 'en' ? 'Why It Matters' : 'Mengapa Penting', icon: <Info className="w-3 h-3"/> },
    { id: 'mistakes', label: lang === 'en' ? 'Avoid' : 'Hindari', icon: <AlertCircle className="w-3 h-3"/> },
    { id: 'coach', label: lang === 'en' ? 'AI Coach' : 'Pelatih AI', icon: <GraduationCap className="w-3 h-3"/> }
  ];

  return (
    <div className="flex flex-col h-full anim-right">
      <div className="p-4 border-b bg-slate-50">
        <div className="flex justify-between items-start mb-2">
            <div className="text-xs font-bold uppercase tracking-wider text-slate-400">
            {section.sectionKey?.replace(/_/g,' ')}
            </div>
        </div>
        
        {analogy && (
          <div className="text-xs text-indigo-600 italic leading-relaxed bg-indigo-50 rounded-lg p-2 border border-indigo-100">
            💡 {analogy}
          </div>
        )}
      </div>

      <div className="flex border-b bg-white">
        {tabs.map(t => (
          <button key={t.id} onClick={() => setTab(t.id)}
            className={`flex-1 py-2 text-xs font-medium flex items-center justify-center gap-1 transition-colors border-b-2 ${
              tab === t.id ? 'border-blue-500 text-blue-600 bg-blue-50/50' : 'border-transparent text-slate-500 hover:text-slate-700'
            }`}>
            {t.icon} <span className="hidden sm:inline">{t.label}</span>
          </button>
        ))}
      </div>

      <div className="p-4 overflow-y-auto flex-1 custom-scrollbar">
        {tab === 'coach' ? (
          <div className="flex flex-col gap-4">
            <div className="bg-purple-50 border border-purple-100 rounded-xl p-3">
              <div className="flex items-center gap-2 mb-2">
                <div className="p-1 bg-purple-200 rounded-lg"><GraduationCap className="w-4 h-4 text-purple-700"/></div>
                <h4 className="font-bold text-sm text-purple-900">Writing Coach</h4>
              </div>
              <p className="text-xs text-purple-800 mb-3">
                {lang === 'en' 
                    ? "I can analyze your draft against the section goals and provide specific structural feedback." 
                    : "Saya akan menganalisis draf Anda dan memberikan masukan struktural yang spesifik."}
              </p>
              <button onClick={onRunAI} disabled={isProcessing}
                className={`w-full py-2 rounded-lg text-xs font-bold text-white transition-all ${isProcessing ? 'bg-slate-400' : 'bg-purple-600 hover:bg-purple-700 shadow-md shadow-purple-200'}`}>
                {isProcessing ? (lang === 'en' ? 'Analyzing...' : 'Menganalisis...') : (lang === 'en' ? 'Analyze My Draft' : 'Analisis Draf Saya')}
              </button>
            </div>
            
            {section.aiFeedback && (
               <div className="prose-card text-sm p-3 bg-white border border-slate-200 rounded-xl shadow-sm animate-in fade-in slide-in-from-bottom-2">
                 <div className="text-xs font-bold text-slate-400 uppercase mb-2">Coach Feedback</div>
                 <div className="whitespace-pre-line leading-relaxed">{section.aiFeedback}</div>
               </div>
            )}
          </div>
        ) : (
          <p className="text-sm leading-relaxed text-slate-700">{g[tab]}</p>
        )}
      </div>
    </div>
  );
};

const ModuleDetailPanel = ({ mod, onSelect, onClose }) => {
  const cat = CATEGORY_CONFIG[mod.category];
  const col = colorMap[mod.color];
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm anim-fade">
      <div className="bg-slate-900 border border-slate-700 rounded-2xl max-w-lg w-full p-6 anim-scale shadow-2xl">
        <div className="flex justify-between items-start mb-4">
          <div>
            <div className={`inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs border ${col.badge} mb-2`}>
              {cat.icon} {cat.label} · {cat.logic}
            </div>
            <h2 className="text-xl font-bold text-white">{mod.name}</h2>
          </div>
          <button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg text-slate-400"><X className="w-4 h-4"/></button>
        </div>

        <p className="text-slate-400 text-sm mb-4">{mod.description}</p>
        <div className="flex gap-3 mt-8">
          <button onClick={() => onSelect(mod.id, false)} className="flex-1 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-xl text-sm font-semibold transition-colors">
            Start New
          </button>
          <button onClick={() => onSelect(mod.id, true)} className="flex-1 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl text-sm font-semibold transition-colors">
            Load Example
          </button>
        </div>
      </div>
    </div>
  );
};

const LandingPage = ({ onSelectTemplate, onImport }) => {
  const [activeCategory, setActiveCategory] = useState('academic');
  const [detailMod, setDetailMod] = useState(null);
  const modules = installer.getByCategory(activeCategory);

  return (
    <div className="min-h-screen bg-[#0a0f1e] text-white flex flex-col overflow-auto">
      <div className="relative z-10 flex flex-col items-center px-6 py-12">
        <div className="text-center mb-8 anim-up">
          <h1 className="text-5xl font-black mb-3 tracking-tight">
            Structure<span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-400 to-emerald-400">Flow</span>
          </h1>
          <p className="text-slate-400 max-w-md mx-auto">10 publication modules. Professional guidance. Bilingual intelligence.</p>
        </div>
        
        <div className="flex gap-2 mb-8 bg-slate-800/50 p-1 rounded-xl border border-slate-700/50 anim-up delay-2">
          {Object.entries(CATEGORY_CONFIG).map(([key, cat]) => (
            <button key={key} onClick={() => setActiveCategory(key)}
              className={`flex items-center gap-2 px-5 py-2.5 rounded-lg text-sm font-semibold transition-all ${
                activeCategory === key
                  ? 'bg-slate-700 text-white shadow-lg'
                  : 'text-slate-400 hover:text-slate-300'
              }`}>
              {cat.icon} {cat.label}
            </button>
          ))}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 max-w-7xl w-full mb-10 anim-up delay-3">
          {modules.map((mod, i) => {
            const col = colorMap[mod.color];
            return (
              <button key={mod.id}
                onClick={() => setDetailMod(mod)}
                className={`relative p-5 rounded-xl border ${col.border} bg-slate-800/60 backdrop-blur text-left transition-all duration-300 hover:-translate-y-0.5 hover:shadow-xl ${col.glow} group`}>
                <h3 className="font-bold text-slate-100 text-sm mb-1">{mod.name}</h3>
                <p className="text-xs text-slate-400 leading-relaxed mb-3">{mod.description}</p>
              </button>
            );
          })}
        </div>

        <label className="flex items-center gap-3 px-5 py-3 rounded-xl border border-dashed border-slate-600 hover:border-purple-500 bg-slate-800/30 cursor-pointer transition-colors group text-sm text-slate-400 hover:text-slate-300">
          <input type="file" onChange={onImport} className="hidden" accept=".json"/>
          <FolderOpen className="w-4 h-4 group-hover:text-purple-400 transition-colors"/>
          Muat sesi JSON yang disimpan sebelumnya
        </label>
      </div>

      {detailMod && (
        <ModuleDetailPanel
          mod={detailMod}
          onSelect={(id, isTutorial) => { setDetailMod(null); onSelectTemplate(id, isTutorial); }}
          onClose={() => setDetailMod(null)}
        />
      )}
    </div>
  );
};

/* ═══════════════════════════════════════════════════════════════
   MAIN APP
═══════════════════════════════════════════════════════════════ */

function App() {
  const [view, setView] = useState('landing');
  const [docData, setDocData] = useState(null);
  const [selectedIdx, setSelectedIdx] = useState(0);
  const [editingIdx, setEditingIdx] = useState(null);
  const [lang, setLang] = useState('en');
  
  const [apiKey, setApiKey] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [aiStatus, setAiStatus] = useState(null); 
  const [aiError, setAiError] = useState(null); 
  const [history, setHistory] = useState([]);
  const [retryAction, setRetryAction] = useState(null); 

  const pushHistory = () => {
    setHistory(prev => [...prev.slice(-9), JSON.parse(JSON.stringify(docData))]);
  };
  
  const handleUndo = () => {
    if (history.length === 0) return;
    const previous = history[history.length - 1];
    setHistory(prev => prev.slice(0, -1));
    setDocData(previous);
  };

  const handleNodecardAI = async (idx) => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleNodecardAI(idx));
    try {
      const section = docData.sections[idx];
      const prev = idx > 0 ? docData.sections[idx - 1] : null;
      const next = idx < docData.sections.length - 1 ? docData.sections[idx + 1] : null;
      const prompt = AI_BRIDGE.buildNodeContext(section, prev, next, docData, lang);
      
      const generatedContent = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
      
      const updatedSections = [...docData.sections];
      updatedSections[idx] = { ...section, content: generatedContent };
      setDocData({ ...docData, sections: updatedSections });
      setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleGlobalAI = async () => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleGlobalAI());
    try {
        const prompt = AI_BRIDGE.buildGlobalContext(docData.sections, docData, lang);
        const rawJson = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
        const cleanJson = rawJson.replace(/```json/g, '').replace(/```/g, '').trim();
        const updates = JSON.parse(cleanJson);
        const newSections = docData.sections.map(original => {
            const update = updates.find(u => u.id === original.id);
            return update ? { ...original, content: update.content } : original;
        });
        setDocData({ ...docData, sections: newSections });
        setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleGuidanceAI = async (idx) => {
    if (!apiKey) { setAiError('API Key Diperlukan'); return; }
    pushHistory(); setIsProcessing(true); setAiError(null); setRetryAction(() => () => handleGuidanceAI(idx));
    try {
        const section = docData.sections[idx];
        const prompt = AI_BRIDGE.buildGuidanceContext(section.content, section.guidance[lang], lang);
        const feedback = await AI_BRIDGE.generate(prompt, apiKey, setAiStatus);
        const updatedSections = [...docData.sections];
        updatedSections[idx] = { ...section, aiFeedback: feedback };
        setDocData({ ...docData, sections: updatedSections });
        setAiStatus(null);
    } catch (e) { setAiError(e.message); setAiStatus(null); } finally { setIsProcessing(false); }
  };

  const handleSelectTemplate = (moduleId, isTutorial) => {
    const data = buildModuleData(moduleId, isTutorial);
    if (!data) return;
    setDocData(data); setSelectedIdx(0); setEditingIdx(null); setView('workspace');
  };
  const handleImport = (e) => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const parsed = JSON.parse(ev.target.result);
        setDocData(parsed); setSelectedIdx(0); setView('workspace');
      } catch { alert('File JSON tidak valid.'); }
    };
    reader.readAsText(e.target.files[0]);
    e.target.value = '';
  };
  const handleSaveJSON = () => {
    const dataStr = JSON.stringify(docData, null, 2);
    const link = document.createElement('a');
    link.href = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
    link.download = `structureflow-${docData.moduleId}-${Date.now()}.json`;
    link.click();
  };
  const handleExportDoc = () => {
    const preHtml = `<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'><head><meta charset='utf-8'><title>${docData.title}</title><style>body { font-family: 'Calibri', sans-serif; }</style></head><body><h1>${docData.title}</h1>`;
    const contentHtml = docData.sections.map(s => `<div class="section">${s.content}</div><br/>`).join('');
    const fullHtml = preHtml + contentHtml + "</body></html>";
    const url = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(fullHtml);
    const downloadLink = document.createElement("a");
    document.body.appendChild(downloadLink);
    downloadLink.href = url;
    downloadLink.download = `${docData.title}.doc`;
    downloadLink.click();
    document.body.removeChild(downloadLink);
  };
  
    const handleExportPDF = () => {
  const originalElement = document.querySelector('.max-w-3xl');
  if (!originalElement) {
    alert('Tidak ada konten untuk diekspor.');
    return;
  }

  // Clone elemen asli
  const clone = originalElement.cloneNode(true);
  
  // Hapus elemen-elemen yang tidak diperlukan (UI, tombol, badge, dll)
  const selectorsToRemove = [
    '.no-print',
    '.absolute.top-3.right-3',
    '.absolute.-top-2\\.5',
    '.flex-col.items-center.w-6',
    'button',
    '[class*="badge"]' // semua elemen dengan kata 'badge' di class
  ];
  
  selectorsToRemove.forEach(selector => {
    const elements = clone.querySelectorAll(selector);
    elements.forEach(el => el.remove());
  });

  // Bersihkan juga elemen input judul: ubah menjadi teks biasa
  const titleInput = clone.querySelector('input[type="text"]');
  if (titleInput) {
    const titleText = titleInput.value;
    const titleElement = document.createElement('h1');
    titleElement.className = 'document-title';
    titleElement.textContent = titleText;
    titleInput.parentNode.replaceChild(titleElement, titleInput);
  }

  // Bungkus konten dengan div yang memiliki margin
  const contentWrapper = document.createElement('div');
  contentWrapper.className = 'pdf-content';
  
  // Pindahkan semua anak clone ke dalam wrapper
  while (clone.firstChild) {
    contentWrapper.appendChild(clone.firstChild);
  }
  clone.appendChild(contentWrapper);
  
  // Tambahkan class harvard-export ke clone
  clone.classList.add('harvard-export');

  // Paksa semua elemen untuk menggunakan border-box
  clone.style.boxSizing = 'border-box';

  // Buat container sementara di luar layar untuk rendering
  const container = document.createElement('div');
  container.style.position = 'absolute';
  container.style.left = '-9999px';
  container.style.top = '0';
  container.style.width = '210mm'; // lebar A4
  container.style.backgroundColor = 'white';
  container.style.overflow = 'hidden'; // cegah scrollbar
  container.appendChild(clone);
  document.body.appendChild(container);

  // Opsi html2pdf yang disesuaikan untuk gaya jurnal
  const opt = {
    margin: [0, 0, 0, 0],
    filename: `${docData.title || 'dokumen'}.pdf`,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { 
    scale: 2, 
    letterRendering: true, 
    useCORS: true,
    logging: false // matikan log jika tidak perlu
  },
  jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } // unit mm lebih umum
};

  html2pdf().set(opt).from(clone).save().then(() => {
    document.body.removeChild(container);
  }).catch(err => {
    console.error('PDF export error:', err);
    alert('Gagal mengekspor PDF.');
    document.body.removeChild(container);
  });
};
    const handleUpdateSection = (idx, content) => {
    const sections = [...docData.sections];
    sections[idx] = { ...sections[idx], content };
    setDocData({ ...docData, sections });
  };
  const handleAddSection = () => {
    const newSection = { id: generateId(), sectionKey: 'kustom', content: '<h3>Bagian Baru</h3><p>...</p>', guidance: { en: {}, id: {} }, children: [], aiFeedback: null };
    setDocData({ ...docData, sections: [...docData.sections, newSection] });
    setSelectedIdx(docData.sections.length);
  };
  const handleMove = (idx, dir) => {
    const sections = [...docData.sections];
    const target = idx + dir;
    if (target < 0 || target >= sections.length) return;
    [sections[idx], sections[target]] = [sections[target], sections[idx]];
    setDocData({ ...docData, sections });
    setSelectedIdx(target);
  };
  const handleDelete = (idx) => {
    if (!confirm('Hapus bagian ini?')) return;
    const sections = docData.sections.filter((_, i) => i !== idx);
    setDocData({ ...docData, sections });
    setSelectedIdx(Math.min(idx, sections.length - 1));
  };

  if (view === 'landing') return <LandingPage onSelectTemplate={handleSelectTemplate} onImport={handleImport}/>;

  const mod = docData?.metadata;
  const col = mod ? colorMap[mod.color] : colorMap.blue;
  const activeSection = docData?.sections?.[selectedIdx] || null;
  const hasKey = AI_BRIDGE.hasKey(apiKey);

  return (
    <div className={`flex flex-col h-screen bg-slate-100 overflow-hidden font-sans ${isProcessing ? 'cursor-wait' : ''}`}>
      
      {aiError && <ErrorToast message={aiError} onClose={() => setAiError(null)} onRetry={() => { setAiError(null); if(retryAction) retryAction(); }} />}
      <AIMonitor status={aiStatus} />

      <div className="bg-slate-900 text-white flex items-center justify-between px-4 py-2.5 z-30 no-print shadow-xl">
        <div className="flex items-center gap-3">
          <button onClick={() => setView('landing')} className="flex items-center gap-1 text-slate-400 hover:text-white text-sm transition-colors">
            <ChevronLeft className="w-4 h-4"/> Back
          </button>
          <div className="h-5 w-px bg-slate-700"/>
          <div className="flex items-center gap-2">
            <Cpu className="w-4 h-4 text-blue-400"/>
            {/* 2. GANTI NAMA DI HEADER SINI */}
            <span className="font-bold text-sm text-white">StructureFlow (Angga C.S.)</span>
          </div>
        </div>

        <div className="flex items-center gap-2 bg-slate-800 rounded-full px-3 py-1 border border-slate-700">
            <div className={`w-2 h-2 rounded-full ${hasKey ? 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]' : 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.6)]'}`} />
            <Lock className="w-3 h-3 text-slate-400"/>
            <input 
                type="password" 
                placeholder="Masukkan Gemini API Key" 
                value={apiKey}
                onChange={(e) => setApiKey(e.target.value)}
                className="bg-transparent border-none text-xs text-white focus:outline-none w-48 placeholder:text-slate-600"
            />
        </div>

        <div className="flex items-center gap-1.5">
          <button onClick={handleUndo} disabled={history.length===0} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors disabled:opacity-50" title="Undo"><Undo className="w-4 h-4 text-orange-300"/></button>
          <div className="h-5 w-px bg-slate-700 mx-1"/>
          <button onClick={handleSaveJSON} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" title="Save as JSON"><Save className="w-4 h-4"/></button>
          <button onClick={handleExportDoc} className="p-2 bg-slate-700 hover:bg-slate-600 rounded-lg transition-colors" title="Download as Word"><Download className="w-4 h-4 text-green-300"/></button>
          <button onClick={handleExportPDF} className="p-2 bg-blue-700 hover:bg-blue-600 rounded-lg transition-colors" title="Print PDF"><Printer className="w-4 h-4"/></button>
        </div>
      </div>

      <div className="flex flex-1 overflow-hidden">
        <div className="w-2/3 flex flex-col bg-slate-50 border-r overflow-hidden relative">
          
          {isProcessing && (
              <div className="absolute top-0 left-0 w-full h-1 z-50 ai-thinking"/>
          )}

          <div className="px-6 py-3 border-b bg-white/90 backdrop-blur flex items-center justify-between no-print">
            <div className="flex items-center gap-3">
              <span className="text-xs font-bold uppercase tracking-wider text-slate-400">Document</span>
              <button onClick={handleGlobalAI} disabled={isProcessing}
                className="flex items-center gap-1.5 px-3 py-1.5 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 text-xs font-bold rounded-lg transition-colors border border-indigo-200 group">
                {isProcessing ? <Loader2 className="w-3 h-3 animate-spin"/> : <Brain className="w-3 h-3 group-hover:scale-110 transition-transform"/>}
                <span>Global Auto-Draft</span>
              </button>
            </div>
            <button onClick={handleAddSection} className="flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-full shadow-md"><Plus className="w-3 h-3"/> Add Section</button>
          </div>

          <div className="flex-1 overflow-y-auto px-8 py-8 custom-scrollbar">
            <div className="max-w-3xl mx-auto pb-24">
              {docData && (
                <input type="text" value={docData.title}
                  onChange={e => setDocData({ ...docData, title: e.target.value })}
                  className="w-full text-3xl font-black text-slate-800 mb-8 bg-transparent border-b-2 border-transparent hover:border-slate-200 focus:border-blue-400 focus:outline-none transition-all placeholder:text-slate-300 leading-tight"
                />
              )}

              {docData?.sections.map((section, idx) => {
                const isSelected = selectedIdx === idx;
                const isEditing = editingIdx === idx;
                return (
                  <div key={section.id} className="flex gap-3 group/row relative">
                    <div className="flex flex-col items-center w-6 pt-5 no-print flex-shrink-0">
                      <div className={`w-3 h-3 rounded-full border-2 z-10 transition-all duration-200 ${isSelected ? `bg-blue-500 border-blue-500 shadow-lg shadow-blue-400/30` : 'bg-white border-slate-300'}`}/>
                      {idx < docData.sections.length - 1 && <div className="w-0.5 bg-slate-200 flex-1 mt-1"/>}
                    </div>

                    <div className={`flex-1 mb-5 rounded-xl border-2 transition-all duration-200 bg-white cursor-pointer relative
                      ${isSelected ? 'border-blue-500 shadow-xl shadow-blue-500/10' : 'border-slate-200 hover:border-blue-200 hover:shadow-md'}`}
                      onClick={() => { setSelectedIdx(idx); }}>

                      <div className={`absolute -top-2.5 left-3 px-2 py-0.5 text-xs rounded-full border font-medium ${col.badge} no-print`}>
                        {section.sectionKey.replace(/_/g,' ')}
                      </div>

                      <div className="p-5 pt-6">
                        {isEditing ? (
                          <RichTextEditor
                            initialContent={section.content}
                            onSave={val => { handleUpdateSection(idx, val); setEditingIdx(null); }}
                            onCancel={() => setEditingIdx(null)}
                          />
                        ) : (
                          <div onDoubleClick={() => setEditingIdx(idx)}>
                            <div className="prose-card text-sm" dangerouslySetInnerHTML={{ __html: section.content }}/>
                            <div className={`absolute top-3 right-3 flex gap-1 bg-white rounded-lg border border-slate-200 p-0.5 shadow-sm no-print transition-opacity duration-200 ${isSelected ? 'opacity-100' : 'opacity-0 group-hover/row:opacity-100'}`}>
                              <button onClick={e => { e.stopPropagation(); handleNodecardAI(idx); }} disabled={isProcessing} className="p-1.5 hover:bg-purple-50 rounded text-purple-500 border-r border-slate-100" title="Revisi AI"><Sparkles className={`w-3 h-3 ${isProcessing && isSelected ? 'animate-spin' : ''}`}/></button>
                              <button onClick={e => { e.stopPropagation(); handleMove(idx, -1); }} className="p-1.5 hover:bg-slate-100 rounded text-slate-400 hover:text-slate-700"><ArrowUp className="w-3 h-3"/></button>
                              <button onClick={e => { e.stopPropagation(); handleMove(idx, 1); }} className="p-1.5 hover:bg-slate-100 rounded text-slate-400 hover:text-slate-700"><ArrowDown className="w-3 h-3"/></button>
                              <div className="w-px bg-slate-200 my-1"/>
                              <button onClick={e => { e.stopPropagation(); setEditingIdx(idx); }} className="p-1.5 hover:bg-blue-50 rounded text-blue-500"><Edit3 className="w-3 h-3"/></button>
                              <button onClick={e => { e.stopPropagation(); handleDelete(idx); }} className="p-1.5 hover:bg-red-50 rounded text-red-500"><Trash2 className="w-3 h-3"/></button>
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>

        <div className="w-1/3 bg-white border-l flex flex-col no-print">
          <div className="px-4 py-3 border-b bg-slate-50 flex items-center justify-between">
            <div className="flex items-center gap-2 font-bold text-slate-700 text-sm">
              <BookOpen className="w-4 h-4 text-blue-500"/> Guidance Engine
            </div>
            
            <div className="flex items-center bg-slate-200 p-1 rounded-full cursor-pointer select-none" onClick={() => setLang(l => l === 'en' ? 'id' : 'en')}>
                <div className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all duration-200 ${lang === 'en' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-600'}`}>EN</div>
                <div className={`px-3 py-1 rounded-full text-[10px] font-bold transition-all duration-200 ${lang === 'id' ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500 hover:text-slate-600'}`}>ID</div>
            </div>

          </div>
          <div className="flex-1 overflow-hidden">
            <GuidancePanel 
                section={activeSection} 
                moduleId={docData?.moduleId} 
                lang={lang} 
                onRunAI={() => handleGuidanceAI(selectedIdx)} 
                isProcessing={isProcessing}
                setLang={setLang}
            />
          </div>
        </div>
      </div>
    </div>
  );
}

createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
